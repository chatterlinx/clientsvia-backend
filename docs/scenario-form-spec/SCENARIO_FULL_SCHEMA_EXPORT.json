{
  "_exportMeta": {
    "exportedAt": "2025-12-22T00:00:00Z",
    "schemaVersion": "V22_COMPLETE",
    "source": "GlobalInstantResponseTemplate Mongoose Schema",
    "description": "COMPLETE scenario schema with ALL available fields, toggles, defaults, and conditional settings"
  },

  "templateContext": {
    "_description": "Template-level settings that scenarios inherit from",
    
    "templateId": "ObjectId",
    "version": {
      "type": "String",
      "required": true,
      "unique": true,
      "example": "v2.8.0"
    },
    "name": {
      "type": "String",
      "required": true,
      "default": "ClientVia.ai Global AI Receptionist Brain"
    },
    "description": "String",
    "templateType": {
      "type": "String",
      "default": "universal",
      "description": "References GlobalIndustryType.industryId"
    },
    "industryLabel": {
      "type": "String",
      "default": "All Industries"
    },
    "isActive": {
      "type": "Boolean",
      "default": false
    },
    "isPublished": {
      "type": "Boolean",
      "default": false
    },
    "isDefaultTemplate": {
      "type": "Boolean",
      "default": false
    },
    
    "fillerWords": {
      "type": "[String]",
      "default": ["um", "uh", "like", "you", "know", "i", "mean", "basically", "actually", "so", "well", "okay", "alright", "right", "the", "a", "an", "and", "or", "but", "is", "are", "was", "were", "be", "been", "being", "have", "has", "had", "do", "does", "did", "will", "would", "should", "could", "can", "may", "might", "must", "what", "when", "where", "who", "how", "why", "please", "thanks", "thank", "yes", "no", "yeah", "yep", "nope", "hi", "hey", "hello", "you guys", "today", "there"],
      "description": "Global filter applied to ALL scenarios"
    },
    
    "synonymMap": {
      "type": "Map<String, [String]>",
      "default": {
        "air conditioner": ["ac", "a/c", "air", "cooling", "cold air", "system"],
        "furnace": ["heater", "heat", "heating", "hot air"],
        "unit": ["system", "equipment", "machine", "thing outside"]
      },
      "description": "Translate colloquial terms to technical terms"
    },
    
    "nlpConfig": {
      "synonyms": "Map<String, [String]>",
      "fillerWords": "[String]",
      "fillerPhrases": "[String]",
      "updatedAt": "Date",
      "updatedBy": "String",
      "notes": "String"
    },
    
    "learningSettings": {
      "enableLearning": { "type": "Boolean", "default": true, "required": true },
      "shareWithinIndustry": { "type": "Boolean", "default": false },
      "industryShareThreshold": { "type": "Number", "default": 0.85, "min": 0.7, "max": 0.95 },
      "proposeForGlobal": { "type": "Boolean", "default": false },
      "globalProposeThreshold": { "type": "Number", "default": 0.90, "min": 0.85, "max": 0.98 },
      "minPatternFrequency": { "type": "Number", "default": 3, "min": 1, "max": 20 },
      "autoApproveIndustry": { "type": "Boolean", "default": true },
      "tier1Threshold": { "type": "Number", "default": 0.80, "min": 0.60, "max": 0.95 },
      "tier2Threshold": { "type": "Number", "default": 0.60, "min": 0.40, "max": 0.80 },
      "llmBudgetMonthly": { "type": "Number", "default": 500, "min": 0, "max": 10000 },
      "llmCostPerCall": { "type": "Number", "default": 0.50, "min": 0.01, "max": 5.00 }
    },
    
    "intelligenceMode": {
      "type": "String",
      "enum": ["MAXIMUM", "BALANCED", "MINIMAL"],
      "default": "MAXIMUM"
    },
    
    "testPilotSettings": {
      "llmModel": { "type": "String", "enum": ["gpt-4o", "gpt-4o-mini"], "default": "gpt-4o" },
      "analysisDepth": { "type": "String", "enum": ["DEEP", "STANDARD", "SHALLOW"], "default": "DEEP" },
      "analysisMode": { "type": "String", "enum": ["ALWAYS", "ON_FAILURE", "CRITICAL_ONLY"], "default": "ALWAYS" },
      "suggestionFilter": { "type": "String", "enum": ["ALL", "HIGH_PRIORITY", "CRITICAL_ONLY"], "default": "ALL" },
      "minConfidenceForAnalysis": { "type": "Number", "default": 0, "min": 0, "max": 1 },
      "conflictDetection": { "type": "String", "enum": ["AGGRESSIVE", "STANDARD", "DISABLED"], "default": "AGGRESSIVE" },
      "edgeCasePrediction": { "type": "Boolean", "default": true },
      "beforeAfterSimulation": { "type": "Boolean", "default": true },
      "bulkActions": { "type": "Boolean", "default": true },
      "costLimit": { "type": "Number", "default": null },
      "maxAnalysisTime": { "type": "Number", "default": 30000 }
    },
    
    "aiGatewaySettings": {
      "tier1Threshold": { "type": "Number", "default": 0.80, "min": 0.60, "max": 0.95 },
      "tier2Threshold": { "type": "Number", "default": 0.60, "min": 0.40, "max": 0.80 },
      "enableTier3": { "type": "Boolean", "default": true }
    },
    
    "urgencyKeywords": [{
      "word": { "type": "String", "required": true },
      "weight": { "type": "Number", "default": 0.2, "min": 0.1, "max": 0.5 },
      "category": { "type": "String", "default": "General Emergency" },
      "examples": "[String]"
    }],
    
    "variableDefinitions": [{
      "key": { "type": "String", "required": true },
      "label": { "type": "String", "required": true },
      "description": "String",
      "type": { "type": "String", "enum": ["text", "email", "phone", "url", "currency", "enum", "multiline"], "default": "text" },
      "required": { "type": "Boolean", "default": false },
      "enumValues": "[String]",
      "validation": "Mixed",
      "example": "String",
      "category": { "type": "String", "default": "General" },
      "usageCount": { "type": "Number", "default": 0 },
      "placeholder": "String"
    }]
  },

  "category": {
    "_description": "Category-level settings (contains scenarios)",
    
    "id": {
      "type": "String",
      "required": true,
      "example": "emergency_services"
    },
    "name": {
      "type": "String",
      "required": true,
      "example": "Emergency Services"
    },
    "icon": {
      "type": "String",
      "default": "ðŸ’¬",
      "example": "ðŸš¨"
    },
    "description": {
      "type": "String",
      "required": true,
      "example": "High-priority emergency scenarios"
    },
    "behavior": {
      "type": "String",
      "required": false,
      "default": null,
      "description": "DEPRECATED - scenarios control their own behavior"
    },
    "isActive": {
      "type": "Boolean",
      "default": true
    },
    "additionalFillerWords": {
      "type": "[String]",
      "default": [],
      "description": "Extends template.fillerWords"
    },
    "synonymMap": {
      "type": "Map<String, [String]>",
      "default": {},
      "description": "Extends template.synonymMap"
    }
  },

  "scenario": {
    "_description": "COMPLETE scenario schema with ALL fields",
    
    "___SECTION_IDENTITY___": "=== IDENTITY & LIFECYCLE ===",
    
    "scenarioId": {
      "type": "String",
      "required": true,
      "description": "ULID or UUID for stable, collision-free IDs",
      "example": "hvac_emergency_no_heat_v2"
    },
    "version": {
      "type": "Number",
      "required": true,
      "default": 1,
      "min": 1,
      "description": "Incremented on each publish; enables rollback"
    },
    "status": {
      "type": "String",
      "enum": ["draft", "live", "archived"],
      "default": "draft",
      "description": "draft=editing, live=active matching, archived=historical"
    },
    "name": {
      "type": "String",
      "required": true,
      "example": "Emergency - No Heat"
    },
    "isActive": {
      "type": "Boolean",
      "default": true,
      "description": "Quick on/off toggle without archiving"
    },
    
    "___SECTION_CATEGORIZATION___": "=== CATEGORIZATION & ORGANIZATION ===",
    
    "categories": {
      "type": "[String]",
      "description": "Many-to-many: scenario can belong to multiple categories",
      "example": ["emergency", "heating", "urgent_service"]
    },
    "priority": {
      "type": "Number",
      "default": 0,
      "min": -10,
      "max": 100,
      "description": "Tie-breaker when multiple scenarios match (emergency=100, neutral=0, smalltalk=-5)"
    },
    "cooldownSeconds": {
      "type": "Number",
      "default": 0,
      "min": 0,
      "description": "Prevents scenario from firing again within N seconds"
    },
    
    "___SECTION_MULTILINGUAL___": "=== MULTILINGUAL & CHANNEL SUPPORT ===",
    
    "language": {
      "type": "String",
      "default": "auto",
      "description": "'auto'=detect from input, 'en', 'es', 'fr', etc."
    },
    "channel": {
      "type": "String",
      "enum": ["voice", "sms", "chat", "any"],
      "default": "any",
      "description": "Restrict scenario to specific channels"
    },
    
    "___SECTION_TRIGGERS___": "=== HYBRID MATCHING - THE INTELLIGENCE CORE ===",
    
    "triggers": {
      "type": "[String]",
      "required": true,
      "description": "Plain phrases for BM25 keyword matching",
      "example": ["no heat", "heater not working", "furnace not working", "heat won't turn on"]
    },
    "regexTriggers": {
      "type": "[String]",
      "description": "Advanced pattern matching for power users",
      "example": ["\\b(no|won't|can't|not)\\s+(get|have)\\s+(heat|warm)"]
    },
    "negativeTriggers": {
      "type": "[String]",
      "description": "Phrases that PREVENT matching (avoid false positives)",
      "example": ["don't need heat", "cancel heating", "too much heat"]
    },
    "embeddingVector": {
      "type": "[Number]",
      "select": false,
      "description": "COMPUTED: Precomputed semantic embedding for triggers (OpenAI ada-002)"
    },
    "contextWeight": {
      "type": "Number",
      "default": 0.7,
      "min": 0,
      "max": 1,
      "description": "Multiplier on final match score (emergency=0.95, chitchat=0.5)"
    },
    
    "___SECTION_STATE___": "=== STATE MACHINE & CONVERSATION FLOW ===",
    
    "preconditions": {
      "type": "Map<String, Mixed>",
      "description": "Conditions that must be met for scenario to match",
      "example": {"state": "collecting_phone", "hasEntity": ["name"]}
    },
    "effects": {
      "type": "Map<String, Mixed>",
      "description": "State changes to apply after scenario executes",
      "example": {"setState": "confirming", "increment": {"holdCount": 1}}
    },
    
    "___SECTION_ENHANCED_TRIGGERS___": "=== ENHANCED USER PHRASE TRIGGERS ===",
    
    "exampleUserPhrases": {
      "type": "[String]",
      "description": "12-18 example phrases users say (for documentation + future ML)",
      "example": ["hey my heat isn't working", "the furnace stopped working last night"]
    },
    "negativeUserPhrases": {
      "type": "[String]",
      "description": "Phrases that PREVENT this scenario from matching",
      "example": ["I want to cancel my heating service", "we don't need heat right now"]
    },
    
    "___SECTION_REPLIES___": "=== WEIGHTED REPLIES ===",
    
    "quickReplies": {
      "type": "[String|{text: String, weight: Number}]",
      "description": "Short responses for voice (10-30 words). Multiple variations.",
      "minItems": 7,
      "recommendedItems": "7-10",
      "example": [
        "I understand you have no heat â€” that's definitely urgent. Let me get a technician headed your way.",
        "No heat is a priority for us. I'm pulling up our emergency schedule right now.",
        "I hear you â€” being without heat is no fun. Let me check our next available emergency appointment."
      ]
    },
    "fullReplies": {
      "type": "[String|{text: String, weight: Number}]",
      "description": "Long responses for SMS/chat (50-150 words). Multiple variations.",
      "minItems": 7,
      "recommendedItems": "7-10",
      "example": [
        "I'm so sorry to hear you're dealing with no heat â€” I know how uncomfortable and even dangerous that can be. We treat no-heat situations as top priority emergencies. Let me check our emergency technician schedule right now. In the meantime, if you have space heaters, please use them safely."
      ]
    },
    "followUpPrompts": {
      "type": "[String|{text: String, weight: Number}]",
      "description": "Follow-up questions after initial response",
      "example": ["Is there anything else I can help you with while we get this scheduled?"]
    },
    "followUpFunnel": {
      "type": "String",
      "description": "Re-engagement prompt to guide back to call purpose",
      "example": "Alright â€” where were we? Let's get you booked!"
    },
    "replySelection": {
      "type": "String",
      "enum": ["sequential", "random", "bandit"],
      "default": "bandit",
      "description": "sequential=rotate, random=random pick, bandit=learn best performers"
    },
    
    "___SECTION_SCENARIO_TYPE___": "=== SCENARIO SEMANTICS & REPLY STRATEGY ===",
    
    "scenarioType": {
      "type": "String",
      "enum": ["INFO_FAQ", "ACTION_FLOW", "SYSTEM_ACK", "SMALL_TALK", null],
      "default": null,
      "description": "null=inferred at runtime. INFO_FAQ=static info, ACTION_FLOW=drives flow, SYSTEM_ACK=internal, SMALL_TALK=rapport"
    },
    "replyStrategy": {
      "type": "String",
      "enum": ["AUTO", "FULL_ONLY", "QUICK_ONLY", "QUICK_THEN_FULL", "LLM_WRAP", "LLM_CONTEXT"],
      "default": "AUTO",
      "description": "AUTO=use global rules, FULL_ONLY=never quick, LLM_WRAP=tone polish"
    },
    
    "___SECTION_FOLLOWUP___": "=== FOLLOW-UP BEHAVIOR ===",
    
    "followUpMode": {
      "type": "String",
      "enum": ["NONE", "ASK_FOLLOWUP_QUESTION", "ASK_IF_BOOK", "TRANSFER"],
      "default": "NONE",
      "description": "What happens after initial response"
    },
    "followUpQuestionText": {
      "type": "String",
      "default": null,
      "description": "Text to ask if followUpMode=ASK_FOLLOWUP_QUESTION",
      "example": "Is there anything else I can help you with?"
    },
    "transferTarget": {
      "type": "String",
      "default": null,
      "description": "Queue/extension/target for transfer if followUpMode=TRANSFER",
      "example": "sales_queue"
    },
    
    "___SECTION_CONFIDENCE___": "=== CONFIDENCE & PRIORITY OVERRIDES ===",
    
    "minConfidence": {
      "type": "Number",
      "default": null,
      "min": 0,
      "max": 1,
      "description": "null=use template/company defaults. Scenario-level threshold override."
    },
    
    "___SECTION_NOTES___": "=== ADMIN NOTES ===",
    
    "notes": {
      "type": "String",
      "default": "",
      "description": "Internal notes for admins (NOT used by AI)"
    },
    
    "___SECTION_ENTITIES___": "=== ENTITY CAPTURE & DYNAMIC VARIABLES ===",
    
    "entityCapture": {
      "type": "[String]",
      "description": "List of entities to extract from speech",
      "example": ["name", "phone_number", "address", "technician"]
    },
    "entityValidation": {
      "type": "Map<String, Mixed>",
      "description": "Validation rules per entity",
      "example": {"phone_number": {"regex": "^\\d{10}$", "normalize": "E.164"}}
    },
    "dynamicVariables": {
      "type": "Map<String, String>",
      "description": "Variable fallbacks when entity missing",
      "example": {"technician": "the team", "name": "the caller"}
    },
    
    "___SECTION_ACTION_HOOKS___": "=== ACTION HOOKS & INTEGRATIONS ===",
    
    "actionHooks": {
      "type": "[String]",
      "description": "References to GlobalActionHook hookIds",
      "example": ["escalate_to_human", "log_sentiment_positive"]
    },
    "handoffPolicy": {
      "type": "String",
      "enum": ["never", "low_confidence", "always_on_keyword"],
      "default": "low_confidence",
      "description": "When to escalate to human"
    },
    
    "___SECTION_SENSITIVE___": "=== SENSITIVE DATA & SAFETY ===",
    
    "sensitiveInfoRule": {
      "type": "String",
      "enum": ["platform_default", "custom"],
      "default": "platform_default",
      "description": "Use platform-wide masking or custom rules"
    },
    "customMasking": {
      "type": "Map<String, String>",
      "description": "Per-entity masking overrides",
      "example": {"phone_number": "last4", "address": "street_only"}
    },
    
    "___SECTION_TIMING___": "=== TIMING & HOLD BEHAVIOR ===",
    
    "timedFollowUp": {
      "enabled": { "type": "Boolean", "default": false },
      "delaySeconds": { "type": "Number", "default": 50, "min": 0, "description": "How long to wait before checking in" },
      "messages": { "type": "[String]", "description": "What to say at timeout (multiple variations)" },
      "extensionSeconds": { "type": "Number", "default": 30, "min": 0, "description": "Additional time granted if caller requests more" }
    },
    "silencePolicy": {
      "maxConsecutive": { "type": "Number", "default": 2, "min": 1, "description": "How many silent turns before taking action" },
      "finalWarning": { "type": "String", "default": "Hello? Did I lose you?", "description": "Message before ending call" }
    },
    
    "___SECTION_INTELLIGENCE___": "=== AI INTELLIGENCE & LEARNING ===",
    
    "keywords": {
      "type": "[String]",
      "default": [],
      "description": "Fast Tier-1 matching keywords (positive)"
    },
    "negativeKeywords": {
      "type": "[String]",
      "default": [],
      "description": "Keywords that PREVENT this scenario from matching"
    },
    "qnaPairs": {
      "type": "[{question: String, answer: String, confidence: Number}]",
      "description": "Training data for semantic matching",
      "example": [{"question": "How do I book an appointment?", "answer": "I'd be happy to help...", "confidence": 0.85}]
    },
    "testPhrases": {
      "type": "[String]",
      "description": "Validation test cases",
      "example": ["I need an appointment", "Can I schedule a visit?"]
    },
    "examples": {
      "type": "[{caller: String, ai: String}]",
      "description": "Sample conversations showing expected flow"
    },
    "escalationFlags": {
      "type": "[String]",
      "default": [],
      "description": "Sentiment/situation flags that trigger escalation",
      "example": ["angry", "confused", "technical_issue", "vip_customer", "urgent"]
    },
    
    "___SECTION_VOICE___": "=== VOICE & TTS CONTROL ===",
    
    "behavior": {
      "type": "String",
      "default": null,
      "description": "References GlobalAIBehaviorTemplate.behaviorId. If null, inherits from category."
    },
    "toneLevel": {
      "type": "Number",
      "min": 1,
      "max": 5,
      "default": 2,
      "description": "DEPRECATED: Use 'behavior' field instead. 1=flat, 2=calm, 3=warm, 4=excited, 5=urgent"
    },
    "ttsOverride": {
      "pitch": { "type": "String", "example": "+5%" },
      "rate": { "type": "String", "example": "1.1" },
      "volume": { "type": "String", "example": "normal" }
    },
    
    "___SECTION_AUDIT___": "=== METADATA & AUDIT ===",
    
    "createdBy": { "type": "String", "default": "Platform Admin" },
    "updatedBy": { "type": "String", "default": "Platform Admin" },
    "createdAt": { "type": "Date", "default": "Date.now", "immutable": true },
    "updatedAt": { "type": "Date", "default": "Date.now" },
    
    "___SECTION_DEPRECATED___": "=== DEPRECATED/LEGACY FIELDS ===",
    
    "quickReply": {
      "type": "String",
      "description": "DEPRECATED: use quickReplies[] instead"
    },
    "fullReply": {
      "type": "String",
      "description": "DEPRECATED: use fullReplies[] instead"
    },
    "legacyMigrated": {
      "type": "Boolean",
      "default": false,
      "description": "Migration marker"
    }
  },

  "exampleScenarioPopulated": {
    "_description": "FULLY POPULATED example scenario with real values",
    
    "scenarioId": "hvac_emergency_no_heat_v2",
    "name": "Emergency - No Heat",
    "version": 3,
    "status": "live",
    "isActive": true,
    
    "categories": ["emergency", "heating", "urgent_service"],
    "priority": 95,
    "cooldownSeconds": 0,
    
    "language": "en",
    "channel": "any",
    
    "triggers": [
      "no heat",
      "heater not working",
      "furnace not working",
      "heat won't turn on",
      "no hot air",
      "cold in house",
      "freezing in here",
      "furnace won't start",
      "heating system down",
      "no warm air coming out",
      "heat pump not working",
      "radiators are cold",
      "house is freezing"
    ],
    
    "regexTriggers": [
      "\\b(no|won't|can't|not)\\s+(get|have)\\s+(heat|warm)",
      "\\bheat(er|ing)?\\s+(broke|broken|dead|out)"
    ],
    
    "negativeTriggers": [
      "no heat in summer",
      "don't need heat",
      "cancel heating",
      "too much heat",
      "overheating"
    ],
    
    "embeddingVector": null,
    "contextWeight": 0.95,
    
    "preconditions": null,
    "effects": {
      "setState": "emergency_triage",
      "setFlag": {"isEmergency": true},
      "increment": {"emergencyCallCount": 1}
    },
    
    "exampleUserPhrases": [
      "hey my heat isn't working",
      "the furnace stopped working last night",
      "we have no heat in the house",
      "it's freezing cold and the heater won't turn on",
      "my heating system is completely dead",
      "the radiators aren't getting warm",
      "I woke up and there's no heat",
      "our furnace just quit on us",
      "the heat pump isn't doing anything",
      "we're all cold because the heater broke",
      "can someone come out? we have no heat",
      "this is an emergency, our heat is out"
    ],
    
    "negativeUserPhrases": [
      "I want to cancel my heating service",
      "we don't need heat right now",
      "the house is too hot actually",
      "can you turn down the heat?"
    ],
    
    "quickReplies": [
      "I understand you have no heat â€” that's definitely urgent. Let me get a technician headed your way as quickly as possible.",
      "No heat is a priority for us. I'm pulling up our emergency schedule right now to get someone out to you.",
      "I hear you â€” being without heat is no fun. Let me check our next available emergency appointment.",
      "That sounds really uncomfortable. We treat no-heat calls as emergencies, so let me see who's available.",
      "I completely understand the urgency. We'll get someone out there as fast as we can.",
      "No heat when it's cold out is serious. I'm checking our emergency availability right now.",
      "Absolutely â€” we take no-heat calls very seriously. Let me find the fastest option for you."
    ],
    
    "fullReplies": [
      "I'm so sorry to hear you're dealing with no heat â€” I know how uncomfortable and even dangerous that can be, especially in cold weather. We treat no-heat situations as top priority emergencies. Let me check our emergency technician schedule right now. In the meantime, if you have space heaters, please use them safely and keep doors to unused rooms closed to concentrate warmth. I'll have an update for you in just a moment.",
      "That's definitely an urgent situation, and we want to help you as quickly as possible. No-heat calls go straight to the top of our emergency queue because we know how important it is to keep your family warm and safe. I'm pulling up our dispatch system right now to find the fastest available technician. While you wait, try to stay in one area of the home to conserve body heat, and let me know if you have any young children or elderly family members â€” we'll prioritize accordingly.",
      "I completely understand how stressful it is to be without heat. This is exactly the kind of emergency we're here for, and our team is trained to respond quickly. I'm checking right now to see which technician can get to you soonest. In many cases, we can have someone there within a few hours. Is there anything else I should know about your situation â€” like if there are pipes that might be at risk of freezing?",
      "No heat is always treated as an emergency here at {{companyName}}. I'm checking our schedule right now to dispatch a technician as soon as possible. While I do that, may I get some quick information? What type of heating system do you have â€” furnace, heat pump, or boiler? And when did you first notice the heat stopped working? This will help our technician come prepared with the right parts.",
      "I hear you, and I want to get you taken care of right away. A no-heat situation is our highest priority, especially when temperatures are low. Let me look at our emergency dispatch schedule. Our technicians are experienced with all types of heating systems and carry common parts on their trucks, so in many cases they can fix the issue on the first visit. I'll have availability info for you in just a second.",
      "That sounds really uncomfortable, and I apologize you're dealing with this. We'll get someone out there as quickly as humanly possible. No-heat calls jump to the front of our queue because we know it's not just about comfort â€” it's about safety too. I'm checking our emergency roster now. Do you happen to know if your thermostat is showing any error codes or if you've checked the circuit breaker?",
      "Absolutely â€” no heat is something we take very seriously. Let me pull up our emergency schedule and find the fastest option to get a technician to your door. While I'm doing that, have you noticed any strange sounds or smells from your heating unit? Sometimes that information helps our techs diagnose the issue even faster."
    ],
    
    "followUpPrompts": [
      "Is there anything else I can help you with while we get this scheduled?",
      "While we get the technician on the way, is there anything else you'd like to know?",
      "Do you have any questions about what to expect when the technician arrives?"
    ],
    
    "followUpFunnel": "Alright â€” let's make sure we get that heat back on for you. What's the best phone number to reach you at?",
    
    "replySelection": "bandit",
    "scenarioType": "ACTION_FLOW",
    "replyStrategy": "AUTO",
    
    "followUpMode": "ASK_IF_BOOK",
    "followUpQuestionText": "Would you like me to schedule an emergency technician right now?",
    "transferTarget": null,
    
    "minConfidence": 0.65,
    "notes": "High-priority emergency scenario for no-heat calls. Priority boosted in winter months. Last reviewed 2025-12-01.",
    
    "entityCapture": ["name", "phone_number", "address", "service_type"],
    "entityValidation": {
      "phone_number": {
        "regex": "^\\d{10}$",
        "normalize": "E.164",
        "errorMessage": "Please provide a 10-digit phone number"
      },
      "address": {
        "minLength": 10,
        "requiresZip": true
      }
    },
    "dynamicVariables": {
      "technician": "our technician",
      "companyName": "{{companyName}}",
      "serviceArea": "your area"
    },
    
    "actionHooks": ["log_emergency_call", "notify_dispatch_team"],
    "handoffPolicy": "low_confidence",
    
    "sensitiveInfoRule": "platform_default",
    "customMasking": null,
    
    "timedFollowUp": {
      "enabled": false,
      "delaySeconds": 50,
      "messages": [
        "I'm still here â€” just checking to see if you're ready to schedule that emergency visit.",
        "Hello? I want to make sure we get your heat fixed as soon as possible."
      ],
      "extensionSeconds": 30
    },
    
    "silencePolicy": {
      "maxConsecutive": 2,
      "finalWarning": "Hello? I'm still here if you need help with your heating emergency."
    },
    
    "keywords": ["heat", "furnace", "heater", "cold", "freezing", "warm"],
    "negativeKeywords": ["cancel", "summer", "too much", "overheating"],
    
    "qnaPairs": [
      {
        "question": "My heat isn't working",
        "answer": "I understand you have no heat â€” that's definitely urgent. Let me get a technician headed your way as quickly as possible.",
        "confidence": 0.92
      },
      {
        "question": "The furnace stopped working",
        "answer": "No heat is a priority for us. I'm pulling up our emergency schedule right now to get someone out to you.",
        "confidence": 0.90
      }
    ],
    
    "testPhrases": [
      "my heat isn't working and it's 20 degrees outside",
      "furnace broke down this morning",
      "no warm air coming from vents"
    ],
    
    "examples": [
      {
        "caller": "Hi, our heat isn't working and it's really cold",
        "ai": "I understand you have no heat â€” that's definitely urgent. Let me get a technician headed your way as quickly as possible. May I have your name and address?"
      },
      {
        "caller": "The furnace just stopped last night",
        "ai": "No heat is a priority for us. I'm pulling up our emergency schedule right now. When exactly did you first notice the heat stopped working?"
      }
    ],
    
    "escalationFlags": ["urgent", "elderly_resident", "infant_in_home", "medical_equipment"],
    
    "behavior": "empathetic_urgent",
    "toneLevel": 4,
    "ttsOverride": {
      "pitch": "+2%",
      "rate": "1.05",
      "volume": "normal"
    },
    
    "createdBy": "Platform Admin",
    "updatedBy": "Platform Admin",
    "createdAt": "2025-01-15T10:30:00Z",
    "updatedAt": "2025-12-22T00:00:00Z",
    "legacyMigrated": false
  }
}

