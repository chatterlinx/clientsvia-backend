{
  "meta": {
    "schema": "TRUTH_BUNDLE_V1",
    "generatedAt": "2026-02-03T17:32:40.159Z",
    "companyId": "global",
    "environment": "development",
    "hash": "096d994410af392a982ac22f430638c8a1ba8b6d63b33f969da61089752549f5",
    "flowTreeVersion": "1.0.0",
    "nodeCount": 18,
    "edgeCount": 26,
    "bindingCount": 13
  },
  "wiringReport": {
    "schema": "WIRING_REPORT_V2",
    "generatedAt": "2026-02-03T17:32:40.159Z",
    "note": "Full wiring report not available - using fallback"
  },
  "flowTree": {
    "version": "1.0.0",
    "generatedAt": "2026-02-03T17:32:40.163Z",
    "nodes": [
      {
        "id": "node.callStart",
        "label": "Call Start",
        "type": "entry",
        "description": "Inbound call received",
        "checkpoint": "CHECKPOINT_1"
      },
      {
        "id": "node.emptyUtteranceGuard",
        "label": "Empty Utterance Guard",
        "type": "guard",
        "description": "V92: Routes empty/punctuation-only input to SilenceHandler",
        "checkpoint": "CHECKPOINT_V92_EMPTY_GUARD",
        "configPaths": [
          "routing.emptyUtteranceGuard.enabled"
        ],
        "codeLocation": "ConversationEngine.js:4604"
      },
      {
        "id": "node.silenceHandler",
        "label": "Silence Handler",
        "type": "action",
        "description": "Deterministic silence response (0 tokens)",
        "checkpoint": "SILENCE_HANDLER",
        "matchSource": "SILENCE_HANDLER"
      },
      {
        "id": "node.slotExtraction",
        "label": "Slot Extraction",
        "type": "action",
        "description": "Extract name/phone/address/time from utterance",
        "checkpoint": "CHECKPOINT_8",
        "configPaths": [
          "frontDesk.bookingSlots",
          "frontDesk.addressValidation.rejectQuestions"
        ],
        "codeLocation": "ConversationEngine.js:4030"
      },
      {
        "id": "node.bookingModeCheck",
        "label": "Booking Mode Check",
        "type": "decision",
        "description": "Is booking mode locked?",
        "checkpoint": "CHECKPOINT_BRANCH_DECISION",
        "configPaths": [
          "frontDesk.bookingBehavior.requireExplicitConsent"
        ]
      },
      {
        "id": "node.bookingRunner",
        "label": "Booking Flow Runner",
        "type": "router",
        "description": "Deterministic slot collection (no LLM)",
        "checkpoint": "CHECKPOINT_9b",
        "matchSource": "BOOKING_SNAP",
        "configPaths": [
          "frontDesk.bookingSlots",
          "frontDesk.askFullName",
          "frontDesk.confirmSpelling"
        ],
        "codeLocation": "BookingFlowRunner.js"
      },
      {
        "id": "node.metaIntentDetector",
        "label": "Meta Intent Detector",
        "type": "detector",
        "description": "Detect universal intents (human request, cancel, etc.)",
        "checkpoint": "CHECKPOINT_V86_META",
        "matchSource": "META_INTENT_TIER1",
        "configPaths": [
          "frontDesk.universalHandlers"
        ]
      },
      {
        "id": "node.directBookingIntentDetector",
        "label": "Direct Booking Intent Detector",
        "type": "detector",
        "description": "V92: Detect \"get somebody out\", \"schedule\", etc.",
        "checkpoint": "CHECKPOINT_DIRECT_INTENT",
        "configPaths": [
          "booking.directIntentPatterns"
        ],
        "codeLocation": "DirectBookingIntentDetector.js"
      },
      {
        "id": "node.consentGate",
        "label": "Consent Gate",
        "type": "decision",
        "description": "Check for explicit booking consent",
        "checkpoint": "CHECKPOINT_CONSENT_CHECK",
        "configPaths": [
          "frontDesk.bookingBehavior.requireExplicitConsent",
          "frontDesk.bookingBehavior.consentPhrases"
        ],
        "codeLocation": "ConversationEngine.js:5345"
      },
      {
        "id": "node.bookingTrigger",
        "label": "Booking Mode Trigger",
        "type": "action",
        "description": "Flip bookingModeLocked=true, enter booking",
        "checkpoint": "CHECKPOINT_BOOKING_TRIGGER",
        "configPaths": [],
        "codeLocation": "ConversationEngine.js:5389"
      },
      {
        "id": "node.fastPathIntentDetector",
        "label": "Fast Path Intent Detector",
        "type": "detector",
        "description": "Detect urgency keywords (schedule, ASAP, send someone)",
        "checkpoint": "CHECKPOINT_9d_1",
        "configPaths": [
          "frontDesk.fastPathBooking.enabled",
          "frontDesk.fastPathBooking.triggerKeywords"
        ],
        "codeLocation": "ConversationEngine.js:11517"
      },
      {
        "id": "node.fastPathOffer",
        "label": "Fast Path Offer",
        "type": "action",
        "description": "Speak offer script, set bookingConsentPending",
        "checkpoint": "FAST_PATH_OFFER",
        "matchSource": "FAST_PATH_BOOKING",
        "configPaths": [
          "frontDesk.fastPathBooking.offerScript"
        ],
        "codeLocation": "ConversationEngine.js:11673"
      },
      {
        "id": "node.discoveryClarification",
        "label": "Discovery Clarification",
        "type": "detector",
        "description": "V92: Ask clarifying questions for vague issues",
        "checkpoint": "CHECKPOINT_V92_CLARIFY",
        "configPaths": [
          "discovery.clarifyingQuestions.enabled",
          "discovery.clarifyingQuestions.vaguePatterns"
        ],
        "codeLocation": "ConversationEngine.js:11275"
      },
      {
        "id": "node.scenarioMatcher",
        "label": "Scenario Matcher",
        "type": "router",
        "description": "BM25 + regex scenario matching",
        "checkpoint": "CHECKPOINT_SCENARIO_MATCH",
        "matchSource": "SCENARIO_MATCH",
        "configPaths": [
          "scenarios.*.triggers",
          "scenarios.*.negativeTriggers",
          "scenarios.*.response"
        ],
        "codeLocation": "HybridScenarioSelector.js"
      },
      {
        "id": "node.scenarioResponse",
        "label": "Scenario Response",
        "type": "action",
        "description": "Return matched scenario response",
        "checkpoint": "SCENARIO_RESPONSE",
        "matchSource": "SCENARIO_MATCHED"
      },
      {
        "id": "node.llmFallback",
        "label": "LLM Fallback",
        "type": "router",
        "description": "Tier-3 LLM when no deterministic match",
        "checkpoint": "CHECKPOINT_9e",
        "matchSource": "LLM_FALLBACK",
        "tier": "tier3",
        "codeLocation": "HybridReceptionistLLM.js"
      },
      {
        "id": "node.bookingComplete",
        "label": "Booking Complete",
        "type": "action",
        "description": "All slots collected, booking finalized",
        "checkpoint": "BOOKING_COMPLETE",
        "matchSource": "BOOKING_COMPLETE",
        "configPaths": [
          "frontDesk.bookingOutcome"
        ]
      },
      {
        "id": "node.callEnd",
        "label": "Call End",
        "type": "exit",
        "description": "Call terminated",
        "checkpoint": "CALL_END"
      }
    ],
    "edges": [
      {
        "id": "edge.1",
        "from": "node.callStart",
        "to": "node.emptyUtteranceGuard",
        "when": "always"
      },
      {
        "id": "edge.2a",
        "from": "node.emptyUtteranceGuard",
        "to": "node.silenceHandler",
        "when": "isEmpty || isPunctuationOnly || isFillerOnly"
      },
      {
        "id": "edge.2b",
        "from": "node.emptyUtteranceGuard",
        "to": "node.slotExtraction",
        "when": "hasContent"
      },
      {
        "id": "edge.3",
        "from": "node.slotExtraction",
        "to": "node.bookingModeCheck",
        "when": "always"
      },
      {
        "id": "edge.4a",
        "from": "node.bookingModeCheck",
        "to": "node.bookingRunner",
        "when": "bookingModeLocked === true"
      },
      {
        "id": "edge.4b",
        "from": "node.bookingModeCheck",
        "to": "node.metaIntentDetector",
        "when": "bookingModeLocked === false"
      },
      {
        "id": "edge.5a",
        "from": "node.metaIntentDetector",
        "to": "node.callEnd",
        "when": "humanRequest || cancel"
      },
      {
        "id": "edge.5b",
        "from": "node.metaIntentDetector",
        "to": "node.directBookingIntentDetector",
        "when": "noMetaIntent"
      },
      {
        "id": "edge.6a",
        "from": "node.directBookingIntentDetector",
        "to": "node.bookingTrigger",
        "when": "hasDirectIntent && confidence >= 0.75"
      },
      {
        "id": "edge.6b",
        "from": "node.directBookingIntentDetector",
        "to": "node.consentGate",
        "when": "noDirectIntent"
      },
      {
        "id": "edge.7a",
        "from": "node.consentGate",
        "to": "node.bookingTrigger",
        "when": "hasConsent"
      },
      {
        "id": "edge.7b",
        "from": "node.consentGate",
        "to": "node.fastPathIntentDetector",
        "when": "noConsent"
      },
      {
        "id": "edge.8",
        "from": "node.bookingTrigger",
        "to": "node.bookingRunner",
        "when": "always"
      },
      {
        "id": "edge.9a",
        "from": "node.fastPathIntentDetector",
        "to": "node.fastPathOffer",
        "when": "fastPathTriggered"
      },
      {
        "id": "edge.9b",
        "from": "node.fastPathIntentDetector",
        "to": "node.discoveryClarification",
        "when": "noFastPath"
      },
      {
        "id": "edge.10a",
        "from": "node.discoveryClarification",
        "to": "node.scenarioMatcher",
        "when": "issueClear || clarificationAsked"
      },
      {
        "id": "edge.10b",
        "from": "node.discoveryClarification",
        "to": "node.callEnd",
        "when": "askClarifyingQuestion"
      },
      {
        "id": "edge.11a",
        "from": "node.scenarioMatcher",
        "to": "node.scenarioResponse",
        "when": "scenarioMatched"
      },
      {
        "id": "edge.11b",
        "from": "node.scenarioMatcher",
        "to": "node.llmFallback",
        "when": "noScenarioMatch"
      },
      {
        "id": "edge.12a",
        "from": "node.bookingRunner",
        "to": "node.bookingComplete",
        "when": "allSlotsCollected"
      },
      {
        "id": "edge.12b",
        "from": "node.bookingRunner",
        "to": "node.callEnd",
        "when": "slotQuestionAsked"
      },
      {
        "id": "edge.13",
        "from": "node.silenceHandler",
        "to": "node.callEnd",
        "when": "always"
      },
      {
        "id": "edge.14",
        "from": "node.scenarioResponse",
        "to": "node.callEnd",
        "when": "always"
      },
      {
        "id": "edge.15",
        "from": "node.llmFallback",
        "to": "node.callEnd",
        "when": "always"
      },
      {
        "id": "edge.16",
        "from": "node.fastPathOffer",
        "to": "node.callEnd",
        "when": "always"
      },
      {
        "id": "edge.17",
        "from": "node.bookingComplete",
        "to": "node.callEnd",
        "when": "always"
      }
    ],
    "entryNodeId": "node.callStart",
    "exitNodeId": "node.callEnd",
    "nodeCount": 18,
    "edgeCount": 26
  },
  "runtimeBindings": [
    {
      "nodeId": "node.emptyUtteranceGuard",
      "checkpoints": [
        "CHECKPOINT_V92_EMPTY_GUARD"
      ],
      "matchSources": [],
      "codePatterns": [
        "shouldTreatAsSilence",
        "isPunctuationOnly",
        "isFillerOnly"
      ]
    },
    {
      "nodeId": "node.silenceHandler",
      "checkpoints": [
        "SILENCE_HANDLER"
      ],
      "matchSources": [
        "SILENCE_HANDLER"
      ],
      "codePatterns": [
        "SILENCE_DETERMINISTIC"
      ]
    },
    {
      "nodeId": "node.bookingModeCheck",
      "checkpoints": [
        "CHECKPOINT_BRANCH_DECISION"
      ],
      "matchSources": [],
      "codePatterns": [
        "bookingModeLocked",
        "checkpointC_branchDecision"
      ]
    },
    {
      "nodeId": "node.bookingRunner",
      "checkpoints": [
        "CHECKPOINT_9b",
        "checkpointD_bookingRunner"
      ],
      "matchSources": [
        "BOOKING_SNAP",
        "BOOKING_FLOW_RUNNER"
      ],
      "codePatterns": [
        "BookingFlowRunner"
      ]
    },
    {
      "nodeId": "node.directBookingIntentDetector",
      "checkpoints": [
        "CHECKPOINT_DIRECT_INTENT"
      ],
      "matchSources": [],
      "codePatterns": [
        "DirectBookingIntentDetector",
        "hasDirectIntent"
      ]
    },
    {
      "nodeId": "node.consentGate",
      "checkpoints": [
        "CHECKPOINT_CONSENT_CHECK"
      ],
      "matchSources": [],
      "codePatterns": [
        "shouldEnterBooking",
        "consentCheck.hasConsent"
      ]
    },
    {
      "nodeId": "node.bookingTrigger",
      "checkpoints": [
        "CHECKPOINT_BOOKING_TRIGGER"
      ],
      "matchSources": [],
      "codePatterns": [
        "bookingModeLocked = true",
        "BOOKING MODE TRIGGERED"
      ]
    },
    {
      "nodeId": "node.fastPathIntentDetector",
      "checkpoints": [
        "CHECKPOINT_9d_1"
      ],
      "matchSources": [],
      "codePatterns": [
        "fastPathTriggered",
        "fastPathKeywords"
      ]
    },
    {
      "nodeId": "node.fastPathOffer",
      "checkpoints": [
        "FAST_PATH_OFFER"
      ],
      "matchSources": [
        "FAST_PATH_BOOKING"
      ],
      "codePatterns": [
        "FAST-PATH ACTIVATED"
      ]
    },
    {
      "nodeId": "node.scenarioMatcher",
      "checkpoints": [
        "CHECKPOINT_SCENARIO_MATCH"
      ],
      "matchSources": [
        "SCENARIO_MATCH"
      ],
      "codePatterns": [
        "HybridScenarioSelector",
        "scenarioRetrieval"
      ]
    },
    {
      "nodeId": "node.scenarioResponse",
      "checkpoints": [
        "SCENARIO_RESPONSE"
      ],
      "matchSources": [
        "SCENARIO_MATCHED",
        "STATE_MACHINE",
        "RULE_BASED"
      ],
      "codePatterns": [
        "scenarioMatched",
        "fromStateMachine"
      ]
    },
    {
      "nodeId": "node.llmFallback",
      "checkpoints": [
        "CHECKPOINT_9e"
      ],
      "matchSources": [
        "LLM_FALLBACK",
        "TIER3_FALLBACK"
      ],
      "codePatterns": [
        "HybridReceptionistLLM",
        "tier3"
      ]
    },
    {
      "nodeId": "node.metaIntentDetector",
      "checkpoints": [
        "CHECKPOINT_V86_META"
      ],
      "matchSources": [
        "META_INTENT_TIER1"
      ],
      "codePatterns": [
        "metaIntentCheck",
        "META_INTENT"
      ]
    }
  ],
  "validation": {
    "unreachableNodes": [],
    "invalidEdges": [],
    "validMatchSources": [
      "SILENCE_HANDLER",
      "BOOKING_SNAP",
      "BOOKING_FLOW_RUNNER",
      "FAST_PATH_BOOKING",
      "SCENARIO_MATCH",
      "SCENARIO_MATCHED",
      "STATE_MACHINE",
      "RULE_BASED",
      "LLM_FALLBACK",
      "TIER3_FALLBACK",
      "META_INTENT_TIER1"
    ]
  }
}