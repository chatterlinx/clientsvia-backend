{
  "$schema": "CONTROL_PLANE_CONTRACT_V1",
  "version": "1.0.0",
  "description": "Platform Law: IF IT'S NOT IN THIS CONTRACT, IT DOES NOT EXIST AT RUNTIME",
  "createdAt": "2026-02-06",
  "enforcementMode": "strict",
  
  "rules": {
    "unknownKeyBehavior": "CONTROL_PLANE_VIOLATION",
    "missingRequiredKeyBehavior": "FAIL_CLOSED",
    "fallbackBehavior": "FORBIDDEN",
    "hardcodedStringBehavior": "FORBIDDEN"
  },
  
  "tabs": {
    "personality": {
      "description": "AI personality and conversation style",
      "keys": {
        "frontDesk.aiName": { "type": "string", "required": false, "default": "AI Assistant", "uiSection": "personality" },
        "frontDesk.conversationStyle": { "type": "string", "required": false, "default": "professional", "uiSection": "personality" },
        "frontDesk.styleAcknowledgments": { "type": "array", "required": false, "uiSection": "personality" },
        "frontDesk.personality.warmth": { "type": "number", "required": false, "uiSection": "personality", "min": 0, "max": 10 },
        "frontDesk.personality.speakingPace": { "type": "string", "required": false, "uiSection": "personality" },
        "frontDesk.greetingResponses": { "type": "array", "required": false, "uiSection": "personality" }
      }
    },
    
    "discoveryConsent": {
      "description": "Discovery mode and booking consent settings",
      "keys": {
        "frontDesk.discoveryConsent.forceLLMDiscovery": { "type": "boolean", "required": false, "uiSection": "discovery" },
        "frontDesk.discoveryConsent.disableScenarioAutoResponses": { "type": "boolean", "required": false, "uiSection": "discovery" },
        "frontDesk.discoveryConsent.bookingRequiresExplicitConsent": { "type": "boolean", "required": false, "default": false, "uiSection": "discovery" },
        "frontDesk.discoveryConsent.consentPhrases": { "type": "array", "required": false, "default": ["yes", "sure", "okay", "go ahead"], "uiSection": "discovery" },
        "frontDesk.discoveryConsent.autoReplyAllowedScenarioTypes": { "type": "array", "required": false, "uiSection": "discovery" }
      }
    },
    
    "detection": {
      "description": "Intent detection triggers and patterns",
      "keys": {
        "frontDesk.detectionTriggers.wantsBooking": { 
          "type": "array", 
          "required": false, 
          "default": [
            "schedule", "book", "appointment", "technician",
            "come out", "send someone", "send somebody", "get someone", "get somebody",
            "dispatch", "service call", "need someone", "need somebody",
            "can you come", "can someone come", "can a tech", "asap", "right away",
            "as soon as possible", "today if possible", "emergency",
            "help me out", "help me out here", "need help", "i need help",
            "need somebody to help", "need someone to help",
            "i need somebody to help me out", "i need someone to help me out"
          ], 
          "uiSection": "detection",
          "description": "Phrases that indicate caller wants to book/schedule service (V107: added 'help me out' variants)"
        },
        "booking.directIntentPatterns": { 
          "type": "array", 
          "required": false, 
          "default": [
            "schedule", "book", "appointment", "come out",
            "send someone", "send somebody", "get someone out", "get somebody out",
            "need a tech", "need someone out", "dispatch", "service call",
            "help me out", "need help", "somebody to help", "someone to help"
          ], 
          "uiSection": "detection",
          "description": "Direct booking intent patterns (bypass consent if matched, V107: added 'help' variants)"
        }
      }
    },
    
    "hoursAvailability": {
      "description": "Business hours and availability",
      "keys": {
        "frontDesk.businessHours": { "type": "object", "required": false, "uiSection": "hours" }
      }
    },
    
    "vocabulary": {
      "description": "Common names and stop words",
      "keys": {
        "frontDesk.commonFirstNames": { "type": "array", "required": false, "uiSection": "vocabulary" },
        "slotExtraction.nameStopWords": { "type": "object", "required": false, "uiSection": "vocabulary" },
        "slotExtraction.nameStopWords.enabled": { "type": "boolean", "required": false, "uiSection": "vocabulary" },
        "slotExtraction.nameStopWords.custom": { "type": "array", "required": false, "uiSection": "vocabulary" },
        "frontDesk.vocabulary": { "type": "object", "required": false, "uiSection": "vocabulary" }
      }
    },
    
    "bookingPrompts": {
      "description": "Booking slot configuration and prompts - THE SINGLE SOURCE OF TRUTH",
      "keys": {
        "frontDesk.bookingEnabled": { "type": "boolean", "required": false, "default": true, "uiSection": "booking-prompts" },
        "frontDesk.bookingSlots": { "type": "array", "required": false, "default": [], "uiSection": "booking-prompts" },
        "frontDesk.bookingSlots.name.confirmSpelling": { "type": "boolean", "required": false, "uiSection": "booking-prompts" },
        "booking.nameParsing": { "type": "object", "required": false, "uiSection": "booking-prompts" },
        "booking.nameParsing.acceptLastNameOnly": { "type": "boolean", "required": false, "uiSection": "booking-prompts" },
        "booking.nameParsing.lastNameOnlyPrompt": { "type": "string", "required": false, "uiSection": "booking-prompts" },
        "frontDesk.nameSpellingVariants": { "type": "object", "required": false, "uiSection": "booking-prompts" },
        "frontDesk.nameSpellingVariants.enabled": { "type": "boolean", "required": false, "uiSection": "booking-prompts" },
        "frontDesk.nameSpellingVariants.mode": { "type": "string", "required": false, "uiSection": "booking-prompts" },
        "frontDesk.nameSpellingVariants.script": { "type": "string", "required": false, "uiSection": "booking-prompts" },
        "frontDesk.nameSpellingVariants.maxAsksPerCall": { "type": "number", "required": false, "uiSection": "booking-prompts" },
        "frontDesk.nameSpellingVariants.source": { "type": "string", "required": false, "uiSection": "booking-prompts" },
        "booking.addressVerification": { "type": "object", "required": false, "uiSection": "booking-prompts" },
        "booking.addressVerification.enabled": { "type": "boolean", "required": false, "uiSection": "booking-prompts" },
        "booking.addressVerification.provider": { "type": "string", "required": false, "uiSection": "booking-prompts" },
        "booking.addressVerification.requireCity": { "type": "boolean", "required": false, "uiSection": "booking-prompts" },
        "booking.addressVerification.requireState": { "type": "boolean", "required": false, "uiSection": "booking-prompts" },
        "booking.addressVerification.requireZip": { "type": "boolean", "required": false, "uiSection": "booking-prompts" },
        "booking.addressVerification.requireUnitQuestion": { "type": "boolean", "required": false, "uiSection": "booking-prompts" },
        "booking.addressVerification.unitQuestionMode": { "type": "string", "required": false, "uiSection": "booking-prompts" },
        "booking.addressVerification.missingCityStatePrompt": { "type": "string", "required": false, "uiSection": "booking-prompts" },
        "booking.addressVerification.unitTypePrompt": { "type": "string", "required": false, "uiSection": "booking-prompts" },
        "frontDesk.confirmationRequests": { "type": "array", "required": false, "uiSection": "booking-prompts" },
        "frontDesk.bookingBehavior": { "type": "object", "required": false, "uiSection": "booking-prompts", "description": "Parent key for booking behavior settings" },
        "frontDesk.bookingBehavior.errorMessage": { "type": "string", "required": false, "uiSection": "booking-prompts", "default": "I apologize, I encountered an issue with booking. Let me connect you with someone who can help." },
        "frontDesk.bookingBehavior.notConfiguredMessage": { "type": "string", "required": false, "uiSection": "booking-prompts", "default": "I apologize, the booking system isn't fully configured yet. Let me connect you with someone who can help." },
        "frontDesk.bookingTemplates": { "type": "object", "required": false, "uiSection": "booking-prompts", "description": "Booking message templates" },
        "frontDesk.bookingPrompts": { "type": "object", "required": false, "uiSection": "booking-prompts", "description": "Booking prompts configuration" },
        "frontDesk.bookingOutcome": { "type": "object", "required": false, "uiSection": "booking-prompts", "description": "Booking outcome configuration" }
      }
    },
    
    "fastPathBooking": {
      "description": "Fast-path booking shortcuts",
      "keys": {
        "frontDesk.fastPathBooking.enabled": { "type": "boolean", "required": false, "uiSection": "booking-prompts" },
        "frontDesk.fastPathBooking.triggerKeywords": { "type": "array", "required": false, "uiSection": "booking-prompts" },
        "frontDesk.fastPathBooking.offerScript": { "type": "string", "required": false, "uiSection": "booking-prompts" }
      }
    },
    
    "escalation": {
      "description": "Human transfer and escalation settings",
      "keys": {
        "frontDesk.escalation.enabled": { "type": "boolean", "required": false, "default": true, "uiSection": "escalation" },
        "frontDesk.escalation.triggerPhrases": { "type": "array", "required": false, "uiSection": "escalation" },
        "frontDesk.escalation.transferMessage": { "type": "string", "required": false, "uiSection": "escalation" },
        "transfers.transferTargets": { "type": "array", "required": false, "uiSection": "escalation" }
      }
    },
    
    "emotions": {
      "description": "Emotional response handling",
      "keys": {
        "frontDesk.emotions": { "type": "object", "required": false, "uiSection": "emotions" }
      }
    },
    
    "frustration": {
      "description": "Frustration detection and handling",
      "keys": {
        "frontDesk.frustration": { "type": "object", "required": false, "uiSection": "frustration" }
      }
    },
    
    "forbidden": {
      "description": "Forbidden phrases and topics",
      "keys": {
        "frontDesk.forbiddenPhrases": { "type": "array", "required": false, "uiSection": "forbidden" }
      }
    },
    
    "loopPrevention": {
      "description": "Loop detection and recovery",
      "keys": {
        "frontDesk.loopPrevention": { "type": "object", "required": false, "uiSection": "loops" },
        "frontDesk.offRailsRecovery.bridgeBack.resumeBooking": { "type": "string", "required": false, "uiSection": "loops" }
      }
    },
    
    "fallbacks": {
      "description": "Fallback responses when no match",
      "keys": {
        "frontDesk.fallbackResponses": { "type": "array", "required": false, "uiSection": "fallbacks" }
      }
    },
    
    "dynamicFlows": {
      "description": "Dynamic conversation flows",
      "keys": {
        "dynamicFlow.companyFlows": { "type": "array", "required": false, "uiSection": "dynamic-flows" }
      }
    },
    
    "data": {
      "description": "Data configuration - templates, scenarios, cheat sheets",
      "keys": {
        "dataConfig.templateReferences": { "type": "array", "required": false, "uiSection": "data" },
        "dataConfig.scenarios": { "type": "array", "required": false, "uiSection": "data" },
        "dataConfig.cheatSheets": { "type": "array", "required": false, "uiSection": "data" },
        "dataConfig.placeholders": { "type": "object", "required": false, "uiSection": "data" }
      }
    },
    
    "integrations": {
      "description": "External service integrations",
      "keys": {
        "integrations.googleGeo.enabled": { "type": "boolean", "required": false, "uiSection": "integrations" },
        "integrations.googleGeo.verificationMode": { "type": "string", "required": false, "uiSection": "integrations" },
        "integrations.googleGeo.minConfidence": { "type": "number", "required": false, "uiSection": "integrations" }
      }
    },
    
    "enforcement": {
      "description": "Control Plane enforcement settings - PLATFORM LAW",
      "keys": {
        "frontDesk.enforcement": { "type": "object", "required": false, "uiSection": "enforcement", "description": "Parent key for enforcement settings" },
        "frontDesk.enforcement.strictControlPlaneOnly": { "type": "boolean", "required": false, "uiSection": "enforcement", "default": false },
        "frontDesk.enforcement.level": { "type": "string", "required": false, "uiSection": "enforcement", "default": "warn", "enum": ["warn", "strict"], "description": "warn=log violations, strict=block+fail closed" },
        "infra.strictConfigRegistry": { "type": "object", "required": false, "uiSection": "enforcement" },
        "infra.strictConfigRegistry.blockDeadReads": { "type": "boolean", "required": false, "uiSection": "enforcement" },
        "infra.strictConfigRegistry.allowlist": { "type": "array", "required": false, "uiSection": "enforcement" },
        "infra.scenarioPoolCache": { "type": "object", "required": false, "uiSection": "enforcement" }
      }
    }
  },
  
  "modeOwnership": {
    "description": "ONLY Front Desk can change these state values - LLM/scenarios can SUGGEST but not FLIP",
    "exclusiveOwner": "FrontDeskRouter",
    "protectedKeys": [
      "mode",
      "bookingModeLocked",
      "consentPending",
      "branchTaken",
      "sessionMode"
    ]
  },
  
  "failClosedBehavior": {
    "description": "What to do when Control Plane config fails to load or validate",
    "actions": {
      "CONTROL_PLANE_LOAD_FAILED": {
        "logEvent": true,
        "safeResponse": "I apologize, but I'm having a technical issue. Let me connect you with someone who can help.",
        "action": "ESCALATE_TRANSFER"
      },
      "CONTROL_PLANE_VIOLATION": {
        "logEvent": true,
        "safeResponse": "One moment please.",
        "action": "LOG_AND_CONTINUE_DEGRADED"
      },
      "MISSING_REQUIRED_KEY": {
        "logEvent": true,
        "safeResponse": "I apologize, but I'm not able to complete this right now. Let me get you some help.",
        "action": "ESCALATE_TRANSFER"
      }
    }
  },
  
  "traceRequirements": {
    "perTurn": {
      "CONTROL_PLANE_HEADER": {
        "required": true,
        "fields": ["companyId", "awHash", "effectiveConfigVersion", "controlPlaneLoaded", "resolvedFrom", "contractVersion"]
      },
      "DECISION_TRACE": {
        "required": true,
        "fields": ["keysUsed", "sourcesUsed", "decisionReasons", "modeChanges"]
      }
    }
  }
}
