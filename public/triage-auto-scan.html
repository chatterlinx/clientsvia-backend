<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Triage Builder - Auto-Scan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #111827;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    
    .header {
      text-align: center;
      color: #ffffff;
      margin-bottom: 40px;
    }
    
    .header h1 {
      font-size: 36px;
      font-weight: 800;
      margin: 0 0 10px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    
    .header p {
      font-size: 18px;
      opacity: 0.9;
      margin: 0;
    }
    
    .card {
      background: #ffffff;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      margin-bottom: 24px;
    }
    
    .status-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #ffffff;
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .stat-value {
      font-size: 48px;
      font-weight: 800;
      margin: 0;
      line-height: 1;
    }
    
    .stat-label {
      font-size: 14px;
      opacity: 0.9;
      margin-top: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .gap-indicator {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .coverage-indicator {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .action-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-top: 32px;
      flex-wrap: wrap;
    }
    
    .btn-primary {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      padding: 16px 32px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #ffffff;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
    }
    
    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .btn-secondary:hover {
      box-shadow: 0 8px 25px rgba(245, 87, 108, 0.5);
    }
    
    .progress-container {
      margin-top: 24px;
      padding: 20px;
      background: #f3f4f6;
      border-radius: 12px;
      display: none;
    }
    
    .progress-container.active {
      display: block;
    }
    
    .progress-bar-wrapper {
      background: #e5e7eb;
      height: 8px;
      border-radius: 999px;
      overflow: hidden;
      margin-bottom: 12px;
    }
    
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      transition: width 0.3s;
      width: 0%;
    }
    
    .progress-text {
      font-size: 14px;
      color: #6b7280;
      text-align: center;
    }
    
    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #ffffff;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: #ffffff;
      border-radius: 16px;
      max-width: 1000px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .modal-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #ffffff;
      padding: 24px;
      border-radius: 16px 16px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-header h2 {
      margin: 0;
      font-size: 24px;
      font-weight: 800;
    }
    
    .close-modal {
      background: rgba(255,255,255,0.2);
      border: none;
      color: #ffffff;
      font-size: 24px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .close-modal:hover {
      background: rgba(255,255,255,0.3);
      transform: rotate(90deg);
    }
    
    .modal-body {
      padding: 24px;
    }
    
    .category-section {
      margin-bottom: 32px;
    }
    
    .category-header {
      background: #f9fafb;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .category-name {
      font-size: 18px;
      font-weight: 700;
      color: #111827;
    }
    
    .category-count {
      background: #667eea;
      color: #ffffff;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 700;
    }
    
    .card-item {
      background: #ffffff;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
      transition: all 0.2s;
    }
    
    .card-item:hover {
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
    }
    
    .card-item.selected {
      border-color: #667eea;
      background: #eef2ff;
    }
    
    .card-title {
      font-size: 16px;
      font-weight: 700;
      color: #111827;
      margin: 0 0 8px;
    }
    
    .card-meta {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }
    
    .meta-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      background: #f3f4f6;
      border-radius: 6px;
      font-size: 12px;
      color: #6b7280;
    }
    
    .meta-badge i {
      font-size: 10px;
    }
    
    .keyword-list {
      margin-top: 12px;
    }
    
    .keyword-pill {
      display: inline-block;
      padding: 4px 10px;
      background: #dbeafe;
      color: #1e40af;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      margin: 2px;
    }
    
    .keyword-pill.negative {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .keyword-pill.synonym {
      background: #d1fae5;
      color: #065f46;
    }
    
    .checkbox-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #e5e7eb;
    }
    
    .checkbox-wrapper input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }
    
    .checkbox-wrapper label {
      font-size: 14px;
      font-weight: 600;
      color: #111827;
      cursor: pointer;
    }
    
    .modal-footer {
      padding: 24px;
      border-top: 2px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
    }
    
    .btn-save {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #ffffff;
      padding: 12px 32px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-save:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    }
    
    .btn-cancel {
      background: #e5e7eb;
      color: #374151;
      padding: 12px 32px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
    }
    
    .selection-summary {
      font-size: 14px;
      color: #6b7280;
    }
    
    .alert {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .alert-info {
      background: #dbeafe;
      color: #1e40af;
      border-left: 4px solid #3b82f6;
    }
    
    .alert-warning {
      background: #fef3c7;
      color: #92400e;
      border-left: 4px solid #f59e0b;
    }
    
    .alert-success {
      background: #d1fae5;
      color: #065f46;
      border-left: 4px solid #10b981;
    }
    
    .alert-error {
      background: #fee2e2;
      color: #991b1b;
      border-left: 4px solid #dc2626;
    }
    
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 24px;
      background: rgba(255,255,255,0.2);
      color: #ffffff;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 24px;
    }
    
    .back-btn:hover {
      background: rgba(255,255,255,0.3);
      border-color: rgba(255,255,255,0.5);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- HEADER -->
    <div class="header">
      <h1><i class="fas fa-robot"></i> AI Triage Builder - Auto-Scan</h1>
      <p>Automatically generate triage cards from your Brain 2 scenarios</p>
    </div>
    
    <!-- BACK BUTTON -->
    <button class="back-btn" onclick="window.location.href='/company-profile.html'">
      <i class="fas fa-arrow-left"></i> Back to Company Profile
    </button>
    
    <!-- MAIN CARD -->
    <div class="card">
      <!-- STATUS DASHBOARD -->
      <div class="status-dashboard" id="statusDashboard">
        <div class="stat-card">
          <div class="stat-value" id="scenariosCount">--</div>
          <div class="stat-label">Active Scenarios</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-value" id="cardsCount">--</div>
          <div class="stat-label">Triage Cards</div>
        </div>
        
        <div class="stat-card gap-indicator">
          <div class="stat-value" id="gapCount">--</div>
          <div class="stat-label">Scenarios Missing Cards</div>
        </div>
        
        <div class="stat-card coverage-indicator">
          <div class="stat-value" id="coveragePercent">--%</div>
          <div class="stat-label">Coverage</div>
        </div>
      </div>
      
      <!-- INFO ALERT -->
      <div class="alert alert-info">
        <i class="fas fa-info-circle"></i>
        <div>
          <strong>How Auto-Scan Works:</strong> The system reads all active scenarios from Brain 2, 
          uses LLM-A to generate keywords and routing rules, and creates organized triage cards. 
          You can review and edit before saving.
        </div>
      </div>
      
      <!-- ACTION BUTTONS -->
      <div class="action-buttons">
        <button class="btn-primary" id="fullScanBtn" onclick="startFullScan()">
          <i class="fas fa-search"></i>
          <span>Scan AiCore & Generate Cards</span>
        </button>
        
        <button class="btn-primary btn-secondary" id="rescanBtn" onclick="startRescan()">
          <i class="fas fa-sync-alt"></i>
          <span>Rescan for New Scenarios</span>
        </button>
      </div>
      
      <!-- PROGRESS CONTAINER -->
      <div class="progress-container" id="progressContainer">
        <div class="progress-bar-wrapper">
          <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="progress-text" id="progressText">Initializing...</div>
      </div>
      
      <!-- LAST SCAN INFO -->
      <div id="lastScanInfo" style="margin-top: 24px; padding: 16px; background: #f9fafb; border-radius: 8px; display: none;">
        <div style="font-size: 13px; color: #6b7280;">
          <strong>Last Scan:</strong> <span id="lastScanTime">Never</span>
        </div>
      </div>
    </div>
  </div>
  
  <!-- REVIEW MODAL -->
  <div class="modal" id="reviewModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-clipboard-check"></i> Review Generated Cards</h2>
        <button class="close-modal" onclick="closeReviewModal()">Ã—</button>
      </div>
      
      <div class="modal-body" id="modalBody">
        <!-- Dynamic content loaded here -->
      </div>
      
      <div class="modal-footer">
        <div class="selection-summary">
          <span id="selectedCount">0</span> cards selected
        </div>
        <div style="display: flex; gap: 12px;">
          <button class="btn-cancel" onclick="closeReviewModal()">Cancel</button>
          <button class="btn-save" onclick="saveSelectedCards()">
            <i class="fas fa-save"></i> Save Selected Cards
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- JAVASCRIPT -->
  <script>
    // Global state
    let currentCompanyId = null;
    let generatedCards = [];
    let selectedCardIndices = new Set();
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', async () => {
      // Get company ID from URL or localStorage
      const urlParams = new URLSearchParams(window.location.search);
      currentCompanyId = urlParams.get('companyId') || localStorage.getItem('currentCompanyId');
      
      if (!currentCompanyId) {
        showAlert('error', 'No company selected. Please go back and select a company.');
        return;
      }
      
      // Load current status
      await loadStatus();
    });
    
    // Load current status (scenarios vs cards)
    async function loadStatus() {
      try {
        const token = localStorage.getItem('adminToken');
        
        // Get scenarios count
        const scenariosResponse = await fetch(`/api/aicore/active-scenarios/${currentCompanyId}`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const scenariosData = await scenariosResponse.json();
        
        // Get existing cards count
        const cardsResponse = await fetch(`/api/admin/triage-builder/cards/${currentCompanyId}`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const cardsData = await cardsResponse.json();
        
        const scenariosCount = scenariosData.count || 0;
        const cardsCount = cardsData.cards?.length || 0;
        const gap = Math.max(0, scenariosCount - cardsCount);
        const coverage = scenariosCount > 0 ? Math.round((cardsCount / scenariosCount) * 100) : 0;
        
        // Update dashboard
        document.getElementById('scenariosCount').textContent = scenariosCount;
        document.getElementById('cardsCount').textContent = cardsCount;
        document.getElementById('gapCount').textContent = gap;
        document.getElementById('coveragePercent').textContent = coverage + '%';
        
      } catch (error) {
        console.error('[AUTO-SCAN] Failed to load status', error);
        showAlert('error', 'Failed to load status. Please refresh the page.');
      }
    }
    
    // Start full scan
    async function startFullScan() {
      if (!confirm('This will generate cards for ALL scenarios in Brain 2. Continue?')) {
        return;
      }
      
      const btn = document.getElementById('fullScanBtn');
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner"></div> Scanning...';
      
      showProgress('Starting full scan...');
      
      try {
        const token = localStorage.getItem('adminToken');
        const response = await fetch(`/api/admin/triage-builder/auto-scan/${currentCompanyId}`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        
        const data = await response.json();
        
        if (!data.ok) {
          throw new Error(data.message || 'Auto-scan failed');
        }
        
        // Success
        hideProgress();
        generatedCards = data.cards || [];
        
        showAlert('success', `Successfully generated ${generatedCards.length} cards from ${data.totalScenarios} scenarios!`);
        
        // Show review modal
        showReviewModal(data.categories || []);
        
        // Update status
        await loadStatus();
        
      } catch (error) {
        hideProgress();
        console.error('[AUTO-SCAN] Full scan failed', error);
        showAlert('error', error.message || 'Full scan failed. Please try again.');
      } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-search"></i><span>Scan AiCore & Generate Cards</span>';
      }
    }
    
    // Start rescan
    async function startRescan() {
      const btn = document.getElementById('rescanBtn');
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner"></div> Rescanning...';
      
      showProgress('Checking for new scenarios...');
      
      try {
        const token = localStorage.getItem('adminToken');
        const response = await fetch(`/api/admin/triage-builder/rescan/${currentCompanyId}`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        
        const data = await response.json();
        
        if (!data.ok) {
          throw new Error(data.message || 'Rescan failed');
        }
        
        hideProgress();
        
        if (data.newScenariosFound === 0) {
          showAlert('info', 'No new scenarios found. All scenarios already have triage cards!');
          return;
        }
        
        // Success
        generatedCards = data.newCards || [];
        
        showAlert('success', `Found ${data.newScenariosFound} new scenarios! Generated ${generatedCards.length} new cards.`);
        
        // Show review modal
        showReviewModal(data.categories || []);
        
        // Update status
        await loadStatus();
        
      } catch (error) {
        hideProgress();
        console.error('[AUTO-SCAN] Rescan failed', error);
        showAlert('error', error.message || 'Rescan failed. Please try again.');
      } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-sync-alt"></i><span>Rescan for New Scenarios</span>';
      }
    }
    
    // Show review modal
    function showReviewModal(categories) {
      const modalBody = document.getElementById('modalBody');
      
      // Select all by default
      selectedCardIndices.clear();
      generatedCards.forEach((_, index) => selectedCardIndices.add(index));
      
      // Build HTML
      let html = '';
      
      categories.forEach(category => {
        html += `
          <div class="category-section">
            <div class="category-header">
              <div class="category-name">${escapeHtml(category.categoryName)}</div>
              <div class="category-count">${category.cards.length} cards</div>
            </div>
        `;
        
        category.cards.forEach(card => {
          const cardIndex = generatedCards.findIndex(c => c.triageLabel === card.triageLabel);
          const isSelected = selectedCardIndices.has(cardIndex);
          
          html += `
            <div class="card-item ${isSelected ? 'selected' : ''}" data-card-index="${cardIndex}">
              <div class="card-title">${escapeHtml(card.displayName)}</div>
              
              <div class="card-meta">
                <span class="meta-badge"><i class="fas fa-tag"></i> ${escapeHtml(card.triageLabel)}</span>
                <span class="meta-badge"><i class="fas fa-bullseye"></i> Priority ${card.priority}</span>
                <span class="meta-badge"><i class="fas fa-link"></i> ${escapeHtml(card.linkedScenario?.scenarioKey || 'N/A')}</span>
              </div>
              
              <div class="keyword-list">
                <strong style="font-size: 12px; color: #6b7280; display: block; margin-bottom: 4px;">Keywords:</strong>
                ${(card.quickRuleConfig?.keywordsMustHave || []).map(kw => 
                  `<span class="keyword-pill">${escapeHtml(kw)}</span>`
                ).join('')}
              </div>
              
              ${(card.quickRuleConfig?.keywordsExclude || []).length > 0 ? `
                <div class="keyword-list">
                  <strong style="font-size: 12px; color: #6b7280; display: block; margin-bottom: 4px;">Negative Keywords:</strong>
                  ${card.quickRuleConfig.keywordsExclude.map(kw => 
                    `<span class="keyword-pill negative">${escapeHtml(kw)}</span>`
                  ).join('')}
                </div>
              ` : ''}
              
              ${(card.generatedSynonyms || []).length > 0 ? `
                <div class="keyword-list">
                  <strong style="font-size: 12px; color: #6b7280; display: block; margin-bottom: 4px;">Synonyms:</strong>
                  ${card.generatedSynonyms.map(syn => 
                    `<span class="keyword-pill synonym">${escapeHtml(syn)}</span>`
                  ).join('')}
                </div>
              ` : ''}
              
              <div class="checkbox-wrapper">
                <input type="checkbox" id="card-${cardIndex}" ${isSelected ? 'checked' : ''} 
                  onchange="toggleCardSelection(${cardIndex})">
                <label for="card-${cardIndex}">Include this card</label>
              </div>
            </div>
          `;
        });
        
        html += `</div>`;
      });
      
      modalBody.innerHTML = html;
      updateSelectedCount();
      
      document.getElementById('reviewModal').classList.add('active');
    }
    
    // Close review modal
    function closeReviewModal() {
      document.getElementById('reviewModal').classList.remove('active');
      selectedCardIndices.clear();
      generatedCards = [];
    }
    
    // Toggle card selection
    function toggleCardSelection(index) {
      if (selectedCardIndices.has(index)) {
        selectedCardIndices.delete(index);
      } else {
        selectedCardIndices.add(index);
      }
      
      // Update visual state
      const cardItem = document.querySelector(`[data-card-index="${index}"]`);
      if (cardItem) {
        cardItem.classList.toggle('selected', selectedCardIndices.has(index));
      }
      
      updateSelectedCount();
    }
    
    // Update selected count
    function updateSelectedCount() {
      document.getElementById('selectedCount').textContent = selectedCardIndices.size;
    }
    
    // Save selected cards
    async function saveSelectedCards() {
      if (selectedCardIndices.size === 0) {
        alert('Please select at least one card to save.');
        return;
      }
      
      if (!confirm(`Save ${selectedCardIndices.size} cards to the database?`)) {
        return;
      }
      
      try {
        const selectedCards = generatedCards.filter((_, index) => selectedCardIndices.has(index));
        
        const token = localStorage.getItem('adminToken');
        const response = await fetch(`/api/admin/triage-builder/save-batch/${currentCompanyId}`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            cards: selectedCards,
            activateAll: false
          })
        });
        
        const data = await response.json();
        
        if (!data.ok) {
          throw new Error(data.error || 'Failed to save cards');
        }
        
        showAlert('success', `Successfully saved ${data.savedCount} cards!`);
        closeReviewModal();
        
        // Update status
        await loadStatus();
        
      } catch (error) {
        console.error('[AUTO-SCAN] Save failed', error);
        showAlert('error', error.message || 'Failed to save cards. Please try again.');
      }
    }
    
    // Show progress
    function showProgress(text) {
      document.getElementById('progressContainer').classList.add('active');
      document.getElementById('progressText').textContent = text;
      document.getElementById('progressBar').style.width = '100%';
    }
    
    // Hide progress
    function hideProgress() {
      document.getElementById('progressContainer').classList.remove('active');
      document.getElementById('progressBar').style.width = '0%';
    }
    
    // Show alert
    function showAlert(type, message) {
      // Create alert element
      const alert = document.createElement('div');
      alert.className = `alert alert-${type}`;
      alert.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
        <div>${message}</div>
      `;
      
      // Insert at top of card
      const card = document.querySelector('.card');
      card.insertBefore(alert, card.firstChild);
      
      // Auto-remove after 5 seconds
      setTimeout(() => alert.remove(), 5000);
    }
    
    // Escape HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
  </script>
</body>
</html>

