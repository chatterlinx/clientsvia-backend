<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîî Notification Center - ClientsVia Admin</title>
    
    <!-- Tailwind CSS -->
    <!-- TODO: PRODUCTION - Replace CDN with bundled Tailwind via CLI/PostCSS -->
    <!-- Security: CDN should not be used in production admin panel -->
    <!-- Performance: Eliminates external runtime CSS injection -->
    <!-- See: https://tailwindcss.com/docs/installation -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/notification-center.css?v=1.0">
</head>
<body class="bg-gray-50">
    
    <!-- ====================================================================
         NAVIGATION HEADER
         ==================================================================== -->
    <nav class="bg-white shadow-md border-b-2 border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="/index.html" class="text-2xl font-bold text-blue-600">
                        ClientsVia Admin
                    </a>
                    <span class="ml-4 text-gray-400">|</span>
                    <span class="ml-4 text-lg font-semibold text-gray-700">
                        üîî Notification Center
                    </span>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/index.html" class="text-gray-600 hover:text-gray-900">
                        <i class="fas fa-home mr-2"></i>Dashboard
                    </a>
                    <button id="logout-btn" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ====================================================================
         MAIN CONTENT AREA
         ==================================================================== -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- ================================================================
             SUB-TAB NAVIGATION
             ================================================================ -->
        <div class="bg-white rounded-lg shadow-md mb-6">
            <div class="border-b border-gray-200">
                <nav class="flex space-x-8 px-6" id="subtab-nav">
                    <button class="subtab-btn active" data-subtab="dashboard">
                        <i class="fas fa-tachometer-alt mr-2"></i>
                        <span>Dashboard</span>
                    </button>
                    <button class="subtab-btn" data-subtab="registry">
                        <i class="fas fa-clipboard-list mr-2"></i>
                        <span>Alert Registry</span>
                    </button>
                    <button class="subtab-btn" data-subtab="logs">
                        <i class="fas fa-history mr-2"></i>
                        <span>Alert Log</span>
                    </button>
                    <button class="subtab-btn" data-subtab="settings">
                        <i class="fas fa-cog mr-2"></i>
                        <span>Settings</span>
                    </button>
                </nav>
            </div>
        </div>

        <!-- ================================================================
             SUB-TAB CONTENT CONTAINERS
             ================================================================ -->
        
        <!-- DASHBOARD TAB -->
        <div id="dashboard-tab" class="subtab-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                
                <!-- UNACKNOWLEDGED ALERTS CARD -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-700">Unacknowledged Alerts</h3>
                        <i class="fas fa-bell text-orange-500 text-2xl"></i>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-red-600 font-semibold">üö® Critical:</span>
                            <span id="critical-count" class="text-2xl font-bold text-red-600">-</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-yellow-600 font-semibold">‚ö†Ô∏è Warning:</span>
                            <span id="warning-count" class="text-2xl font-bold text-yellow-600">-</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-blue-600 font-semibold">‚ÑπÔ∏è Info:</span>
                            <span id="info-count" class="text-2xl font-bold text-blue-600">-</span>
                        </div>
                    </div>
                </div>

                <!-- NOTIFICATION SYSTEM STATUS CARD -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-700">System Status</h3>
                        <i class="fas fa-server text-green-500 text-2xl"></i>
                    </div>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-gray-600">Notification Points:</span>
                            <span id="registry-total" class="font-semibold">-</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-gray-600">Validated:</span>
                            <span id="registry-valid" class="font-semibold text-green-600">-</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-gray-600">Last Health Check:</span>
                            <span id="last-health-check" class="font-semibold text-sm">-</span>
                        </div>
                    </div>
                </div>

                <!-- HEALTH CHECK BUTTON CARD -->
                <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg shadow-md p-6 flex flex-col justify-center items-center">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4 text-center">Platform Health Check</h3>
                    <button id="run-health-check-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-8 rounded-lg shadow-lg transform transition hover:scale-105">
                        <i class="fas fa-heartbeat mr-2"></i>
                        RUN HEALTH CHECK
                    </button>
                    <p class="text-sm text-gray-600 mt-3 text-center">
                        Tests 10+ critical systems
                    </p>
                </div>
            </div>

            <!-- INTELLIGENCE WIDGETS -->
            <!-- ‚úÖ RE-ENABLED: Fixed redisClient export bug, Phase 3 fully operational -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">
                <!-- Service Health Widget -->
                <div id="service-health-widget">
                    <div class="bg-white rounded-lg shadow p-4 animate-pulse">
                        <div class="h-4 bg-gray-200 rounded w-3/4 mb-3"></div>
                        <div class="space-y-2">
                            <div class="h-10 bg-gray-100 rounded"></div>
                            <div class="h-10 bg-gray-100 rounded"></div>
                            <div class="h-10 bg-gray-100 rounded"></div>
                            <div class="h-10 bg-gray-100 rounded"></div>
                        </div>
                    </div>
                </div>

                <!-- Root Cause Analysis Widget -->
                <div id="root-cause-widget">
                    <div class="bg-white rounded-lg shadow p-4 animate-pulse">
                        <div class="h-4 bg-gray-200 rounded w-3/4 mb-3"></div>
                        <div class="h-20 bg-gray-100 rounded mb-2"></div>
                        <div class="h-16 bg-gray-100 rounded"></div>
                    </div>
                </div>

                <!-- Error Trends Widget -->
                <div id="error-trends-widget">
                    <div class="bg-white rounded-lg shadow p-4 animate-pulse">
                        <div class="h-4 bg-gray-200 rounded w-3/4 mb-3"></div>
                        <div class="grid grid-cols-3 gap-2 mb-4">
                            <div class="h-12 bg-gray-100 rounded"></div>
                            <div class="h-12 bg-gray-100 rounded"></div>
                            <div class="h-12 bg-gray-100 rounded"></div>
                        </div>
                        <div class="h-10 bg-gray-100 rounded mb-2"></div>
                        <div class="h-20 bg-gray-100 rounded"></div>
                    </div>
                </div>
            </div>

            <!-- RECENT ALERTS TABLE -->
            <div class="bg-white rounded-lg shadow-md p-6 mt-6">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">
                    <i class="fas fa-fire text-red-500 mr-2"></i>
                    Recent Unacknowledged Alerts
                </h3>
                <div id="recent-alerts-container">
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-3xl mb-2"></i>
                        <p>Loading alerts...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ALERT REGISTRY TAB -->
        <div id="registry-tab" class="subtab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-700">
                        <i class="fas fa-clipboard-list mr-2"></i>
                        Registered Notification Points
                    </h3>
                    <button id="validate-all-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded">
                        <i class="fas fa-check-circle mr-2"></i>
                        Validate All
                    </button>
                </div>
                <div id="registry-container">
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-3xl mb-2"></i>
                        <p>Loading registry...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ALERT LOG TAB -->
        <div id="logs-tab" class="subtab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <!-- Header with Title -->
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-2">
                        <h3 class="text-xl font-semibold text-gray-700">
                            <i class="fas fa-history mr-2"></i>
                            Alert Log
                        </h3>
                        <button onclick="document.getElementById('notification-protocol-modal').classList.remove('hidden')" 
                                class="text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-full p-1"
                                title="View Notification Protocol">
                            <i class="fas fa-info-circle text-lg"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Notification Protocol Modal -->
                <div id="notification-protocol-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-lg shadow-xl max-w-3xl w-full m-4 max-h-[90vh] overflow-auto">
                        <div class="p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-2xl font-bold text-gray-900">
                                    <i class="fas fa-book-open mr-2 text-blue-600"></i>
                                    Notification Protocol Guide
                                </h3>
                                <button onclick="document.getElementById('notification-protocol-modal').classList.add('hidden')" 
                                        class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            
                            <!-- Severity Rules Table -->
                            <div class="mb-6">
                                <h4 class="text-lg font-semibold text-gray-800 mb-3">üìä Severity Rules & Notifications</h4>
                                <table class="w-full border-collapse border border-gray-300">
                                    <thead class="bg-gray-100">
                                        <tr>
                                            <th class="border border-gray-300 px-4 py-2 text-left">Severity</th>
                                            <th class="border border-gray-300 px-4 py-2 text-center">SMS</th>
                                            <th class="border border-gray-300 px-4 py-2 text-center">Email</th>
                                            <th class="border border-gray-300 px-4 py-2 text-left">Auto-Purge</th>
                                            <th class="border border-gray-300 px-4 py-2 text-left">Action Required?</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="bg-red-50">
                                            <td class="border border-gray-300 px-4 py-3">
                                                <div class="font-bold text-red-800">üî¥ CRITICAL</div>
                                                <div class="text-xs text-gray-600">System down, DB offline, payment failures</div>
                                            </td>
                                            <td class="border border-gray-300 px-4 py-3 text-center">‚úÖ <span class="text-green-700 font-semibold">Yes</span></td>
                                            <td class="border border-gray-300 px-4 py-3 text-center">‚úÖ <span class="text-green-700 font-semibold">Yes</span></td>
                                            <td class="border border-gray-300 px-4 py-3 text-sm">
                                                <div class="font-semibold text-purple-700">90 days</div>
                                                <div class="text-xs text-gray-600">after you resolve</div>
                                            </td>
                                            <td class="border border-gray-300 px-4 py-3">
                                                <div class="font-bold text-red-700">YES</div>
                                                <div class="text-xs text-gray-600">Acknowledge & Resolve</div>
                                            </td>
                                        </tr>
                                        <tr class="bg-yellow-50">
                                            <td class="border border-gray-300 px-4 py-3">
                                                <div class="font-bold text-yellow-800">‚ö†Ô∏è WARNING</div>
                                                <div class="text-xs text-gray-600">Degraded performance, non-critical failures</div>
                                            </td>
                                            <td class="border border-gray-300 px-4 py-3 text-center">‚ùå <span class="text-gray-500">No</span></td>
                                            <td class="border border-gray-300 px-4 py-3 text-center">‚úÖ <span class="text-green-700 font-semibold">Yes</span></td>
                                            <td class="border border-gray-300 px-4 py-3 text-sm">
                                                <div class="font-semibold text-purple-700">90 days</div>
                                                <div class="text-xs text-gray-600">after you resolve</div>
                                            </td>
                                            <td class="border border-gray-300 px-4 py-3">
                                                <div class="font-bold text-yellow-700">YES</div>
                                                <div class="text-xs text-gray-600">Acknowledge & Resolve</div>
                                            </td>
                                        </tr>
                                        <tr class="bg-blue-50">
                                            <td class="border border-gray-300 px-4 py-3">
                                                <div class="font-bold text-blue-800">‚ÑπÔ∏è INFO</div>
                                                <div class="text-xs text-gray-600">Successful operations, health checks passing</div>
                                            </td>
                                            <td class="border border-gray-300 px-4 py-3 text-center">‚ùå <span class="text-gray-500">No</span></td>
                                            <td class="border border-gray-300 px-4 py-3 text-center">‚ùå <span class="text-gray-500">No</span></td>
                                            <td class="border border-gray-300 px-4 py-3 text-sm">
                                                <div class="font-semibold text-blue-700">60 days</div>
                                                <div class="text-xs text-red-600 font-semibold">auto (even if not resolved!)</div>
                                            </td>
                                            <td class="border border-gray-300 px-4 py-3">
                                                <div class="font-bold text-green-700">NO</div>
                                                <div class="text-xs text-gray-600">Just logs, auto-cleans</div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Smart Grouping Info -->
                            <div class="mb-6 p-4 bg-purple-50 border-l-4 border-purple-500 rounded">
                                <h4 class="text-lg font-semibold text-purple-900 mb-2">
                                    <i class="fas fa-layer-group mr-2"></i>
                                    Smart Alert Grouping
                                </h4>
                                <ul class="text-sm text-gray-700 space-y-1">
                                    <li><strong>üîî 2-4x:</strong> Duplicate alerts grouped (yellow badge)</li>
                                    <li><strong>üîî 5-9x:</strong> Rapid fire detected (orange badge)</li>
                                    <li><strong>üîî 10+x:</strong> HOT ALERT! (red badge + pulse animation)</li>
                                    <li><strong>üîï Notifications:</strong> Only sent on 1st, 5th, 10th, 25th, 50th occurrences (prevents spam)</li>
                                </ul>
                            </div>
                            
                            <!-- Workflow Tips -->
                            <div class="mb-4 p-4 bg-green-50 border-l-4 border-green-500 rounded">
                                <h4 class="text-lg font-semibold text-green-900 mb-2">
                                    <i class="fas fa-tasks mr-2"></i>
                                    Recommended Workflow
                                </h4>
                                <ol class="text-sm text-gray-700 space-y-1 list-decimal list-inside">
                                    <li><strong>Unresolved alerts show at top</strong> - Work on these first</li>
                                    <li><strong>Click "Acknowledge"</strong> - Stops escalation, shows you're aware</li>
                                    <li><strong>Fix the issue</strong> - Take action to resolve the problem</li>
                                    <li><strong>Click "Resolve"</strong> - Alert grays out, moves to bottom, starts 90-day purge timer</li>
                                    <li><strong>INFO alerts:</strong> Ignore them - they auto-clean in 60 days</li>
                                </ol>
                            </div>
                            
                            <div class="text-center">
                                <button onclick="document.getElementById('notification-protocol-modal').classList.add('hidden')" 
                                        class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-semibold">
                                    Got it!
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Enhanced Search Bar -->
                <div class="mb-4">
                    <div class="relative">
                        <input type="text" id="log-search-input" 
                               placeholder="üîç Search alerts by ID, code, message, company..." 
                               class="w-full border border-gray-300 rounded-lg px-4 py-3 pl-10 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <i class="fas fa-search absolute left-3 top-4 text-gray-400"></i>
                    </div>
                </div>
                
                <!-- Interactive Stats Bar -->
                <div class="mb-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg p-4 border border-gray-200">
                    <div class="flex flex-wrap gap-3 justify-center items-center">
                        <!-- Total Count -->
                        <button onclick="logManager.filterByBadge('all')" 
                                id="badge-all"
                                class="filter-badge px-4 py-2 rounded-lg font-semibold transition-all hover:scale-105 bg-gray-200 text-gray-800 border-2 border-gray-300">
                            <i class="fas fa-list mr-2"></i>
                            All: <span id="count-all">0</span>
                        </button>
                        
                        <!-- Severity Counts -->
                        <button onclick="logManager.filterByBadge('CRITICAL')" 
                                id="badge-CRITICAL"
                                class="filter-badge px-4 py-2 rounded-lg font-semibold transition-all hover:scale-105 bg-red-100 text-red-800 border-2 border-red-300">
                            <i class="fas fa-exclamation-circle mr-2"></i>
                            Critical: <span id="count-CRITICAL">0</span>
                        </button>
                        
                        <button onclick="logManager.filterByBadge('WARNING')" 
                                id="badge-WARNING"
                                class="filter-badge px-4 py-2 rounded-lg font-semibold transition-all hover:scale-105 bg-yellow-100 text-yellow-800 border-2 border-yellow-300">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            Warning: <span id="count-WARNING">0</span>
                        </button>
                        
                        <button onclick="logManager.filterByBadge('INFO')" 
                                id="badge-INFO"
                                class="filter-badge px-4 py-2 rounded-lg font-semibold transition-all hover:scale-105 bg-blue-100 text-blue-800 border-2 border-blue-300">
                            <i class="fas fa-info-circle mr-2"></i>
                            Info: <span id="count-INFO">0</span>
                        </button>
                        
                        <!-- Status Counts -->
                        <button onclick="logManager.filterByBadge('acknowledged')" 
                                id="badge-acknowledged"
                                class="filter-badge px-4 py-2 rounded-lg font-semibold transition-all hover:scale-105 bg-green-100 text-green-800 border-2 border-green-300">
                            <i class="fas fa-check-circle mr-2"></i>
                            Acknowledged: <span id="count-acknowledged">0</span>
                        </button>
                        
                        <button onclick="logManager.filterByBadge('resolved')" 
                                id="badge-resolved"
                                class="filter-badge px-4 py-2 rounded-lg font-semibold transition-all hover:scale-105 bg-purple-100 text-purple-800 border-2 border-purple-300">
                            <i class="fas fa-check-double mr-2"></i>
                            Resolved: <span id="count-resolved">0</span>
                        </button>
                    </div>
                </div>
                
                <!-- Bulk Actions Bar (hidden by default) -->
                <div id="bulk-actions-bar" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center space-x-2">
                            <input type="checkbox" id="select-all-checkbox" class="w-4 h-4 text-blue-600 rounded">
                            <span id="selected-count" class="text-sm font-semibold text-gray-700">0 selected</span>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="logManager.deleteSelected()" 
                                    class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm">
                                <i class="fas fa-trash mr-1"></i> Delete Selected
                            </button>
                            <button onclick="logManager.purgeResolved()" 
                                    class="px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 text-sm">
                                <i class="fas fa-broom mr-1"></i> Purge Resolved
                            </button>
                            <button onclick="logManager.purgeOld()" 
                                    class="px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 text-sm">
                                <i class="fas fa-calendar-minus mr-1"></i> Purge Old (90d)
                            </button>
                            <button onclick="logManager.clearAll()" 
                                    class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm font-bold">
                                <i class="fas fa-exclamation-triangle mr-1"></i> Clear All
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="logs-container">
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-3xl mb-2"></i>
                        <p>Loading logs...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SETTINGS TAB -->
        <div id="settings-tab" class="subtab-content hidden">
            
            <!-- TWILIO CREDENTIALS -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-xl font-semibold text-gray-700 mb-6">
                    <i class="fas fa-phone mr-2"></i>
                    Twilio SMS Configuration
                </h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-2 font-semibold">Account SID</label>
                        <input type="text" id="twilio-account-sid" class="border border-gray-300 rounded px-3 py-2 w-full" placeholder="AC...">
                        <p class="text-sm text-gray-500 mt-1">Your Twilio Account SID (starts with AC)</p>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-semibold">Auth Token</label>
                        <input type="password" id="twilio-auth-token" class="border border-gray-300 rounded px-3 py-2 w-full" placeholder="Enter auth token">
                        <p class="text-sm text-gray-500 mt-1">Your Twilio Auth Token (keep this secret)</p>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-semibold">Phone Number</label>
                        <input type="text" id="twilio-phone-number" class="border border-gray-300 rounded px-3 py-2 w-full" placeholder="+15551234567">
                        <p class="text-sm text-gray-500 mt-1">Your Twilio phone number (E.164 format: +1...)</p>
                    </div>
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4">
                        <p class="text-sm text-gray-700">
                            <strong>Important:</strong> After saving, configure your Twilio webhooks:
                        </p>
                        <p class="text-sm text-gray-600 mt-2">
                            <strong>SMS Webhook:</strong> <code class="bg-white px-2 py-1 rounded">https://clientsvia-backend.onrender.com/api/twilio/sms</code>
                        </p>
                        <p class="text-sm text-gray-600 mt-1">
                            <strong>Voice Webhook:</strong> <code class="bg-white px-2 py-1 rounded">https://clientsvia-backend.onrender.com/api/twilio/voice</code>
                        </p>
                        <p class="text-sm text-gray-600 mt-1">
                            <em>Note: If no company is configured for the called number, the system automatically plays the test greeting below.</em>
                        </p>
                        <p class="text-sm text-gray-600 mt-1">
                            Method: POST (for both)
                        </p>
                    </div>
                    <button id="save-twilio-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded">
                        <i class="fas fa-save mr-2"></i>
                        Save Twilio Credentials
                    </button>
                </div>
            </div>
            
            <!-- TEST CALL SYSTEM -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-xl font-semibold text-gray-700 mb-6">
                    <i class="fas fa-microphone mr-2"></i>
                    Test Call System
                </h3>
                
                <!-- ENABLE TOGGLE -->
                <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-1">Enable Test Calls</label>
                            <p class="text-sm text-gray-600">Turn ON to activate test call system</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="test-call-enabled" class="sr-only peer">
                            <div class="w-14 h-7 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-green-600"></div>
                        </label>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-2 font-semibold">Test Phone Number</label>
                        <input 
                            type="text" 
                            id="test-call-phone" 
                            class="border border-gray-300 rounded px-3 py-2 w-full" 
                            placeholder="+18885222241"
                            value="+18885222241">
                        <p class="text-sm text-gray-500 mt-1">Your Twilio phone number (E.164 format)</p>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2 font-semibold">Greeting Message</label>
                        <textarea 
                            id="test-call-greeting" 
                            rows="4" 
                            class="border border-gray-300 rounded px-3 py-2 w-full" 
                            placeholder="This is a ClientsVia system check. Your Twilio integration is working correctly..."></textarea>
                        <p class="text-sm text-gray-500 mt-1">
                            This message will be spoken when you call your Twilio number to test the system.
                        </p>
                    </div>
                    
                    <div class="bg-green-50 border-l-4 border-green-500 p-4">
                        <p class="text-sm text-gray-700">
                            <strong>üéØ To Test:</strong> Call your Twilio number: <strong>+1 (888) 522-2241</strong>
                        </p>
                        <p class="text-sm text-gray-600 mt-2">
                            You'll hear this message played back by Twilio's text-to-speech engine (Alice voice).
                        </p>
                    </div>
                    
                    <button id="save-test-call-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded">
                        <i class="fas fa-save mr-2"></i>
                        Save Test Call Settings
                    </button>
                </div>
            </div>
            
            <!-- ADMIN CONTACTS -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-700">
                        <i class="fas fa-users mr-2"></i>
                        Admin Contacts
                    </h3>
                    <button 
                        onclick="window.settingsManager.testFullSystem()"
                        class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded transition"
                        title="Send test alert to ALL contacts via SMS + Email"
                    >
                        <i class="fas fa-paper-plane mr-2"></i>
                        üß™ Test Full System (SMS + Email)
                    </button>
                </div>
                
                <!-- ADD NEW CONTACT FORM -->
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
                    <h4 class="font-semibold text-gray-700 mb-3">
                        <i class="fas fa-user-plus mr-2"></i>
                        Add New Admin Contact
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-1">Name *</label>
                            <input type="text" id="new-contact-name" class="border border-gray-300 rounded px-3 py-2 w-full" placeholder="John Doe">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-1">Phone Number (SMS) *</label>
                            <input type="tel" id="new-contact-phone" class="border border-gray-300 rounded px-3 py-2 w-full" placeholder="+15551234567">
                            <p class="text-xs text-gray-500 mt-1">E.164 format (e.g., +1 555 123 4567)</p>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Email (Optional)</label>
                        <select id="new-contact-email" class="border border-gray-300 rounded px-3 py-2 w-full">
                            <option value="">-- No Email --</option>
                            <option value="clientsvia@gmail.com">clientsvia@gmail.com</option>
                        </select>
                    </div>
                    <div class="flex items-center gap-6 mb-3">
                        <label class="flex items-center">
                            <input type="checkbox" id="new-contact-sms" checked class="mr-2">
                            <span class="text-sm">üì± Receive SMS</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="new-contact-email-notify" checked class="mr-2">
                            <span class="text-sm">üìß Receive Email</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="new-contact-calls" checked class="mr-2">
                            <span class="text-sm">üìû Receive Calls</span>
                        </label>
                    </div>
                    <button id="add-contact-btn" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded">
                        <i class="fas fa-plus mr-2"></i>
                        Add Contact
                    </button>
                </div>
                
                <!-- EXISTING CONTACTS LIST -->
                <div id="admin-contacts-list" class="space-y-3">
                    <p class="text-gray-500">Loading contacts...</p>
                </div>
            </div>
            
            <!-- NOTIFICATION POLICY (Smart Alert Management) -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-700">
                        <i class="fas fa-bell-slash mr-2"></i>
                        Notification Policy (Smart Alert Management)
                    </h3>
                    <button 
                        onclick="window.settingsManager.resetNotificationPolicy()"
                        class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded transition text-sm"
                        title="Reset all settings to recommended defaults"
                    >
                        <i class="fas fa-undo mr-2"></i>
                        Reset to Defaults
                    </button>
                </div>
                
                <p class="text-sm text-gray-600 mb-6">
                    <i class="fas fa-info-circle mr-1"></i>
                    Control which alerts generate SMS/Email notifications vs. log-only. Prevents notification spam while ensuring critical issues reach you immediately.
                </p>
                
                <!-- SEVERITY RULES -->
                <div class="mb-6">
                    <h4 class="font-semibold text-gray-700 mb-3">
                        <i class="fas fa-layer-group mr-2"></i>
                        Severity-Based Rules
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- CRITICAL -->
                        <div class="border-2 border-red-300 rounded-lg p-4 bg-red-50">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-2">üö®</span>
                                <h5 class="font-bold text-red-900">CRITICAL</h5>
                            </div>
                            <p class="text-xs text-gray-600 mb-3">System down, database offline, payment failures</p>
                            <div class="space-y-2">
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" id="policy-critical-sms" class="mr-2" checked>
                                    üì± Send SMS
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" id="policy-critical-email" class="mr-2" checked>
                                    üìß Send Email
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" id="policy-critical-logonly" class="mr-2">
                                    üìã Log Only (No Alerts)
                                </label>
                            </div>
                        </div>
                        
                        <!-- WARNING -->
                        <div class="border-2 border-yellow-300 rounded-lg p-4 bg-yellow-50">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-2">‚ö†Ô∏è</span>
                                <h5 class="font-bold text-yellow-900">WARNING</h5>
                            </div>
                            <p class="text-xs text-gray-600 mb-3">Degraded performance, non-critical failures</p>
                            <div class="space-y-2">
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" id="policy-warning-sms" class="mr-2">
                                    üì± Send SMS
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" id="policy-warning-email" class="mr-2" checked>
                                    üìß Send Email
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" id="policy-warning-logonly" class="mr-2">
                                    üìã Log Only (No Alerts)
                                </label>
                            </div>
                        </div>
                        
                        <!-- INFO -->
                        <div class="border-2 border-blue-300 rounded-lg p-4 bg-blue-50">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-2">‚ÑπÔ∏è</span>
                                <h5 class="font-bold text-blue-900">INFO</h5>
                            </div>
                            <p class="text-xs text-gray-600 mb-3">Successful operations, health checks passing</p>
                            <div class="space-y-2">
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" id="policy-info-sms" class="mr-2">
                                    üì± Send SMS
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" id="policy-info-email" class="mr-2">
                                    üìß Send Email
                                </label>
                                <label class="flex items-center text-sm">
                                    <input type="checkbox" id="policy-info-logonly" class="mr-2" checked>
                                    üìã Log Only (No Alerts)
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- DAILY DIGEST -->
                <div class="mb-6 border-t pt-6">
                    <h4 class="font-semibold text-gray-700 mb-3">
                        <i class="fas fa-calendar-day mr-2"></i>
                        Daily Health Digest
                    </h4>
                    <p class="text-xs text-gray-600 mb-4">
                        Get ONE daily email with system health, stats, and warnings. Know everything is running without being spammed.
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <label class="flex items-center text-sm">
                            <input type="checkbox" id="policy-digest-enabled" class="mr-2" checked>
                            ‚úÖ Enable Daily Digest
                        </label>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Delivery Time</label>
                            <input type="time" id="policy-digest-time" value="08:00" class="border border-gray-300 rounded px-3 py-2 w-full">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Timezone</label>
                            <select id="policy-digest-timezone" class="border border-gray-300 rounded px-3 py-2 w-full">
                                <option value="America/New_York">Eastern (ET)</option>
                                <option value="America/Chicago">Central (CT)</option>
                                <option value="America/Denver">Mountain (MT)</option>
                                <option value="America/Los_Angeles">Pacific (PT)</option>
                                <option value="America/Phoenix">Arizona (MST)</option>
                                <option value="America/Anchorage">Alaska (AKT)</option>
                                <option value="Pacific/Honolulu">Hawaii (HST)</option>
                                <option value="Europe/London">London (GMT)</option>
                                <option value="Europe/Paris">Paris (CET)</option>
                                <option value="Asia/Tokyo">Tokyo (JST)</option>
                                <option value="Asia/Shanghai">Shanghai (CST)</option>
                                <option value="Australia/Sydney">Sydney (AEDT)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- QUIET HOURS -->
                <div class="mb-6 border-t pt-6">
                    <h4 class="font-semibold text-gray-700 mb-3">
                        <i class="fas fa-moon mr-2"></i>
                        Quiet Hours (Respect Sleep)
                    </h4>
                    <p class="text-xs text-gray-600 mb-4">
                        During these hours, WARNING alerts are queued for morning. CRITICAL alerts still send immediately (configurable).
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <label class="flex items-center text-sm">
                            <input type="checkbox" id="policy-quiet-enabled" class="mr-2" checked>
                            üåô Enable Quiet Hours
                        </label>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Start Time</label>
                            <input type="time" id="policy-quiet-start" value="22:00" class="border border-gray-300 rounded px-3 py-2 w-full">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">End Time</label>
                            <input type="time" id="policy-quiet-end" value="07:00" class="border border-gray-300 rounded px-3 py-2 w-full">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Timezone</label>
                            <select id="policy-quiet-timezone" class="border border-gray-300 rounded px-3 py-2 w-full">
                                <option value="America/New_York">Eastern (ET)</option>
                                <option value="America/Chicago">Central (CT)</option>
                                <option value="America/Denver">Mountain (MT)</option>
                                <option value="America/Los_Angeles">Pacific (PT)</option>
                                <option value="America/Phoenix">Arizona (MST)</option>
                                <option value="America/Anchorage">Alaska (AKT)</option>
                                <option value="Pacific/Honolulu">Hawaii (HST)</option>
                                <option value="Europe/London">London (GMT)</option>
                                <option value="Europe/Paris">Paris (CET)</option>
                                <option value="Asia/Tokyo">Tokyo (JST)</option>
                                <option value="Asia/Shanghai">Shanghai (CST)</option>
                                <option value="Australia/Sydney">Sydney (AEDT)</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <label class="flex items-center text-sm">
                            <input type="checkbox" id="policy-quiet-allow-critical" class="mr-2" checked>
                            üö® Always send CRITICAL alerts (even during quiet hours)
                        </label>
                        <label class="flex items-center text-sm">
                            <input type="checkbox" id="policy-quiet-defer-warnings" class="mr-2" checked>
                            ‚è∞ Defer WARNING alerts to morning digest
                        </label>
                    </div>
                </div>
                
                <!-- SMART GROUPING -->
                <div class="mb-6 border-t pt-6">
                    <h4 class="font-semibold text-gray-700 mb-3">
                        <i class="fas fa-layer-group mr-2"></i>
                        Smart Grouping (Prevent Alert Storms)
                    </h4>
                    <p class="text-xs text-gray-600 mb-4">
                        Group repeated errors into ONE alert. Example: 5 SMS failures ‚Üí "üö® 5 SMS_DELIVERY_FAILURE errors in 15 minutes"
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <label class="flex items-center text-sm">
                            <input type="checkbox" id="policy-grouping-enabled" class="mr-2" checked>
                            ‚úÖ Enable Smart Grouping
                        </label>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Threshold (errors to group)</label>
                            <input type="number" id="policy-grouping-threshold" value="3" min="2" max="10" class="border border-gray-300 rounded px-3 py-2 w-full">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Time Window (minutes)</label>
                            <input type="number" id="policy-grouping-window" value="15" min="5" max="60" class="border border-gray-300 rounded px-3 py-2 w-full">
                        </div>
                    </div>
                </div>
                
                <button id="save-policy-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded transition">
                    <i class="fas fa-save mr-2"></i>
                    Save Notification Policy
                </button>
            </div>
            
            <!-- ALERT THRESHOLDS -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-xl font-semibold text-gray-700 mb-6">
                    <i class="fas fa-sliders-h mr-2"></i>
                    Alert Thresholds
                </h3>
                <p class="text-sm text-gray-600 mb-6">
                    Configure when system health alerts are triggered. Adjust these values to reduce false positives.
                </p>
                
                <!-- REDIS THRESHOLDS -->
                <div class="bg-gradient-to-r from-red-50 to-orange-50 border-l-4 border-red-500 p-6 rounded-lg mb-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-database text-red-600 mr-2"></i>
                        Redis Cache Health
                    </h4>
                    
                    <div class="space-y-4">
                        <!-- Hit Rate Threshold -->
                        <div class="bg-white p-4 rounded-lg shadow-sm">
                            <div class="flex items-center justify-between mb-2">
                                <label class="block text-gray-700 font-semibold">
                                    <i class="fas fa-bullseye text-blue-600 mr-2"></i>
                                    Cache Hit Rate Threshold (%)
                                </label>
                                <span id="hit-rate-value" class="text-2xl font-bold text-blue-600">60%</span>
                            </div>
                            <input 
                                type="range" 
                                id="redis-hit-rate-threshold" 
                                min="30" 
                                max="90" 
                                value="60" 
                                step="5"
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
                                oninput="document.getElementById('hit-rate-value').textContent = this.value + '%'"
                            >
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>30% (Lenient)</span>
                                <span>60% (Balanced)</span>
                                <span>90% (Strict)</span>
                            </div>
                            <p class="text-sm text-gray-600 mt-3">
                                <strong>Current:</strong> Alert if hit rate drops below <strong id="hit-rate-value-text">60%</strong>
                            </p>
                            <p class="text-xs text-gray-500 mt-2">
                                üí° <strong>Tip:</strong> Lower this after server restarts to avoid false alerts during cache warm-up (typically 1-2 hours).
                            </p>
                        </div>
                        
                        <!-- Memory Usage Threshold -->
                        <div class="bg-white p-4 rounded-lg shadow-sm">
                            <div class="flex items-center justify-between mb-2">
                                <label class="block text-gray-700 font-semibold">
                                    <i class="fas fa-memory text-purple-600 mr-2"></i>
                                    Memory Usage Threshold (%)
                                </label>
                                <span id="memory-value" class="text-2xl font-bold text-purple-600">85%</span>
                            </div>
                            <input 
                                type="range" 
                                id="redis-memory-threshold" 
                                min="50" 
                                max="95" 
                                value="85" 
                                step="5"
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600"
                                oninput="document.getElementById('memory-value').textContent = this.value + '%'"
                            >
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>50% (Early Warning)</span>
                                <span>85% (Standard)</span>
                                <span>95% (Critical Only)</span>
                            </div>
                            <p class="text-sm text-gray-600 mt-3">
                                <strong>Current:</strong> Alert if memory usage exceeds <strong id="memory-value-text">85%</strong>
                            </p>
                        </div>
                        
                        <!-- Response Time Threshold -->
                        <div class="bg-white p-4 rounded-lg shadow-sm">
                            <div class="flex items-center justify-between mb-2">
                                <label class="block text-gray-700 font-semibold">
                                    <i class="fas fa-stopwatch text-green-600 mr-2"></i>
                                    Response Time Threshold (ms)
                                </label>
                                <span id="latency-value" class="text-2xl font-bold text-green-600">100ms</span>
                            </div>
                            <input 
                                type="range" 
                                id="redis-latency-threshold" 
                                min="50" 
                                max="500" 
                                value="100" 
                                step="50"
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-green-600"
                                oninput="document.getElementById('latency-value').textContent = this.value + 'ms'"
                            >
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>50ms (Fast Only)</span>
                                <span>100ms (Normal)</span>
                                <span>500ms (Slow OK)</span>
                            </div>
                            <p class="text-sm text-gray-600 mt-3">
                                <strong>Current:</strong> Alert if response time exceeds <strong id="latency-value-text">100ms</strong>
                            </p>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex items-center justify-between bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div>
                            <p class="text-sm font-semibold text-gray-700">üí° Recommended After Server Restart:</p>
                            <p class="text-xs text-gray-600 mt-1">Hit Rate: 50% | Memory: 85% | Latency: 150ms</p>
                        </div>
                        <button 
                            onclick="setRecommendedThresholds()"
                            class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold py-2 px-4 rounded transition"
                        >
                            <i class="fas fa-magic mr-2"></i>
                            Use Recommended
                        </button>
                    </div>
                </div>
                
                <!-- ACTION BUTTONS -->
                <div class="flex items-center gap-4">
                    <button 
                        id="test-thresholds-btn" 
                        onclick="window.settingsManager.testThresholdConnection()"
                        class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded transition"
                    >
                        <i class="fas fa-plug mr-2"></i>
                        Test Connection
                    </button>
                    
                    <button id="save-thresholds-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded transition">
                        <i class="fas fa-save mr-2"></i>
                        Save Alert Thresholds
                    </button>
                    
                    <!-- DIAGNOSE FAILURE BUTTON -->
                    <button id="diagnose-failure-btn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md transition">
                        <i class="fas fa-stethoscope mr-2"></i>
                        Diagnose Failure
                    </button>
                </div>
                
                <!-- CRITICAL FAILURE CARD (PINNED) -->
                <div id="criticalFailureCard" style="display:none; border:1px solid #7f1d1d; background:#fff1f1; color:#400; border-radius:8px; padding:16px; margin-top:16px;">
                    <div style="font-weight:600; color:#b91c1c; display:flex; align-items:center; gap:8px; font-size:15px;">
                        <span style="font-size:16px;">‚ùå CRITICAL FAILURE DETECTED</span>
                    </div>

                    <div id="criticalSummary"
                         style="margin-top:8px; font-size:14px; font-weight:500; color:#000;">
                        <!-- Summary line here -->
                    </div>

                    <div id="criticalSource"
                         style="margin-top:4px; font-size:13px; color:#7f1d1d;">
                        <!-- Failure source tag here -->
                    </div>

                    <div style="margin-top:12px; font-size:13px; font-weight:600; color:#000;">
                        IMMEDIATE ACTIONS:
                    </div>

                    <ol id="criticalActions"
                        style="margin-top:4px; font-size:13px; color:#000; padding-left:20px;">
                        <!-- <li>...</li> gets injected -->
                    </ol>

                    <pre id="killOrderDetails"
                         style="
                            background:#1a1a1a;
                            color:#fff;
                            font-size:12px;
                            line-height:1.4;
                            padding:12px;
                            border-radius:6px;
                            max-height:260px;
                            overflow:auto;
                            margin-top:12px;
                            white-space:pre-wrap;
                            word-break:break-word;
                         ">
                    </pre>
                </div>
                
                <!-- TEST RESULT BANNER -->
                <div id="threshold-test-banner" class="hidden mt-6 p-4 rounded-lg border-l-4">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <i id="threshold-test-icon" class="text-2xl mr-3"></i>
                                <h4 id="threshold-test-title" class="text-lg font-semibold"></h4>
                            </div>
                            <p id="threshold-test-message" class="text-sm"></p>
                            <div id="threshold-test-details" class="mt-2 text-xs font-mono bg-gray-100 p-2 rounded hidden"></div>
                        </div>
                        <button onclick="document.getElementById('threshold-test-banner').classList.add('hidden')" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ESCALATION SETTINGS -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-semibold text-gray-700 mb-6">
                    <i class="fas fa-clock mr-2"></i>
                    Escalation Settings
                </h3>
                <p class="text-sm text-gray-600 mb-4">
                    Configure how often unacknowledged alerts are resent. Use comma-separated minutes.
                </p>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-2 font-semibold">CRITICAL Alert Intervals (minutes)</label>
                        <input type="text" id="critical-intervals" class="border border-gray-300 rounded px-3 py-2 w-full" placeholder="30, 30, 30, 15, 15">
                        <p class="text-sm text-gray-500 mt-1">Example: "30, 30, 30, 15, 15" = Resend every 30min (3x), then every 15min (2x)</p>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-semibold">WARNING Alert Intervals (minutes)</label>
                        <input type="text" id="warning-intervals" class="border border-gray-300 rounded px-3 py-2 w-full" placeholder="60, 60, 60">
                        <p class="text-sm text-gray-500 mt-1">Example: "60, 60, 60" = Resend every 1 hour (3x), then stop</p>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2 font-semibold">INFO Alert Intervals (minutes)</label>
                        <input type="text" id="info-intervals" class="border border-gray-300 rounded px-3 py-2 w-full" placeholder="120">
                        <p class="text-sm text-gray-500 mt-1">Example: "120" = Resend once after 2 hours (low priority)</p>
                    </div>
                    <button id="save-escalation-btn" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded">
                        <i class="fas fa-save mr-2"></i>
                        Save Escalation Settings
                    </button>
                </div>
            </div>
        </div>

    </div>

    <!-- ====================================================================
         LOADING OVERLAY
         ==================================================================== -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-8 max-w-sm">
            <div class="text-center">
                <i class="fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"></i>
                <p class="text-lg font-semibold text-gray-700" id="loading-message">Processing...</p>
            </div>
        </div>
    </div>

    <!-- ====================================================================
         JAVASCRIPT
         ==================================================================== -->
    <script src="/js/global-notification-tab-monitor.js?v=1.0"></script>
    <script src="/js/notification-center/NotificationCenterManager.js?v=1.0"></script>
    <script src="/js/notification-center/DashboardManager.js?v=1.0"></script>
    <script src="/js/notification-center/RegistryManager.js?v=1.0"></script>
    <script src="/js/notification-center/LogManager.js?v=1.0"></script>
    <script src="/js/notification-center/SettingsManager.js?v=1.0"></script>
    
    <script>
        // Initialize Notification Center on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üîî [NOTIFICATION CENTER] Page loaded, initializing...');
            
            // Check authentication
            const token = localStorage.getItem('adminToken'); // FIXED: Use adminToken (same as index.html)
            if (!token) {
                console.warn('‚ö†Ô∏è No authentication token found, redirecting to login...');
                window.location.href = '/login.html';
                return;
            }
            
            // Initialize main manager
            window.notificationCenter = new NotificationCenterManager();
            
            // Logout handler
            document.getElementById('logout-btn').addEventListener('click', () => {
                localStorage.removeItem('adminToken');
                localStorage.removeItem('adminUser');
                window.location.href = '/login.html';
            });
        });
        
        // =================================================================
        // ALERT THRESHOLDS - Helper Functions
        // =================================================================
        
        /**
         * Update text labels when slider values change
         */
        function updateSliderLabels() {
            const hitRate = document.getElementById('redis-hit-rate-threshold').value;
            const memory = document.getElementById('redis-memory-threshold').value;
            const latency = document.getElementById('redis-latency-threshold').value;
            
            document.getElementById('hit-rate-value').textContent = hitRate + '%';
            document.getElementById('hit-rate-value-text').textContent = hitRate + '%';
            
            document.getElementById('memory-value').textContent = memory + '%';
            document.getElementById('memory-value-text').textContent = memory + '%';
            
            document.getElementById('latency-value').textContent = latency + 'ms';
            document.getElementById('latency-value-text').textContent = latency + 'ms';
        }
        
        /**
         * Set recommended thresholds for after server restart
         */
        function setRecommendedThresholds() {
            document.getElementById('redis-hit-rate-threshold').value = 50;
            document.getElementById('redis-memory-threshold').value = 85;
            document.getElementById('redis-latency-threshold').value = 150;
            updateSliderLabels();
            
            // Show confirmation
            alert('‚úÖ Recommended thresholds applied!\n\n‚Ä¢ Hit Rate: 50% (lenient for warm-up)\n‚Ä¢ Memory: 85% (standard)\n‚Ä¢ Latency: 150ms (tolerant)\n\nClick "Save Alert Thresholds" to persist these settings.');
        }
        
        // Initialize labels on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateSliderLabels();
        });
    </script>
</body>
</html>

