<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent 2.0 Discovery ‚Äî Agent Console</title>
  
  <!-- Inter Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="/agent-console/styles.css">
</head>
<body>
  <div class="app-container">
    <!-- ================================================================
         HEADER ‚Äî STICKY TOP BAR
         ================================================================ -->
    <header class="header">
      <div class="header-left">
        <button class="btn btn-ghost btn-icon" id="btn-back-to-profile" title="Back to Company Profile">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13 17H16C16.5304 17 17.0391 16.7893 17.4142 16.4142C17.7893 16.0391 18 15.5304 18 15V5C18 4.46957 17.7893 3.96086 17.4142 3.58579C17.0391 3.21071 16.5304 3 16 3H13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M7 14L3 10L7 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M3 10H13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <a href="#" id="header-logo-link" class="header-logo" title="Back to Company Profile">
          <svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="32" height="32" rx="8" fill="currentColor" fill-opacity="0.1"/>
            <path d="M16 6L26 11V21L16 26L6 21V11L16 6Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M16 16V26M16 16L6 11M16 16L26 11" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
          <span class="header-logo-text">ClientVia</span>
        </a>
        <div class="header-divider"></div>
        <span class="header-title">Agent 2.0 ‚Äî Discovery</span>
      </div>
      
      <div class="header-center">
        <span class="company-name" id="header-company-name">Loading...</span>
        <span class="company-id-pill" id="header-company-id">‚Äî</span>
      </div>
      
      <div class="header-right">
        <button class="btn btn-primary" id="btn-download-truth">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8 10V2M8 10L5 7M8 10L11 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M2 13H14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          Download Truth JSON
        </button>
      </div>
    </header>

    <!-- ================================================================
         MAIN CONTENT
         ================================================================ -->
    <main class="main-content">
      <!-- Page Header -->
      <div class="page-header">
        <div class="page-header-left">
          <a href="#" class="back-button" id="btn-back">
            <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Back to Agent Console
          </a>
          <div>
            <h1 class="page-title">Agent 2.0 ‚Äî Discovery Engine</h1>
            <p class="page-subtitle">Greeting ‚Üí Intent Detection ‚Üí Summary ‚Üí Consent ‚Üí Handoff</p>
          </div>
        </div>
        <div>
          <button class="btn btn-secondary" id="btn-save-config">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12.667 14H3.333A1.333 1.333 0 0 1 2 12.667V3.333A1.333 1.333 0 0 1 3.333 2h7.334L14 5.333v7.334A1.333 1.333 0 0 1 12.667 14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M11.333 14v-4H4.667v4M4.667 2v3.333h5.333" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Save Changes
          </button>
        </div>
      </div>

      <!-- Single Column Layout ‚Äî Full Width -->
      <div class="single-column-layout-full">
        
        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             üè• CALL FLOW HEALTH MONITOR - GATEKEEPER STATUS
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             Shows the complete call flow health from Twilio ‚Üí Agent 2.0
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">üè• Call Flow Health Monitor</h2>
            <button class="btn btn-secondary btn-sm" id="btn-refresh-health">
              <svg width="14" height="14" viewBox="0 0 16 16" fill="none" style="margin-right: 4px;">
                <path d="M14 8A6 6 0 1 1 8 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M14 2v6h-6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Refresh
            </button>
          </div>
          <div class="card-body" style="padding: 12px;">
            <!-- Compact Health Status Flow -->
            <div style="display: flex; flex-direction: column; gap: 4px;">
              
              <!-- Gate 1: Twilio -->
              <div id="health-twilio" class="health-gate" style="display: flex; align-items: center; gap: 8px; padding: 6px 10px; border: 1px solid #e5e7eb; border-radius: 6px; background: #f9fafb;">
                <span style="font-size: 1rem;">üìû</span>
                <div style="flex: 1; min-width: 0;">
                  <span style="font-weight: 500; font-size: 0.8rem;">Twilio</span>
                  <span class="health-status" style="font-size: 0.7rem; color: #6b7280; margin-left: 8px;">Checking...</span>
                </div>
                <span id="health-twilio-badge" class="health-badge" style="padding: 2px 8px; border-radius: 10px; font-size: 0.65rem; font-weight: 600;">‚Äî</span>
              </div>
              
              <div style="text-align: center; color: #d1d5db; font-size: 0.7rem;">‚Üì</div>
              
              <!-- Gate 2: Spam -->
              <div id="health-spam" class="health-gate" style="display: flex; align-items: center; gap: 8px; padding: 6px 10px; border: 1px solid #e5e7eb; border-radius: 6px; background: #f9fafb;">
                <span style="font-size: 1rem;">üõ°Ô∏è</span>
                <div style="flex: 1; min-width: 0;">
                  <span style="font-weight: 500; font-size: 0.8rem;">Spam Filter</span>
                  <span class="health-status" style="font-size: 0.7rem; color: #6b7280; margin-left: 8px;">Checking...</span>
                </div>
                <span id="health-spam-badge" class="health-badge" style="padding: 2px 8px; border-radius: 10px; font-size: 0.65rem; font-weight: 600;">‚Äî</span>
              </div>
              
              <div style="text-align: center; color: #d1d5db; font-size: 0.7rem;">‚Üì</div>
              
              <!-- Gate 3: Call Start -->
              <div id="health-callstart" class="health-gate" style="display: flex; align-items: center; gap: 8px; padding: 6px 10px; border: 1px solid #e5e7eb; border-radius: 6px; background: #f9fafb;">
                <span style="font-size: 1rem;">üéôÔ∏è</span>
                <div style="flex: 1; min-width: 0;">
                  <span style="font-weight: 500; font-size: 0.8rem;">Call Start</span>
                  <span class="health-status" style="font-size: 0.7rem; color: #6b7280; margin-left: 8px;">Checking...</span>
                </div>
                <span id="health-callstart-badge" class="health-badge" style="padding: 2px 8px; border-radius: 10px; font-size: 0.65rem; font-weight: 600;">‚Äî</span>
              </div>
              
              <div style="text-align: center; color: #d1d5db; font-size: 0.7rem;">‚Üì</div>
              
              <!-- Gate 4: Interceptor -->
              <div id="health-interceptor" class="health-gate" style="display: flex; align-items: center; gap: 8px; padding: 6px 10px; border: 1px solid #e5e7eb; border-radius: 6px; background: #f9fafb;">
                <span style="font-size: 1rem;">üëã</span>
                <div style="flex: 1; min-width: 0;">
                  <span style="font-weight: 500; font-size: 0.8rem;">Interceptor</span>
                  <span class="health-status" style="font-size: 0.7rem; color: #6b7280; margin-left: 8px;">Checking...</span>
                </div>
                <span id="health-interceptor-badge" class="health-badge" style="padding: 2px 8px; border-radius: 10px; font-size: 0.65rem; font-weight: 600;">‚Äî</span>
              </div>
              
              <div style="text-align: center; color: #d1d5db; font-size: 0.7rem;">‚Üì</div>
              
              <!-- Gate 5: Voice -->
              <div id="health-elevenlabs" class="health-gate" style="display: flex; align-items: center; gap: 8px; padding: 6px 10px; border: 1px solid #e5e7eb; border-radius: 6px; background: #f9fafb;">
                <span style="font-size: 1rem;">üé§</span>
                <div style="flex: 1; min-width: 0;">
                  <span style="font-weight: 500; font-size: 0.8rem;">Voice</span>
                  <span class="health-status" style="font-size: 0.7rem; color: #6b7280; margin-left: 8px;">Checking...</span>
                </div>
                <span id="health-elevenlabs-badge" class="health-badge" style="padding: 2px 8px; border-radius: 10px; font-size: 0.65rem; font-weight: 600;">‚Äî</span>
              </div>
              
              <div style="text-align: center; color: #d1d5db; font-size: 0.7rem;">‚Üì</div>
              
              <!-- Gate 6: Triggers -->
              <div id="health-triggers" class="health-gate" style="display: flex; align-items: center; gap: 8px; padding: 6px 10px; border: 1px solid #e5e7eb; border-radius: 6px; background: #f9fafb;">
                <span style="font-size: 1rem;">üéØ</span>
                <div style="flex: 1; min-width: 0;">
                  <span style="font-weight: 500; font-size: 0.8rem;">Triggers</span>
                  <span class="health-status" style="font-size: 0.7rem; color: #6b7280; margin-left: 8px;">Checking...</span>
                </div>
                <span id="health-triggers-badge" class="health-badge" style="padding: 2px 8px; border-radius: 10px; font-size: 0.65rem; font-weight: 600;">‚Äî</span>
              </div>
              
            </div>
            
            <!-- Compact Summary -->
            <div id="health-summary" style="margin-top: 8px; padding: 8px 10px; background: #f0fdf4; border-radius: 6px; border-left: 3px solid #22c55e;">
              <span id="health-summary-text" style="font-size: 0.75rem; color: #166534;">Loading...</span>
            </div>
          </div>
        </div>

        <!-- Discovery Flow Stats -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Discovery Statistics</h2>
          </div>
          <div class="card-body">
            <div class="flex gap-4 mt-4">
              <div class="stat-box clickable" id="stat-box-triggers" title="Open Trigger Console">
                <div class="stat-box-label">Trigger Cards</div>
                <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 4px;" id="stat-trigger-group">‚Äî</div>
                <div class="stat-box-value" id="stat-trigger-cards">‚Äî</div>
              </div>
              <div class="stat-box">
                <div class="stat-box-label">Clarifiers</div>
                <div class="stat-box-value" id="stat-clarifiers">‚Äî</div>
              </div>
              <div class="stat-box">
                <div class="stat-box-label">Vocabulary</div>
                <div class="stat-box-value" id="stat-vocabulary">‚Äî</div>
              </div>
            </div>
            <div class="mt-4">
              <a href="#" id="link-trigger-console" class="btn btn-secondary">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M8 3v10M3 8h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                Manage Trigger Cards
              </a>
            </div>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             üéôÔ∏è GREETINGS SYSTEM - Agent 2.0
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             Two-phase greeting system:
             1. Call Start Greeting (outbound, before caller speaks)
             2. Greeting Interceptor (responds to short caller greetings)
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        
        <!-- Call Start Greeting -->
        <div class="card" id="card-call-start-greeting">
          <div class="card-header">
            <div style="display: flex; align-items: center; gap: 12px;">
              <h2 class="card-title" style="margin: 0;">üéôÔ∏è Call Start Greeting</h2>
              <label class="toggle-switch" style="margin: 0;">
                <input type="checkbox" id="toggle-call-start-enabled">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
          <div class="card-body">
            <p class="text-muted text-sm" style="margin-bottom: 20px;">
              First thing the agent says when the call connects (before caller speaks).
            </p>
            
            <div class="form-group">
              <label class="form-label">Greeting Text (TTS)</label>
              <textarea 
                class="form-textarea" 
                id="input-call-start-text" 
                rows="3" 
                maxlength="500"
                placeholder="Penguin Air! This is John, how can I help you?"></textarea>
              <p class="form-hint">This text will be spoken or converted to audio. Max 500 characters.</p>
            </div>
            
            <div class="form-group">
              <label class="form-label" style="display: flex; justify-content: space-between; align-items: center;">
                <span>Audio URL (optional ‚Äî if provided, plays instead of TTS)</span>
                <a href="#" id="link-elevenlabs-setup-callstart" class="btn btn-ghost btn-sm" style="font-size: 0.75rem; padding: 4px 8px;" title="Configure ElevenLabs in Company Profile">
                  <svg width="14" height="14" viewBox="0 0 16 16" fill="none" style="margin-right: 4px;">
                    <path d="M8 10a2 2 0 100-4 2 2 0 000 4z" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M13.5 8a5.5 5.5 0 01-.5 2.3l1.3 1-.8 1.4-1.5-.6a5.5 5.5 0 01-2 1.1v1.6h-1.6v-1.6a5.5 5.5 0 01-2-1.1l-1.5.6-.8-1.4 1.3-1A5.5 5.5 0 014.5 8c0-.8.2-1.6.5-2.3l-1.3-1 .8-1.4 1.5.6a5.5 5.5 0 012-1.1V1.2h1.6v1.6a5.5 5.5 0 012 1.1l1.5-.6.8 1.4-1.3 1c.3.7.5 1.5.5 2.3z" stroke="currentColor" stroke-width="1.5"/>
                  </svg>
                  Setup ElevenLabs
                </a>
              </label>
              <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                <input type="text" class="form-input" id="input-call-start-audio" placeholder="https://..." readonly style="flex: 1;">
                <button type="button" class="btn btn-secondary" id="btn-play-call-start-audio" style="padding: 8px 16px; display: none;">
                  <svg width="14" height="14" viewBox="0 0 16 16" fill="none" style="margin-right: 4px;">
                    <path d="M4 3L12 8L4 13V3Z" fill="currentColor"/>
                  </svg>
                  Play
                </button>
                <button type="button" class="btn" id="btn-generate-call-start-audio" style="background: #16a34a; color: white; padding: 8px 16px;">
                  <svg width="14" height="14" viewBox="0 0 16 16" fill="none" style="margin-right: 4px;">
                    <path d="M13.5 3.5L6 11L2.5 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Generate
                </button>
              </div>
              <p class="form-hint" id="call-start-audio-status">Optional. If provided, plays audio instead of TTS.</p>
            </div>
          </div>
        </div>

        <!-- Greeting Interceptor -->
        <div class="card" id="card-greeting-interceptor">
          <div class="card-header">
            <div style="display: flex; align-items: center; gap: 12px;">
              <h2 class="card-title" style="margin: 0;">üëã Greeting Interceptor</h2>
              <label class="toggle-switch" style="margin: 0;">
                <input type="checkbox" id="toggle-interceptor-enabled">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
          <div class="card-body">
            <p class="text-muted text-sm" style="margin-bottom: 20px;">
              Responds to short caller greetings like "hi", "good morning". Runs <strong>BEFORE</strong> trigger cards.
            </p>
            
            <!-- Short-Only Gate -->
            <div style="background: #fef3c7; border: 2px solid #f59e0b; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
              <div style="display: flex; align-items: start; gap: 10px; margin-bottom: 12px;">
                <span style="font-size: 1.25rem;">‚ö†Ô∏è</span>
                <div>
                  <strong style="color: #92400e;">Short-Only Gate (prevents hijacking real intent)</strong>
                  <p style="font-size: 0.875rem; color: #92400e; margin: 4px 0 0 0;">
                    Greeting only fires if caller input is short and contains no business keywords.
                  </p>
                </div>
              </div>
              
              <div class="form-group" style="margin-bottom: 12px;">
                <label class="form-label" style="color: #92400e;">Max Words to Qualify</label>
                <input type="number" class="form-input" id="input-max-words" min="1" max="5" value="2" style="width: 80px;">
                <p class="form-hint" style="color: #92400e;">Greeting only fires if input ‚â§ this many words</p>
              </div>
              
              <div class="form-group" style="margin-bottom: 0;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                  <input type="checkbox" id="toggle-block-intent-words" checked>
                  <strong style="color: #92400e;">Block if contains intent words</strong>
                </label>
                <p class="form-hint" style="color: #92400e; margin-left: 28px;">
                  Prevents "hi my AC is broken" from triggering a greeting response
                </p>
              </div>
            </div>
            
            <!-- Intent Words -->
            <div class="form-group">
              <label class="form-label">Intent Words (comma-separated)</label>
              <textarea 
                class="form-textarea" 
                id="input-intent-words" 
                rows="4"
                placeholder="repair, maintenance, tune-up, not cooling, no cool, no heat, leak, water, dripping..."></textarea>
              <p class="form-hint">If input contains any of these words, greeting is blocked and falls through to trigger cards</p>
            </div>
            
            <!-- Greeting Rules Table -->
            <div style="margin-top: 24px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h3 style="font-size: 1rem; font-weight: 600; margin: 0;">Greeting Rules</h3>
                <button class="btn btn-primary btn-sm" id="btn-add-greeting-rule">
                  <svg width="14" height="14" viewBox="0 0 16 16" fill="none" style="margin-right: 4px;">
                    <path d="M8 3v10M3 8h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                  </svg>
                  Add Rule
                </button>
              </div>
              
              <!-- Rules Table Header -->
              <div style="display: grid; grid-template-columns: 50px 60px 80px 1fr 1fr 100px 80px; gap: 8px; padding: 10px 16px; background: #e5e7eb; border-bottom: 2px solid #d1d5db; font-size: 0.75rem; font-weight: 700; color: #111827; text-transform: uppercase; letter-spacing: 0.05em; border-radius: 8px 8px 0 0;">
                <div>On</div>
                <div>Priority</div>
                <div>Match</div>
                <div>Triggers</div>
                <div>Response</div>
                <div>Audio</div>
                <div>Actions</div>
              </div>
              
              <!-- Rules List -->
              <div id="greeting-rules-list" style="border: 1px solid #e5e7eb; border-top: none; border-radius: 0 0 8px 8px;">
                <!-- Rules will be rendered here by JavaScript -->
                <div style="padding: 40px 20px; text-align: center; color: #6b7280;">
                  <p>No greeting rules yet. Click "Add Rule" or "Seed From Global" to get started.</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Booking Consent Phrases -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Booking Consent Phrases</h2>
          </div>
          <div class="card-body">
            <p class="form-hint mb-4">Phrases that trigger booking handoff when the caller says "yes" to scheduling.</p>
            <div class="tag-list" id="consent-phrases-list">
              <!-- Tags will be inserted here -->
            </div>
            <div class="tag-input-wrapper">
              <input type="text" class="form-input" id="input-consent-phrase" placeholder="Add a consent phrase...">
              <button class="btn btn-secondary" id="btn-add-consent-phrase">Add</button>
            </div>
          </div>
        </div>

        <!-- Escalation Phrases -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Escalation Phrases</h2>
          </div>
          <div class="card-body">
            <p class="form-hint mb-4">Phrases that trigger immediate transfer to a human operator.</p>
            <div class="tag-list" id="escalation-phrases-list">
              <!-- Tags will be inserted here -->
            </div>
            <div class="tag-input-wrapper">
              <input type="text" class="form-input" id="input-escalation-phrase" placeholder="Add an escalation phrase...">
              <button class="btn btn-secondary" id="btn-add-escalation-phrase">Add</button>
            </div>
          </div>
        </div>

        <!-- Discovery Style -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Discovery Style</h2>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label class="form-label">Acknowledgment Word</label>
              <input type="text" class="form-input max-w-200" id="input-ack-word" placeholder="Ok.">
              <p class="form-hint">Short word spoken before responses (e.g., "Ok.", "Got it.", "Sure.")</p>
            </div>
            <div class="form-group mb-0">
              <label class="form-label checkbox-label">
                <input type="checkbox" id="input-robot-challenge-enabled">
                Enable Robot Challenge Response
              </label>
              <p class="form-hint">If caller says "are you a robot?", respond with a helpful clarification.</p>
              <textarea class="form-textarea mt-2" id="input-robot-challenge-line" rows="2" placeholder="Please, I am here to help you! You can speak to me naturally..."></textarea>
            </div>
          </div>
        </div>

        <!-- Live Test Turn Panel -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">
              <span class="status-dot active"></span>
              Live Test Turn
            </h2>
          </div>
          <div class="card-body">
            <div class="test-input-group">
              <input type="text" class="form-input" id="test-input" placeholder="Type what the caller says...">
              <button class="btn btn-primary" id="btn-test-turn">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M13.5 8L3 13V3L13.5 8Z" fill="currentColor"/>
                </svg>
                Send
              </button>
            </div>
            
            <div class="test-output mt-4">
              <div class="test-output-label">Agent Reply</div>
              <div class="test-output-text empty" id="test-output-reply">Send a message to test the discovery flow...</div>
            </div>

            <div class="mt-4">
              <div class="test-output-label">Session State</div>
              <div class="json-viewer mt-2">
                <div class="json-viewer-content json-viewer-content-sm">
                  <pre id="test-session-state">{ "mode": "DISCOVERY", "turn": 0 }</pre>
                </div>
              </div>
            </div>

            <div class="mt-4">
              <div class="test-output-label">Handoff Payload Preview</div>
              <div class="json-viewer mt-2">
                <div class="json-viewer-content json-viewer-content-md">
                  <pre id="test-handoff-payload">No handoff triggered yet...</pre>
                </div>
              </div>
            </div>

            <div class="trace-log">
              <pre id="test-trace-log">[Trace log will appear here during testing]</pre>
            </div>

            <div class="flex justify-between mt-4">
              <button class="btn btn-ghost btn-sm" id="btn-reset-session">
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M13 7C13 10.3137 10.3137 13 7 13C3.68629 13 1 10.3137 1 7C1 3.68629 3.68629 1 7 1C9.22222 1 11.1684 2.21309 12.1892 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                  <path d="M10 4H12.5V1.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Reset Session
              </button>
              <button class="btn btn-secondary btn-sm" id="btn-generate-payload">
                Generate Sample Payload
              </button>
            </div>
          </div>
        </div>

        <!-- Handoff Contract Reference -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Handoff Contract (AC1)</h2>
          </div>
          <div class="card-body">
            <p class="form-hint">When booking consent is detected, Agent 2.0 builds this payload and hands off to Booking Logic:</p>
            <div class="json-viewer mt-4">
              <div class="json-viewer-content json-viewer-content-lg">
                <pre id="handoff-contract-example">{
  "handoffContractVersion": "AC1",
  "companyId": "...",
  "callSid": "...",
  "fromPhone": "+1...",
  "assumptions": {
    "firstName": "...",
    "lastName": "..."
  },
  "summary": {
    "issue": "...",
    "serviceType": "...",
    "urgency": "routine|urgent|emergency"
  }
}</pre>
              </div>
            </div>
          </div>
        </div>

      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <span>Agent Console v1.0.0</span>
      <span> ¬∑ </span>
      <span>Agent 2.0 Discovery Engine</span>
    </footer>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       üéôÔ∏è GREETING RULE MODAL - Add/Edit Greeting Rule
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="modal-backdrop" id="modal-greeting-rule">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="greeting-rule-modal-title">Add Greeting Rule</h2>
        <button class="btn btn-ghost btn-icon" id="btn-close-greeting-rule-modal">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        
        <!-- Rule ID (hidden field, auto-generated) -->
        <input type="hidden" id="input-rule-id-edit">
        
        <!-- Priority -->
        <div class="form-group">
          <label class="form-label">Priority</label>
          <input type="number" class="form-input" id="input-rule-priority" min="1" max="1000" value="50" placeholder="50">
          <p class="form-hint">Higher priority rules are matched first (1-1000)</p>
        </div>
        
        <!-- Match Type -->
        <div class="form-group">
          <label class="form-label">Match Type</label>
          <select class="form-input" id="input-rule-match-type">
            <option value="EXACT">EXACT - Exact phrase match</option>
            <option value="FUZZY">FUZZY - Similar words (hi matches hey, hello, hiya)</option>
            <option value="CONTAINS">CONTAINS - Input contains trigger</option>
            <option value="REGEX">REGEX - Advanced pattern (use carefully)</option>
          </select>
          <p class="form-hint">FUZZY is recommended for greetings - handles variations like "hi", "hey", "hiya" automatically</p>
        </div>
        
        <!-- Triggers -->
        <div class="form-group">
          <label class="form-label">Triggers (comma-separated) *</label>
          <input type="text" class="form-input" id="input-rule-triggers" placeholder="hi, hello, hey">
          <p class="form-hint">Phrases that will trigger this greeting. Separate multiple triggers with commas.</p>
        </div>
        
        <!-- Response -->
        <div class="form-group">
          <label class="form-label">Response *</label>
          <textarea class="form-textarea" id="input-rule-response" rows="3" maxlength="300" placeholder="Hi! How can I help you today?"></textarea>
          <p class="form-hint">What the agent says when this rule matches. Max 300 characters.</p>
        </div>
        
        <!-- Audio URL -->
        <div class="form-group">
          <label class="form-label">Audio URL (optional ‚Äî plays instead of TTS if provided)</label>
          <div style="display: flex; gap: 8px; margin-bottom: 8px;">
            <input type="text" class="form-input" id="input-rule-audio" placeholder="Generated audio will appear here..." readonly style="flex: 1;">
            <button type="button" class="btn btn-secondary" id="btn-play-rule-audio" style="padding: 8px 16px; display: none;">
              <svg width="14" height="14" viewBox="0 0 16 16" fill="none" style="margin-right: 4px;">
                <path d="M4 3L12 8L4 13V3Z" fill="currentColor"/>
              </svg>
              Play
            </button>
            <button type="button" class="btn" id="btn-generate-rule-audio" style="background: #16a34a; color: white; padding: 8px 16px;">
              <svg width="14" height="14" viewBox="0 0 16 16" fill="none" style="margin-right: 4px;">
                <path d="M13.5 3.5L6 11L2.5 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Generate
            </button>
          </div>
          <p class="form-hint" id="rule-audio-status">Save the rule first, then generate audio.</p>
        </div>
        
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btn-cancel-greeting-rule">Cancel</button>
        <button class="btn btn-primary" id="btn-save-greeting-rule">Save Rule</button>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script src="/agent-console/lib/auth.js"></script>
  <script src="/agent-console/agent2.js"></script>
</body>
</html>
