<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Calendar — Agent Console</title>
  
  <!-- Inter Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="/agent-console/styles.css">
</head>
<body>
  <div class="app-container">
    <!-- ================================================================
         HEADER
         ================================================================ -->
    <header class="header">
      <div class="header-left">
        <div class="header-logo">
          <svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="32" height="32" rx="8" fill="currentColor" fill-opacity="0.1"/>
            <path d="M16 6L26 11V21L16 26L6 21V11L16 6Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M16 16V26M16 16L6 11M16 16L26 11" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
          <span class="header-logo-text">ClientVia</span>
        </div>
        <div class="header-divider"></div>
        <span class="header-title">Google Calendar</span>
      </div>
      
      <div class="header-center">
        <span class="company-name" id="header-company-name">Loading...</span>
        <span class="company-id-pill" id="header-company-id">—</span>
      </div>
      
      <div class="header-right">
        <button class="btn btn-primary" id="btn-download-truth">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8 10V2M8 10L5 7M8 10L11 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M2 13H14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          Download Truth JSON
        </button>
      </div>
    </header>

    <!-- ================================================================
         MAIN CONTENT
         ================================================================ -->
    <main class="main-content">
      <!-- Page Header -->
      <div class="page-header">
        <div class="page-header-left">
          <a href="#" class="back-button" id="btn-back">
            <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Back to Agent Console
          </a>
          <div>
            <h1 class="page-title">Google Calendar Integration</h1>
            <p class="page-subtitle">Connect + verify availability for Booking Logic</p>
          </div>
        </div>
      </div>

      <!-- ═══════════════════════════════════════════════════════════════
           SINGLE-PAGE LAYOUT — CLEAN CARD-BASED DESIGN (FULL WIDTH)
           ═══════════════════════════════════════════════════════════════ -->
      <div class="single-column-layout-full">
        
        <!-- ───────────────────────────────────────────────────────────
             CARD: Connection Status
             ─────────────────────────────────────────────────────────── -->
        <div class="card">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Connection Status</h2>
              <span class="badge" id="badge-connection-status">Checking...</span>
            </div>
            <div class="card-body">
              <!-- Connected State -->
              <div id="state-connected" class="hidden">
                <div class="flex items-center gap-4 mb-4">
                  <div class="icon-box icon-box-success">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                      <path d="M8 12L11 15L16 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </div>
                  <div>
                    <div class="font-semibold">Google Calendar Connected</div>
                    <div class="text-sm text-muted" id="connected-email">—</div>
                  </div>
                </div>
                
                <div class="flex gap-4 mb-4">
                  <div class="stat-box">
                    <div class="stat-box-label">Connected At</div>
                    <div class="text-sm font-medium" id="connected-at">—</div>
                  </div>
                  <div class="stat-box">
                    <div class="stat-box-label">Calendar</div>
                    <div class="text-sm font-medium" id="connected-calendar">—</div>
                  </div>
                </div>
                
                <div class="flex gap-2">
                  <button class="btn btn-secondary" id="btn-test-connection">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                      <path d="M13 7C13 10.3137 10.3137 13 7 13C3.68629 13 1 10.3137 1 7C1 3.68629 3.68629 1 7 1C9.22222 1 11.1684 2.21309 12.1892 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                      <path d="M10 4H12.5V1.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Test Connection
                  </button>
                  <button class="btn btn-danger" id="btn-disconnect">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                      <path d="M6 6L10 10M10 6L6 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                      <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    Disconnect
                  </button>
                </div>
              </div>
              
              <!-- Disconnected State -->
              <div id="state-disconnected">
                <div class="flex items-center gap-4 mb-4">
                  <div class="icon-box icon-box-warning">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                      <path d="M3 10H21" stroke="currentColor" stroke-width="2"/>
                      <path d="M8 2V6M16 2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                  </div>
                  <div>
                    <div class="font-semibold">Calendar Not Connected</div>
                    <div class="text-sm text-muted">Connect to enable real-time availability</div>
                  </div>
                </div>
                
                <p class="text-sm text-muted mb-4">
                  Without a connected calendar, Booking Logic cannot offer real appointment times.
                  Callers will receive preference capture instead of actual bookings.
                </p>
                
                <button class="btn btn-primary" id="btn-connect">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                  </svg>
                  Connect Google Calendar
                </button>
              </div>
              
              <!-- Error State -->
              <div id="state-error" class="hidden">
                <div class="flex items-center gap-4 mb-4">
                  <div class="icon-box" style="background: var(--color-error-50); color: var(--color-error-600);">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                      <path d="M12 8V12M12 16V16.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                  </div>
                  <div>
                    <div class="font-semibold">Connection Error</div>
                    <div class="text-sm text-muted" id="error-message">Unknown error</div>
                  </div>
                </div>
                
                <button class="btn btn-secondary" id="btn-retry">
                  Retry Connection
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- ───────────────────────────────────────────────────────────
             CARD: Primary Calendar Selection
             ─────────────────────────────────────────────────────────── -->
        <div class="card" id="card-calendar-selection">
            <div class="card-header">
              <h2 class="card-title">Primary Calendar</h2>
            </div>
            <div class="card-body">
              <div class="form-group mb-0">
                <label class="form-label">Select Calendar</label>
                <select class="form-select" id="select-calendar">
                  <option value="">Loading calendars...</option>
                </select>
                <p class="form-hint">This calendar will be used for availability and booking events.</p>
              </div>
              
              <button class="btn btn-primary mt-4" id="btn-save-calendar">
                Save Selection
              </button>
            </div>
          </div>
        </div>

        <!-- ───────────────────────────────────────────────────────────
             CARD: Test Availability
             ─────────────────────────────────────────────────────────── -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">
              <span class="status-dot" id="availability-status-dot"></span>
              Test Availability
            </h2>
          </div>
          <div class="card-body">
              <p class="text-sm text-muted mb-4">
                Preview what time options Booking Logic will offer to callers.
              </p>
              
              <div class="form-group">
                <label class="form-label">Start Date</label>
                <input type="date" class="form-input" id="input-start-date">
              </div>
              
              <div class="form-group">
                <label class="form-label">Duration (minutes)</label>
                <select class="form-select" id="input-duration">
                  <option value="30">30 minutes</option>
                  <option value="60" selected>60 minutes (1 hour)</option>
                  <option value="90">90 minutes</option>
                  <option value="120">120 minutes (2 hours)</option>
                </select>
              </div>
              
              <button class="btn btn-primary btn-lg" id="btn-preview-availability" style="width: 100%;">
                Preview Available Time Options
              </button>
              
              <div class="mt-4">
                <div class="test-output-label">Available Time Options</div>
                <div id="availability-results" class="mt-2">
                  <p class="text-muted text-sm">Connect calendar and click preview to see available times.</p>
                </div>
              </div>
              
              <div class="mt-4">
                <div class="test-output-label">Raw Response</div>
                <div class="json-viewer mt-2">
                  <div class="json-viewer-content json-viewer-content-md">
                    <pre id="availability-json">{ "status": "waiting" }</pre>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ───────────────────────────────────────────────────────────
             CARD: Booking Logic Integration
             ─────────────────────────────────────────────────────────── -->
        <div class="card">
            <div class="card-header">
              <h2 class="card-title">Booking Logic Integration</h2>
            </div>
            <div class="card-body">
              <p class="text-sm text-muted mb-4">
                When connected, Booking Logic will call the calendar service to get real time options instead of mock data.
              </p>
              <div class="text-xs text-muted" style="font-family: monospace; background: var(--color-gray-50); padding: var(--space-3); border-radius: var(--radius-md);">
                CalendarService.findAvailableTimeOptions(companyId, constraints)
                <br>→ returns availableTimeOptions[]
              </div>
            </div>
          </div>
        </div>

      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <span>Agent Console v1.0.0</span>
      <span> · </span>
      <span>Google Calendar Integration</span>
    </footer>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>
  </div>

  <!-- JavaScript -->
  <script src="/agent-console/lib/auth.js"></script>
  <script src="/agent-console/calendar.js"></script>
</body>
</html>
