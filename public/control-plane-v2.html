<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ClientsVia Control Plane</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CLEAN SWEEP ARCHITECTURE - December 2025
       Single Source of Truth: Dynamic Flow â†’ All Routing
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    :root {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-card: #ffffff;
      --text-primary: #f8fafc;
      --text-secondary: #94a3b8;
      --text-dark: #1e293b;
      --accent-orange: #f97316;
      --accent-blue: #3b82f6;
      --accent-green: #10b981;
      --accent-purple: #8b5cf6;
      --accent-cyan: #06b6d4;
      --border-subtle: #334155;
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, var(--bg-primary) 0%, #1a1f35 100%);
      color: var(--text-primary);
      min-height: 100vh;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOP HEADER BAR
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .top-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 24px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-subtle);
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .btn-back {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 18px;
      border-radius: 10px;
      border: 2px solid var(--accent-blue);
      background: var(--accent-blue);
      color: white;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-back:hover {
      background: #2563eb;
      transform: translateY(-1px);
    }
    
    .page-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .btn-test {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 10px;
      border: 2px solid var(--accent-green);
      background: linear-gradient(135deg, #059669, var(--accent-green));
      color: white;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }
    
    .btn-test:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
    }
    
    .btn-black-box {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 10px;
      border: 2px solid var(--accent-orange);
      background: var(--accent-orange);
      color: white;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.2s;
    }
    
    .btn-black-box:hover {
      background: #ea580c;
      transform: translateY(-1px);
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAIN NAVIGATION - FLAT, SINGLE-LEVEL
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .main-nav {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 12px 24px;
      background: var(--bg-secondary);
      border-bottom: 2px solid var(--border-subtle);
      overflow-x: auto;
    }
    
    .nav-tab {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      border-radius: 10px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }
    
    .nav-tab:hover {
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-primary);
    }
    
    .nav-tab.active {
      background: var(--accent-orange);
      color: white;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
    }
    
    .nav-tab i {
      font-size: 16px;
    }
    
    .nav-divider {
      width: 1px;
      height: 24px;
      background: var(--border-subtle);
      margin: 0 8px;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CONTENT AREA
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .content-area {
      padding: 24px;
      min-height: calc(100vh - 140px);
    }
    
    .tab-panel {
      display: none;
    }
    
    .tab-panel.active {
      display: block;
    }
    
    .card {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-md);
      color: var(--text-dark);
    }
    
    .card h2 {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text-dark);
    }
    
    .card .muted {
      color: #64748b;
      font-size: 14px;
      margin-bottom: 16px;
    }
    
    /* Loading spinner */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 80px 20px;
      color: #64748b;
    }
    
    .loading-container i {
      font-size: 48px;
      margin-bottom: 20px;
      color: var(--accent-orange);
    }
    
    .loading-container p {
      font-size: 16px;
      font-weight: 500;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FLOW TREE VISUALIZATION
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .flow-tree-container {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      border-radius: 16px;
      padding: 24px;
      min-height: 600px;
      color: var(--text-primary);
    }
    
    .flow-tree-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-subtle);
    }
    
    .flow-tree-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .flow-tree-title h2 {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
    }
    
    .flow-tree-title .icon {
      font-size: 32px;
    }
    
    .flow-tree-status {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: rgba(16, 185, 129, 0.2);
      border-radius: 20px;
      color: var(--accent-green);
      font-weight: 600;
      font-size: 14px;
    }
    
    .tree-node {
      display: flex;
      flex-direction: column;
      margin-left: 24px;
      position: relative;
    }
    
    .tree-node::before {
      content: '';
      position: absolute;
      left: -16px;
      top: 0;
      bottom: 20px;
      width: 2px;
      background: var(--border-subtle);
    }
    
    .tree-item {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      padding: 16px;
      margin: 8px 0;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      border-left: 4px solid var(--accent-blue);
      position: relative;
    }
    
    .tree-item::before {
      content: '';
      position: absolute;
      left: -20px;
      top: 24px;
      width: 16px;
      height: 2px;
      background: var(--border-subtle);
    }
    
    .tree-item.active {
      border-left-color: var(--accent-green);
      background: rgba(16, 185, 129, 0.1);
    }
    
    .tree-item.triggered {
      border-left-color: var(--accent-orange);
      background: rgba(249, 115, 22, 0.1);
    }
    
    .tree-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-secondary);
      border-radius: 10px;
      font-size: 20px;
    }
    
    .tree-content {
      flex: 1;
    }
    
    .tree-content h4 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .tree-content p {
      font-size: 13px;
      color: var(--text-secondary);
      margin: 0;
    }
    
    .tree-meta {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }
    
    .meta-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .meta-badge.success {
      background: rgba(16, 185, 129, 0.2);
      color: var(--accent-green);
    }
    
    .meta-badge.warning {
      background: rgba(249, 115, 22, 0.2);
      color: var(--accent-orange);
    }
    
    /* Data boxes for live call memory */
    .data-boxes {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 24px;
    }
    
    .data-box {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 16px;
      border: 1px solid var(--border-subtle);
    }
    
    .data-box-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    
    .data-box-title {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
    }
    
    .data-box-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .data-box-value.empty {
      color: var(--text-secondary);
      font-style: italic;
      font-weight: 400;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BUTTONS & FORMS
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 18px;
      border-radius: 8px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-primary {
      background: var(--accent-blue);
      color: white;
    }
    
    .btn-primary:hover {
      background: #2563eb;
    }
    
    .btn-secondary {
      background: #e2e8f0;
      color: var(--text-dark);
    }
    
    .btn-secondary:hover {
      background: #cbd5e1;
    }
    
    .btn-danger {
      background: #dc2626;
      color: white;
    }
    
    .btn-danger:hover {
      background: #b91c1c;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TABLES
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
      font-size: 14px;
    }
    
    table th {
      background: #f8fafc;
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid #e2e8f0;
      color: var(--text-dark);
    }
    
    table td {
      padding: 12px 16px;
      border-bottom: 1px solid #f1f5f9;
      color: var(--text-dark);
    }
    
    table tr:hover {
      background: #f8fafc;
    }
    
    /* Status badges */
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status-active {
      background: #d1fae5;
      color: #059669;
    }
    
    .status-inactive {
      background: #fee2e2;
      color: #dc2626;
    }
    
    .status-pending {
      background: #fef3c7;
      color: #d97706;
    }
  </style>
</head>
<body>
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOP HEADER
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <header class="top-header">
    <div class="header-left">
      <button class="btn-back" onclick="goBackToProfile()">
        <i class="fas fa-arrow-left"></i>
        <span>Back to Profile</span>
      </button>
      <h1 class="page-title">ğŸ›ï¸ Control Plane</h1>
    </div>
    <div class="header-right">
      <button class="btn-test" onclick="openAITestConsole()">
        <i class="fas fa-phone-volume"></i>
        <span>ğŸ§ª Test Agent</span>
      </button>
      <a href="#" class="btn-black-box" onclick="openBlackBox(); return false;">
        <span>ğŸ“¼</span>
        <span>Black Box</span>
      </a>
    </div>
  </header>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAIN NAVIGATION - SINGLE LEVEL, FLAT STRUCTURE
       Final Navigation: Front Desk | Flow Tree | Dynamic Flow | Call Protection | 
                        Transfer Calls | Call Center | Company Contacts | Links | Version History
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <nav class="main-nav">
    <button class="nav-tab active" data-tab="front-desk">
      <i class="fas fa-concierge-bell"></i>
      <span>Front Desk</span>
    </button>
    <button class="nav-tab" data-tab="flow-tree">
      <i class="fas fa-project-diagram"></i>
      <span>Flow Tree</span>
    </button>
    <button class="nav-tab" data-tab="dynamic-flow">
      <i class="fas fa-code-branch"></i>
      <span>Dynamic Flow</span>
    </button>
    
    <div class="nav-divider"></div>
    
    <button class="nav-tab" data-tab="call-protection">
      <i class="fas fa-shield-alt"></i>
      <span>Call Protection</span>
    </button>
    <button class="nav-tab" data-tab="transfer-calls">
      <i class="fas fa-phone-alt"></i>
      <span>Transfer Calls</span>
    </button>
    
    <div class="nav-divider"></div>
    
    <button class="nav-tab" data-tab="call-center" onclick="openCallCenter(); return false;">
      <i class="fas fa-headset"></i>
      <span>Call Center</span>
    </button>
    <button class="nav-tab" data-tab="company-contacts">
      <i class="fas fa-address-book"></i>
      <span>Company Contacts</span>
    </button>
    <button class="nav-tab" data-tab="links">
      <i class="fas fa-link"></i>
      <span>Links</span>
    </button>
    
    <div class="nav-divider"></div>
    
    <button class="nav-tab" data-tab="version-history">
      <i class="fas fa-history"></i>
      <span>Version History</span>
    </button>
  </nav>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CONTENT PANELS
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <main class="content-area">
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         FRONT DESK - The Config Brain
         Greeting rules, tone, confirmation, policy guardrails, booking fields,
         escalation preferences, quick answers
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel active" data-panel="front-desk">
      <div class="card">
        <div id="front-desk-container">
          <div class="loading-container">
            <i class="fas fa-concierge-bell fa-spin"></i>
            <p>Loading Front Desk Configuration...</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         FLOW TREE - Live AI Decision Visualization
         Real-time understanding of how AI agent operates during calls
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" data-panel="flow-tree">
      <div class="flow-tree-container">
        <div class="flow-tree-header">
          <div class="flow-tree-title">
            <span class="icon">ğŸŒ³</span>
            <h2>AI Decision Flow Tree</h2>
          </div>
          <div class="flow-tree-status">
            <i class="fas fa-circle"></i>
            <span>Ready</span>
          </div>
        </div>
        
        <div id="flow-tree-content">
          <!-- Static visualization - will be populated dynamically during live calls -->
          <div class="tree-node">
            <!-- Call Start -->
            <div class="tree-item active">
              <div class="tree-icon">ğŸ“</div>
              <div class="tree-content">
                <h4>Call Arrives</h4>
                <p>Incoming call detected, initializing AI agent</p>
                <div class="tree-meta">
                  <span class="meta-badge success">âœ“ Connected</span>
                </div>
              </div>
            </div>
            
            <!-- Call Protection -->
            <div class="tree-node">
              <div class="tree-item">
                <div class="tree-icon">ğŸ›¡ï¸</div>
                <div class="tree-content">
                  <h4>Call Protection</h4>
                  <p>Pre-answer filters: spam detection, IVR detection, abuse protection</p>
                  <div class="tree-meta">
                    <span class="meta-badge">Spam Check</span>
                    <span class="meta-badge">IVR Detection</span>
                    <span class="meta-badge">Machine Detection</span>
                  </div>
                </div>
              </div>
              
              <!-- Dynamic Flow Router -->
              <div class="tree-node">
                <div class="tree-item">
                  <div class="tree-icon">ğŸ”€</div>
                  <div class="tree-content">
                    <h4>Dynamic Flow Router</h4>
                    <p>Single source of truth for all routing decisions</p>
                    <div class="tree-meta">
                      <span class="meta-badge">Priority-based</span>
                      <span class="meta-badge">Trigger matching</span>
                    </div>
                  </div>
                </div>
                
                <!-- Flow Nodes (populated from Dynamic Flows) -->
                <div class="tree-node" id="dynamic-flows-tree">
                  <div class="tree-item" style="border-left-color: #f97316;">
                    <div class="tree-icon">âš¡</div>
                    <div class="tree-content">
                      <h4>Emergency Service</h4>
                      <p>Trigger: "no heat", "no air", "emergency"</p>
                      <div class="tree-meta">
                        <span class="meta-badge warning">Priority: 200</span>
                        <span class="meta-badge">â†’ Booking</span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="tree-item" style="border-left-color: #3b82f6;">
                    <div class="tree-icon">ğŸ“…</div>
                    <div class="tree-content">
                      <h4>Booking Intent</h4>
                      <p>Trigger: "schedule", "appointment", "book"</p>
                      <div class="tree-meta">
                        <span class="meta-badge">Priority: 100</span>
                        <span class="meta-badge">â†’ Booking</span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="tree-item" style="border-left-color: #8b5cf6;">
                    <div class="tree-icon">â“</div>
                    <div class="tree-content">
                      <h4>General Inquiry</h4>
                      <p>Trigger: "question", "information", "help"</p>
                      <div class="tree-meta">
                        <span class="meta-badge">Priority: 50</span>
                        <span class="meta-badge">â†’ Discovery</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Action Handler -->
                <div class="tree-item">
                  <div class="tree-icon">âš™ï¸</div>
                  <div class="tree-content">
                    <h4>Action Handler</h4>
                    <p>Transfer / Booking / Message / KB / Escalation</p>
                    <div class="tree-meta">
                      <span class="meta-badge">Target: Booking Engine</span>
                    </div>
                  </div>
                </div>
                
                <!-- LLM Fallback -->
                <div class="tree-item" style="opacity: 0.6;">
                  <div class="tree-icon">ğŸ¤–</div>
                  <div class="tree-content">
                    <h4>LLM Fallback</h4>
                    <p>Last resort only - when no flow matches</p>
                    <div class="tree-meta">
                      <span class="meta-badge">$0.50/use</span>
                      <span class="meta-badge">Target: &lt;1%</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Live Call Memory Boxes -->
          <h3 style="margin-top: 32px; margin-bottom: 16px; font-size: 16px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">
            ğŸ“Š Live Call Memory (Populates During Calls)
          </h3>
          <div class="data-boxes">
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Caller Name</span>
              </div>
              <div class="data-box-value empty">Not collected</div>
            </div>
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Phone Number</span>
              </div>
              <div class="data-box-value empty">Not collected</div>
            </div>
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Service Type</span>
              </div>
              <div class="data-box-value empty">Not detected</div>
            </div>
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Urgency</span>
              </div>
              <div class="data-box-value empty">Not assessed</div>
            </div>
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Trigger Matched</span>
              </div>
              <div class="data-box-value empty">Awaiting call</div>
            </div>
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Match Score</span>
              </div>
              <div class="data-box-value empty">â€”</div>
            </div>
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Flow Priority</span>
              </div>
              <div class="data-box-value empty">â€”</div>
            </div>
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Action Taken</span>
              </div>
              <div class="data-box-value empty">â€”</div>
            </div>
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Booking Status</span>
              </div>
              <div class="data-box-value empty">â€”</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         DYNAMIC FLOW - The ONLY Routing Brain
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" data-panel="dynamic-flow">
      <div class="card">
        <div id="dynamic-flow-container">
          <div class="loading-container">
            <i class="fas fa-code-branch fa-spin"></i>
            <p>Loading Dynamic Flow Configuration...</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         CALL PROTECTION (formerly Edge Cases)
         Pre-DFLOW filters: Spam, IVR, Machine, Silence, Abuse
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" data-panel="call-protection">
      <div class="card">
        <h2>ğŸ›¡ï¸ Call Protection</h2>
        <p class="muted">Pre-answer filters that execute BEFORE Dynamic Flow. Cannot route â€” only short-circuit or pass forward.</p>
        <div id="call-protection-container">
          <!-- CheatSheetManager will render Edge Cases here -->
          <div id="cheatsheet-subtab-edge-cases">
            <div id="edge-cases-section" class="bg-white rounded-lg p-6">
              <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:16px;">
                <div>
                  <h4 style="font-size: 16px; font-weight: 600; color: #111827; margin:0;">
                    <i class="fas fa-exclamation-triangle" style="margin-right:6px; color:#f59e0b;"></i>Edge Cases
                  </h4>
                  <p style="font-size: 12px; color:#6b7280; margin-top:4px;">
                    Edge cases short-circuit everything else. Use for spam, IVR detection, wrong number, etc.
                  </p>
                </div>
                <button type="button" data-cheatsheet-action="add-edge-case" style="padding:8px 14px; border-radius:8px; border:none; background:#f59e0b; color:#fff; font-size:13px; font-weight:600; display:flex; align-items:center; gap:6px;">
                  <i class="fas fa-plus"></i>Add Edge Case
                </button>
              </div>
              <div id="edge-cases-list" style="display:flex; flex-direction:column; gap:12px;">
                <div class="loading-container">
                  <i class="fas fa-shield-alt fa-spin"></i>
                  <p>Loading Call Protection Settings...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         TRANSFER CALLS - Transfer Target Directory
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" data-panel="transfer-calls">
      <div class="card">
        <h2>ğŸ“ Transfer Calls</h2>
        <p class="muted">Transfer target directory. DFLOW references transferTargetId. Defines destination, availability, and pre-transfer script.</p>
        <div id="transfer-calls-container">
          <!-- CheatSheetManager will render Transfer Rules here -->
          <div id="cheatsheet-subtab-transfer-calls">
            <div id="transfer-rules-section" class="bg-white rounded-lg p-6">
              <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:16px;">
                <div>
                  <h4 style="font-size: 16px; font-weight: 600; color: #111827; margin:0;">
                    <i class="fas fa-phone" style="margin-right:6px; color:#2563eb;"></i>Transfer Rules
                  </h4>
                  <p style="font-size: 12px; color:#6b7280; margin-top:4px;">
                    Transfer rules route calls to specific departments or people based on intent.
                  </p>
                </div>
                <button type="button" data-cheatsheet-action="add-transfer-rule" style="padding:8px 14px; border-radius:8px; border:none; background:#2563eb; color:#fff; font-size:13px; font-weight:600; display:flex; align-items:center; gap:6px;">
                  <i class="fas fa-plus"></i>Add Transfer Rule
                </button>
              </div>
              <div id="transfer-rules-list" style="display:flex; flex-direction:column; gap:12px;">
                <div class="loading-container">
                  <i class="fas fa-phone-alt fa-spin"></i>
                  <p>Loading Transfer Directory...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         COMPANY CONTACTS - Directory of humans for escalation
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" data-panel="company-contacts">
      <div class="card">
        <h2>ğŸ“‹ Company Contacts</h2>
        <p class="muted">Directory of humans AI can escalate or notify. Used by transfers, escalations, and notifications.</p>
        <div id="company-contacts-container">
          <!-- CheatSheetManager will render Company Contacts here -->
          <div id="cheatsheet-v2-dynamic-content" data-section="company-contacts" style="background: #fff; border-radius: 12px; min-height: 200px;">
            <div class="loading-container">
              <i class="fas fa-address-book fa-spin"></i>
              <p>Loading Company Contacts...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         LINKS - Outbound customer delivery
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" data-panel="links">
      <div class="card">
        <h2>ğŸ”— Links</h2>
        <p class="muted">Outbound customer delivery: payments, forms, financing. DFLOW actions may reference linkId.</p>
        <div id="links-container">
          <!-- CheatSheetManager will render Links here -->
          <div id="cheatsheet-v2-links-content" data-section="links" style="background: #fff; border-radius: 12px; min-height: 200px;">
            <div class="loading-container">
              <i class="fas fa-link fa-spin"></i>
              <p>Loading Links...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         VERSION HISTORY - Front Desk Configuration versioning
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" data-panel="version-history">
      <div class="card">
        <h2>ğŸ“š Version History</h2>
        <p class="muted">Versioning for Front Desk Configuration. Isolate LIVE vs DRAFT safely during calls.</p>
        <div id="version-history-container">
          <!-- CheatSheetManager will render Version History here -->
          <div id="cheatsheet-v2-version-content" data-section="version-history" style="background: #fff; border-radius: 12px; min-height: 200px;">
            <div class="loading-container">
              <i class="fas fa-history fa-spin"></i>
              <p>Loading Version History...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
  </main>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       JAVASCRIPT
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // GLOBAL STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const currentCompanyId = new URLSearchParams(window.location.search).get('companyId') || null;
    const authToken = localStorage.getItem('adminToken');
    const API_BASE = '';
    
    // Track initialized managers
    const initializedTabs = new Set();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // NAVIGATION FUNCTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function goBackToProfile() {
      if (currentCompanyId) {
        window.location.href = `/company-profile.html?id=${currentCompanyId}#ai-agent-settings`;
      } else {
        window.location.href = '/admin-directory.html';
      }
    }
    
    function openCallCenter() {
      if (!currentCompanyId) {
        alert('No company ID found.');
        return;
      }
      window.open(`/call-center.html?companyId=${currentCompanyId}`, '_blank');
    }
    
    function openBlackBox() {
      if (!currentCompanyId) {
        alert('No company ID found.');
        return;
      }
      window.open(`/black-box.html?companyId=${currentCompanyId}`, '_blank');
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LAZY SCRIPT LOADER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const loadedScripts = new Set();
    
    function loadScript(src) {
      return new Promise((resolve, reject) => {
        if (loadedScripts.has(src)) {
          resolve();
          return;
        }
        
        console.log(`ğŸ“¦ [LAZY LOAD] Loading: ${src}`);
        const script = document.createElement('script');
        script.src = src;
        script.onload = () => {
          loadedScripts.add(src);
          console.log(`âœ… [LAZY LOAD] Loaded: ${src}`);
          resolve();
        };
        script.onerror = () => {
          console.error(`âŒ [LAZY LOAD] Failed: ${src}`);
          reject(new Error(`Failed to load: ${src}`));
        };
        document.body.appendChild(script);
      });
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TAB SWITCHING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function switchTab(tabId) {
      console.log(`ğŸ¯ [NAV] Switching to: ${tabId}`);
      
      // Update nav buttons
      document.querySelectorAll('.nav-tab').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-tab') === tabId);
      });
      
      // Update panels
      document.querySelectorAll('.tab-panel').forEach(panel => {
        panel.classList.toggle('active', panel.getAttribute('data-panel') === tabId);
      });
      
      // Initialize tab content if not already done
      initializeTab(tabId);
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TAB INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initializeTab(tabId) {
      if (initializedTabs.has(tabId)) return;
      if (!currentCompanyId) {
        console.error('No companyId provided');
        return;
      }
      
      try {
        switch (tabId) {
          case 'front-desk':
            await initFrontDesk();
            break;
          case 'flow-tree':
            await initFlowTree();
            break;
          case 'dynamic-flow':
            await initDynamicFlow();
            break;
          case 'call-protection':
            await initCallProtection();
            break;
          case 'transfer-calls':
            await initTransferCalls();
            break;
          case 'company-contacts':
            await initCompanyContacts();
            break;
          case 'links':
            await initLinks();
            break;
          case 'version-history':
            await initVersionHistory();
            break;
        }
        initializedTabs.add(tabId);
      } catch (error) {
        console.error(`âŒ [INIT] Failed to initialize ${tabId}:`, error);
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FRONT DESK INITIALIZATION
    // Uses existing FrontDeskBehaviorManager
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initFrontDesk() {
      console.log('ğŸ¢ [INIT] Initializing Front Desk...');
      await loadScript('/js/ai-agent-settings/FrontDeskBehaviorManager.js');
      
      const container = document.getElementById('front-desk-container');
      if (container && window.FrontDeskBehaviorManager) {
        window.frontDeskManager = new window.FrontDeskBehaviorManager(currentCompanyId);
        await window.frontDeskManager.load();
        window.frontDeskManager.render(container);
        console.log('âœ… [INIT] Front Desk initialized');
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FLOW TREE INITIALIZATION
    // Live visualization of AI decision flow
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initFlowTree() {
      console.log('ğŸŒ³ [INIT] Initializing Flow Tree...');
      // Flow Tree is static visualization for now
      // Will be populated dynamically during live calls via WebSocket
      
      // Load company's dynamic flows to populate the tree
      try {
        const response = await fetch(`/api/company/${currentCompanyId}/dynamic-flows`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (response.ok) {
          const data = await response.json();
          if (data.flows && data.flows.length > 0) {
            renderFlowTreeNodes(data.flows);
          }
        }
      } catch (error) {
        console.error('Failed to load flows for tree:', error);
      }
      
      console.log('âœ… [INIT] Flow Tree initialized');
    }
    
    function renderFlowTreeNodes(flows) {
      const container = document.getElementById('dynamic-flows-tree');
      if (!container) return;
      
      // Sort by priority descending
      const sortedFlows = flows.sort((a, b) => (b.priority || 0) - (a.priority || 0));
      
      container.innerHTML = sortedFlows.map(flow => {
        const triggerPhrases = flow.trigger?.phrases?.slice(0, 3).join('", "') || 'No triggers';
        const priority = flow.priority || 0;
        const actions = flow.actions?.map(a => a.type).join(', ') || 'No actions';
        
        // Color based on priority
        let borderColor = '#8b5cf6'; // Default purple
        if (priority >= 200) borderColor = '#dc2626'; // Red for emergency
        else if (priority >= 100) borderColor = '#f97316'; // Orange for high
        else if (priority >= 50) borderColor = '#3b82f6'; // Blue for medium
        
        return `
          <div class="tree-item" style="border-left-color: ${borderColor};">
            <div class="tree-icon">${flow.isActive ? 'âœ…' : 'â¸ï¸'}</div>
            <div class="tree-content">
              <h4>${flow.name || flow.flowKey || 'Unnamed Flow'}</h4>
              <p>Trigger: "${triggerPhrases}"</p>
              <div class="tree-meta">
                <span class="meta-badge ${priority >= 100 ? 'warning' : ''}">Priority: ${priority}</span>
                <span class="meta-badge">â†’ ${actions}</span>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DYNAMIC FLOW INITIALIZATION
    // Renders the Dynamic Flows tab from FrontDeskBehaviorManager
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initDynamicFlow() {
      console.log('ğŸ”€ [INIT] Initializing Dynamic Flow...');
      
      // Ensure FrontDeskBehaviorManager is loaded
      if (!window.frontDeskManager) {
        await loadScript('/js/ai-agent-settings/FrontDeskBehaviorManager.js');
        window.frontDeskManager = new window.FrontDeskBehaviorManager(currentCompanyId);
        await window.frontDeskManager.load();
      }
      
      const container = document.getElementById('dynamic-flow-container');
      if (container && window.frontDeskManager) {
        // Render just the Dynamic Flows tab content
        container.innerHTML = window.frontDeskManager.renderDynamicFlowsTab();
        window.frontDeskManager.initDynamicFlowsTab();
        console.log('âœ… [INIT] Dynamic Flow initialized');
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CALL PROTECTION INITIALIZATION (formerly Edge Cases)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initCallProtection() {
      console.log('ğŸ›¡ï¸ [INIT] Initializing Call Protection...');
      
      await loadScript('/js/ai-agent-settings/CheatSheetVersioningAdapter.js');
      await loadScript('/js/ai-agent-settings/CheatSheetManager.js');
      
      if (window.cheatSheetManager) {
        if (window.cheatSheetManager.companyId !== currentCompanyId) {
          await window.cheatSheetManager.load(currentCompanyId);
        }
        
        // Attach action handlers for Add Edge Case button
        const container = document.getElementById('call-protection-container');
        if (container) {
          container.addEventListener('click', (e) => {
            const actionBtn = e.target.closest('[data-cheatsheet-action]');
            if (actionBtn && actionBtn.getAttribute('data-cheatsheet-action') === 'add-edge-case') {
              e.preventDefault();
              window.cheatSheetManager.addEdgeCase();
            }
          });
        }
        
        window.cheatSheetManager.renderEdgeCases();
        console.log('âœ… [INIT] Call Protection initialized');
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TRANSFER CALLS INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initTransferCalls() {
      console.log('ğŸ“ [INIT] Initializing Transfer Calls...');
      
      await loadScript('/js/ai-agent-settings/CheatSheetVersioningAdapter.js');
      await loadScript('/js/ai-agent-settings/CheatSheetManager.js');
      
      if (window.cheatSheetManager) {
        if (window.cheatSheetManager.companyId !== currentCompanyId) {
          await window.cheatSheetManager.load(currentCompanyId);
        }
        
        // Attach action handlers for Add Transfer Rule button
        const container = document.getElementById('transfer-calls-container');
        if (container) {
          container.addEventListener('click', (e) => {
            const actionBtn = e.target.closest('[data-cheatsheet-action]');
            if (actionBtn && actionBtn.getAttribute('data-cheatsheet-action') === 'add-transfer-rule') {
              e.preventDefault();
              window.cheatSheetManager.addTransferRule();
            }
          });
        }
        
        window.cheatSheetManager.renderTransferRules();
        console.log('âœ… [INIT] Transfer Calls initialized');
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // COMPANY CONTACTS INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initCompanyContacts() {
      console.log('ğŸ“‹ [INIT] Initializing Company Contacts...');
      
      await loadScript('/js/ai-agent-settings/CheatSheetVersioningAdapter.js');
      await loadScript('/js/ai-agent-settings/CheatSheetManager.js');
      
      if (window.cheatSheetManager) {
        if (window.cheatSheetManager.companyId !== currentCompanyId) {
          await window.cheatSheetManager.load(currentCompanyId);
        }
        
        // renderCompanyContacts expects #cheatsheet-v2-dynamic-content
        window.cheatSheetManager.renderCompanyContacts();
        console.log('âœ… [INIT] Company Contacts initialized');
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LINKS INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initLinks() {
      console.log('ğŸ”— [INIT] Initializing Links...');
      
      await loadScript('/js/ai-agent-settings/CheatSheetVersioningAdapter.js');
      await loadScript('/js/ai-agent-settings/CheatSheetManager.js');
      
      if (window.cheatSheetManager) {
        if (window.cheatSheetManager.companyId !== currentCompanyId) {
          await window.cheatSheetManager.load(currentCompanyId);
        }
        
        // Links needs its own container - update cheatSheetManager to render there
        const linksContainer = document.getElementById('cheatsheet-v2-links-content');
        if (linksContainer) {
          // Temporarily override the container lookup for links
          window.cheatSheetManager.renderLinksToContainer(linksContainer);
        }
        console.log('âœ… [INIT] Links initialized');
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // VERSION HISTORY INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initVersionHistory() {
      console.log('ğŸ“š [INIT] Initializing Version History...');
      
      await loadScript('/js/ai-agent-settings/CheatSheetVersioningAdapter.js');
      await loadScript('/js/ai-agent-settings/CheatSheetManager.js');
      
      if (window.cheatSheetManager) {
        if (window.cheatSheetManager.companyId !== currentCompanyId) {
          await window.cheatSheetManager.load(currentCompanyId);
        }
        
        // Version history needs its own container
        const versionContainer = document.getElementById('cheatsheet-v2-version-content');
        if (versionContainer) {
          window.cheatSheetManager.renderVersionHistoryToContainer(versionContainer);
        }
        console.log('âœ… [INIT] Version History initialized');
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // AI TEST CONSOLE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function openAITestConsole() {
      if (!currentCompanyId) {
        alert('Please select a company first');
        return;
      }
      
      if (!window.AITestConsole) {
        await loadScript('/js/ai-agent-settings/AITestConsole.js');
      }
      
      const testConsole = new window.AITestConsole(currentCompanyId);
      testConsole.open();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // EVENT LISTENERS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    document.addEventListener('DOMContentLoaded', () => {
      // Wire up nav tabs
      document.querySelectorAll('.nav-tab').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const tabId = btn.getAttribute('data-tab');
          // Skip for Call Center (opens in new tab)
          if (tabId === 'call-center') return;
          switchTab(tabId);
        });
      });
      
      // Auto-initialize Front Desk (default tab)
      if (currentCompanyId) {
        initializeTab('front-desk');
      } else {
        document.getElementById('front-desk-container').innerHTML = `
          <div style="padding: 60px; text-align: center; color: #ef4444;">
            <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 16px;"></i>
            <h3>No Company Selected</h3>
            <p>Please add ?companyId=... to the URL</p>
          </div>
        `;
      }
    });
    
    console.log('âœ… [CONTROL PLANE] Clean Architecture loaded - Dec 2025');
  </script>
</body>
</html>
