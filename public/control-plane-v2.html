<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ClientsVia Control Plane</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Tailwind CSS for AiCoreTemplatesManager and AiCoreLiveScenariosManager -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CLEAN SWEEP ARCHITECTURE - December 2025
       Single Source of Truth: Dynamic Flow â†’ All Routing
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    :root {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-card: #ffffff;
      --text-primary: #f8fafc;
      --text-secondary: #94a3b8;
      --text-dark: #1e293b;
      --accent-orange: #f97316;
      --accent-blue: #3b82f6;
      --accent-green: #10b981;
      --accent-purple: #8b5cf6;
      --accent-cyan: #06b6d4;
      --border-subtle: #334155;
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, var(--bg-primary) 0%, #1a1f35 100%);
      color: var(--text-primary);
      min-height: 100vh;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOP HEADER BAR
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .top-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 24px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-subtle);
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .btn-back {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 18px;
      border-radius: 10px;
      border: 2px solid var(--accent-blue);
      background: var(--accent-blue);
      color: white;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-back:hover {
      background: #2563eb;
      transform: translateY(-1px);
    }
    
    .page-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    /* Platform JSON Button */
    .btn-json {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    
    .btn-json:hover {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    
    .json-badge-score {
      background: rgba(255,255,255,0.2);
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 700;
    }
    
    .json-badge-score.green { background: #10b981; }
    .json-badge-score.yellow { background: #f59e0b; }
    .json-badge-score.red { background: #ef4444; }
    
    /* Platform Snapshot Modal */
    .snapshot-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(4px);
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .snapshot-modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .snapshot-modal {
      background: white;
      border-radius: 16px;
      width: 95%;
      max-width: 1200px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
      transform: scale(0.95) translateY(20px);
      transition: transform 0.3s ease;
    }
    
    .snapshot-modal-overlay.active .snapshot-modal {
      transform: scale(1) translateY(0);
    }
    
    .snapshot-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid #e2e8f0;
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      border-radius: 16px 16px 0 0;
      color: white;
    }
    
    .snapshot-modal-title {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .snapshot-status-badge {
      padding: 6px 16px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 14px;
    }
    
    .snapshot-status-badge.green { background: #10b981; color: white; }
    .snapshot-status-badge.yellow { background: #f59e0b; color: white; }
    .snapshot-status-badge.red { background: #ef4444; color: white; }
    
    .snapshot-modal-controls {
      display: flex;
      gap: 12px;
    }
    
    .snapshot-modal-body {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .snapshot-scope-selector {
      padding: 16px 24px;
      background: #f8fafc;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      align-items: center;
      gap: 24px;
    }
    
    .snapshot-scope-label {
      font-weight: 600;
      color: #475569;
    }
    
    .snapshot-scope-options {
      display: flex;
      gap: 12px;
    }
    
    .snapshot-scope-options label {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      padding: 6px 12px;
      border-radius: 6px;
      background: white;
      border: 1px solid #e2e8f0;
      transition: all 0.2s;
    }
    
    .snapshot-scope-options label:has(input:checked) {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }
    
    .snapshot-scope-options input[type="radio"] {
      display: none;
    }
    
    .snapshot-json-container {
      flex: 1;
      overflow: auto;
      background: #0d1117;
      position: relative;
    }
    
    .snapshot-json-pre {
      margin: 0;
      padding: 24px;
      color: #c9d1d9;
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
      font-size: 12px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-break: break-word;
    }
    
    .snapshot-penalties-panel {
      padding: 16px 24px;
      background: #fef3c7;
      border-top: 1px solid #fcd34d;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .snapshot-penalties-panel.red { background: #fee2e2; border-color: #fca5a5; }
    .snapshot-penalties-panel.green { background: #d1fae5; border-color: #6ee7b7; }
    
    .snapshot-modal-footer {
      padding: 16px 24px;
      border-top: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f8fafc;
      border-radius: 0 0 16px 16px;
    }
    
    .btn-test {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 10px;
      border: 2px solid var(--accent-green);
      background: linear-gradient(135deg, #059669, var(--accent-green));
      color: white;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }
    
    .btn-test:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
    }
    
    .btn-black-box {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 10px;
      border: 2px solid var(--accent-orange);
      background: var(--accent-orange);
      color: white;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.2s;
    }
    
    .btn-black-box:hover {
      background: #ea580c;
      transform: translateY(-1px);
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAIN NAVIGATION - FLAT, SINGLE-LEVEL
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .main-nav {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 12px 24px;
      background: var(--bg-secondary);
      border-bottom: 2px solid var(--border-subtle);
      overflow-x: auto;
    }
    
    .nav-tab {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      border-radius: 10px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }
    
    .nav-tab:hover {
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-primary);
    }
    
    .nav-tab.active {
      background: var(--accent-orange);
      color: white;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
    }
    
    .nav-tab i {
      font-size: 16px;
    }
    
    .nav-divider {
      width: 1px;
      height: 24px;
      background: var(--border-subtle);
      margin: 0 8px;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CONTENT AREA
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .content-area {
      padding: 24px;
      min-height: calc(100vh - 140px);
    }
    
    .tab-panel {
      display: none;
    }
    
    .tab-panel.active {
      display: block;
    }
    
    .card {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-md);
      color: var(--text-dark);
    }
    
    .card h2 {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text-dark);
    }
    
    .card .muted {
      color: #64748b;
      font-size: 14px;
      margin-bottom: 16px;
    }
    
    /* Loading spinner */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 80px 20px;
      color: #64748b;
    }
    
    .loading-container i {
      font-size: 48px;
      margin-bottom: 20px;
      color: var(--accent-orange);
    }
    
    .loading-container p {
      font-size: 16px;
      font-weight: 500;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FLOW TREE VISUALIZATION
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .flow-tree-container {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      border-radius: 16px;
      padding: 24px;
      min-height: 600px;
      color: var(--text-primary);
    }
    
    .flow-tree-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-subtle);
    }
    
    .flow-tree-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .flow-tree-title h2 {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
    }
    
    .flow-tree-title .icon {
      font-size: 32px;
    }
    
    .flow-tree-status {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: rgba(16, 185, 129, 0.2);
      border-radius: 20px;
      color: var(--accent-green);
      font-weight: 600;
      font-size: 14px;
    }
    
    .tree-node {
      display: flex;
      flex-direction: column;
      margin-left: 24px;
      position: relative;
    }
    
    .tree-node::before {
      content: '';
      position: absolute;
      left: -16px;
      top: 0;
      bottom: 20px;
      width: 2px;
      background: var(--border-subtle);
    }
    
    .tree-item {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      padding: 16px;
      margin: 8px 0;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      border-left: 4px solid var(--accent-blue);
      position: relative;
    }
    
    .tree-item::before {
      content: '';
      position: absolute;
      left: -20px;
      top: 24px;
      width: 16px;
      height: 2px;
      background: var(--border-subtle);
    }
    
    .tree-item.active {
      border-left-color: var(--accent-green);
      background: rgba(16, 185, 129, 0.1);
    }
    
    .tree-item.triggered {
      border-left-color: var(--accent-orange);
      background: rgba(249, 115, 22, 0.1);
    }
    
    .tree-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-secondary);
      border-radius: 10px;
      font-size: 20px;
    }
    
    .tree-content {
      flex: 1;
    }
    
    .tree-content h4 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .tree-content p {
      font-size: 13px;
      color: var(--text-secondary);
      margin: 0;
    }
    
    .tree-meta {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }
    
    .meta-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .meta-badge.success {
      background: rgba(16, 185, 129, 0.2);
      color: var(--accent-green);
    }
    
    .meta-badge.warning {
      background: rgba(249, 115, 22, 0.2);
      color: var(--accent-orange);
    }
    
    /* Data boxes for live call memory */
    .data-boxes {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 24px;
    }
    
    .data-box {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 16px;
      border: 1px solid var(--border-subtle);
    }
    
    .data-box-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    
    .data-box-title {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
    }
    
    .data-box-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .data-box-value.empty {
      color: var(--text-secondary);
      font-style: italic;
      font-weight: 400;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BUTTONS & FORMS
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 18px;
      border-radius: 8px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-primary {
      background: var(--accent-blue);
      color: white;
    }
    
    .btn-primary:hover {
      background: #2563eb;
    }
    
    .btn-secondary {
      background: #e2e8f0;
      color: var(--text-dark);
    }
    
    .btn-secondary:hover {
      background: #cbd5e1;
    }
    
    .btn-danger {
      background: #dc2626;
      color: white;
    }
    
    .btn-danger:hover {
      background: #b91c1c;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TABLES
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
      font-size: 14px;
    }
    
    table th {
      background: #f8fafc;
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid #e2e8f0;
      color: var(--text-dark);
    }
    
    table td {
      padding: 12px 16px;
      border-bottom: 1px solid #f1f5f9;
      color: var(--text-dark);
    }
    
    table tr:hover {
      background: #f8fafc;
    }
    
    /* Status badges */
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status-active {
      background: #d1fae5;
      color: #059669;
    }
    
    .status-inactive {
      background: #fee2e2;
      color: #dc2626;
    }
    
    .status-pending {
      background: #fef3c7;
      color: #d97706;
    }
  </style>
</head>
<body>
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOP HEADER
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <header class="top-header">
    <div class="header-left">
      <button class="btn-back" onclick="goBackToProfile()">
      <i class="fas fa-arrow-left"></i>
      <span>Back to Profile</span>
    </button>
      <h1 class="page-title">ğŸ›ï¸ Control Plane</h1>
    </div>
    <div class="header-right">
      <!-- ğŸ“„ PLATFORM SNAPSHOT BUTTON (Enterprise Introspection) -->
      <button id="btn-platform-json" class="btn-json" onclick="openPlatformSnapshotModal()">
        <span id="json-badge-emoji">ğŸ“„</span>
        <span>JSON</span>
        <span id="json-badge-score" class="json-badge-score"></span>
      </button>
      <button class="btn-test" onclick="openAITestConsole()">
        <i class="fas fa-phone-volume"></i>
        <span>ğŸ§ª Test Agent</span>
      </button>
      <a href="#" class="btn-black-box" onclick="openBlackBox(); return false;">
        <span>ğŸ“¼</span>
        <span>Black Box</span>
      </a>
    </div>
  </header>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAIN NAVIGATION - SINGLE LEVEL, FLAT STRUCTURE
       Final Navigation: Front Desk | Flow Tree | Dynamic Flow | Call Protection | 
                        Transfer Calls | Call Center | Company Contacts | Links | Version History
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <nav class="main-nav">
    <button class="nav-tab active" data-tab="front-desk">
      <i class="fas fa-concierge-bell"></i>
      <span>Front Desk</span>
    </button>
    <button class="nav-tab" data-tab="flow-tree">
      <i class="fas fa-project-diagram"></i>
      <span>Flow Tree</span>
    </button>
    <button class="nav-tab" data-tab="dynamic-flow">
      <i class="fas fa-code-branch"></i>
      <span>Dynamic Flow</span>
    </button>
    <button class="nav-tab" data-tab="data-config">
      <i class="fas fa-database"></i>
      <span>Data & Config</span>
    </button>
    
    <div class="nav-divider"></div>
    
    <button class="nav-tab" data-tab="call-protection">
      <i class="fas fa-shield-alt"></i>
      <span>Call Protection</span>
    </button>
    <button class="nav-tab" data-tab="transfer-calls">
      <i class="fas fa-phone-alt"></i>
      <span>Transfer Calls</span>
    </button>
    
    <div class="nav-divider"></div>
    
    <button class="nav-tab" data-tab="call-center" onclick="openCallCenter(); return false;">
      <i class="fas fa-headset"></i>
      <span>Call Center</span>
    </button>
    <button class="nav-tab" data-tab="company-contacts">
      <i class="fas fa-address-book"></i>
      <span>Company Contacts</span>
    </button>
    <button class="nav-tab" data-tab="links">
      <i class="fas fa-link"></i>
      <span>Links</span>
    </button>
    
    <div class="nav-divider"></div>
    
    <button class="nav-tab" data-tab="version-history">
      <i class="fas fa-history"></i>
      <span>Version History</span>
    </button>
    
    <div class="nav-divider"></div>
    
    <button class="nav-tab" data-tab="legacy" style="color: #f59e0b;">
      <i class="fas fa-archive"></i>
      <span>ğŸ“¦ Legacy</span>
    </button>
  </nav>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CONTENT PANELS
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <main class="content-area">
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         FRONT DESK - The Config Brain
         Greeting rules, tone, confirmation, policy guardrails, booking fields,
         escalation preferences, quick answers
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel active" data-panel="front-desk">
      <div class="card">
        <div id="front-desk-container">
          <div class="loading-container">
            <i class="fas fa-concierge-bell fa-spin"></i>
            <p>Loading Front Desk Configuration...</p>
            </div>
          </div>
        </div>
      </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         FLOW TREE - Live AI Decision Visualization + System Snapshot
         Real-time understanding of how AI agent operates during calls
         SINGLE SOURCE OF TRUTH - If it's not in the snapshot, it doesn't exist
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" data-panel="flow-tree">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; min-height: 600px;">
        
        <!-- LEFT PANEL: Visual Flow Tree -->
        <div class="flow-tree-container">
          <div class="flow-tree-header">
            <div class="flow-tree-title">
              <span class="icon">ğŸŒ³</span>
              <h2>AI Decision Flow Tree</h2>
            </div>
            <div class="flow-tree-status" id="flow-tree-status">
              <i class="fas fa-circle"></i>
              <span>Ready</span>
            </div>
          </div>
          
          <div id="flow-tree-content">
          <!-- Static visualization - will be populated dynamically during live calls -->
          <div class="tree-node">
            <!-- Call Start -->
            <div class="tree-item active">
              <div class="tree-icon">ğŸ“</div>
              <div class="tree-content">
                <h4>Call Arrives</h4>
                <p>Incoming call detected, initializing AI agent</p>
                <div class="tree-meta">
                  <span class="meta-badge success">âœ“ Connected</span>
          </div>
        </div>
      </div>

            <!-- Call Protection -->
            <div class="tree-node">
              <div class="tree-item">
                <div class="tree-icon">ğŸ›¡ï¸</div>
                <div class="tree-content">
                  <h4>Call Protection</h4>
                  <p>Pre-answer filters: spam detection, IVR detection, abuse protection</p>
                  <div class="tree-meta">
                    <span class="meta-badge">Spam Check</span>
                    <span class="meta-badge">IVR Detection</span>
                    <span class="meta-badge">Machine Detection</span>
                  </div>
                </div>
              </div>
              
              <!-- Dynamic Flow Router -->
              <div class="tree-node">
                <div class="tree-item">
                  <div class="tree-icon">ğŸ”€</div>
                  <div class="tree-content">
                    <h4>Dynamic Flow Router</h4>
                    <p>Single source of truth for all routing decisions</p>
                    <div class="tree-meta">
                      <span class="meta-badge">Priority-based</span>
                      <span class="meta-badge">Trigger matching</span>
            </div>
                  </div>
                </div>
                
                <!-- Flow Nodes (populated from Dynamic Flows) -->
                <div class="tree-node" id="dynamic-flows-tree">
                  <div class="tree-item" style="border-left-color: #f97316;">
                    <div class="tree-icon">âš¡</div>
                    <div class="tree-content">
                      <h4>Emergency Service</h4>
                      <p>Trigger: "no heat", "no air", "emergency"</p>
                      <div class="tree-meta">
                        <span class="meta-badge warning">Priority: 200</span>
                        <span class="meta-badge">â†’ Booking</span>
          </div>
        </div>
      </div>

                  <div class="tree-item" style="border-left-color: #3b82f6;">
                    <div class="tree-icon">ğŸ“…</div>
                    <div class="tree-content">
                      <h4>Booking Intent</h4>
                      <p>Trigger: "schedule", "appointment", "book"</p>
                      <div class="tree-meta">
                        <span class="meta-badge">Priority: 100</span>
                        <span class="meta-badge">â†’ Booking</span>
            </div>
          </div>
        </div>
                  
                  <div class="tree-item" style="border-left-color: #8b5cf6;">
                    <div class="tree-icon">â“</div>
                    <div class="tree-content">
                      <h4>General Inquiry</h4>
                      <p>Trigger: "question", "information", "help"</p>
                      <div class="tree-meta">
                        <span class="meta-badge">Priority: 50</span>
                        <span class="meta-badge">â†’ Discovery</span>
      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Action Handler -->
                <div class="tree-item">
                  <div class="tree-icon">âš™ï¸</div>
                  <div class="tree-content">
                    <h4>Action Handler</h4>
                    <p>Transfer / Booking / Message / KB / Escalation</p>
                    <div class="tree-meta">
                      <span class="meta-badge">Target: Booking Engine</span>
                    </div>
              </div>
            </div>
            
                <!-- LLM Fallback -->
                <div class="tree-item" style="opacity: 0.6;">
                  <div class="tree-icon">ğŸ¤–</div>
                  <div class="tree-content">
                    <h4>LLM Fallback</h4>
                    <p>Last resort only - when no flow matches</p>
                    <div class="tree-meta">
                      <span class="meta-badge">$0.50/use</span>
                      <span class="meta-badge">Target: &lt;1%</span>
              </div>
              </div>
                </div>
              </div>
              </div>
            </div>
            
          <!-- Live Call Memory Boxes -->
          <h3 style="margin-top: 32px; margin-bottom: 16px; font-size: 16px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">
            ğŸ“Š Live Call Memory (Populates During Calls)
          </h3>
          <div class="data-boxes">
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Caller Name</span>
              </div>
              <div class="data-box-value empty">Not collected</div>
            </div>
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Phone Number</span>
              </div>
              <div class="data-box-value empty">Not collected</div>
            </div>
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Service Type</span>
              </div>
              <div class="data-box-value empty">Not detected</div>
            </div>
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Urgency</span>
              </div>
              <div class="data-box-value empty">Not assessed</div>
            </div>
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Trigger Matched</span>
              </div>
              <div class="data-box-value empty">Awaiting call</div>
            </div>
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Match Score</span>
              </div>
              <div class="data-box-value empty">â€”</div>
            </div>
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Flow Priority</span>
              </div>
              <div class="data-box-value empty">â€”</div>
            </div>
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Action Taken</span>
              </div>
              <div class="data-box-value empty">â€”</div>
            </div>
            <div class="data-box">
              <div class="data-box-header">
                <span class="data-box-title">Booking Status</span>
              </div>
              <div class="data-box-value empty">â€”</div>
            </div>
          </div>
        </div>
          </div>
          
        <!-- RIGHT PANEL: System Snapshot (Copyable JSON) -->
        <div class="flow-tree-container" style="background: linear-gradient(135deg, #1a1f35 0%, #0f172a 100%);">
          <div class="flow-tree-header">
            <div class="flow-tree-title">
              <span class="icon">ğŸ“¸</span>
              <h2>System Snapshot</h2>
            </div>
            <div style="display: flex; align-items: center; gap: 12px;">
              <div id="snapshot-status" style="display: flex; align-items: center; gap: 8px; padding: 6px 14px; background: rgba(16, 185, 129, 0.2); border-radius: 20px; color: var(--accent-green); font-weight: 600; font-size: 13px;">
                <span id="snapshot-mode-icon">ğŸŸ¡</span>
                <span id="snapshot-mode-text">IDLE</span>
          </div>
        </div>
      </div>

          <!-- Snapshot Controls -->
          <div style="display: flex; gap: 12px; margin-bottom: 16px;">
            <button onclick="copySystemSnapshot()" id="btn-copy-snapshot" style="display: inline-flex; align-items: center; gap: 8px; padding: 10px 18px; border-radius: 8px; border: 2px solid var(--accent-orange); background: var(--accent-orange); color: white; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
              <i class="fas fa-copy"></i>
              <span>ğŸ“‹ Copy JSON</span>
          </button>
            <button onclick="refreshSystemSnapshot()" id="btn-refresh-snapshot" style="display: inline-flex; align-items: center; gap: 8px; padding: 10px 18px; border-radius: 8px; border: 2px solid var(--border-subtle); background: transparent; color: var(--text-primary); font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
              <i class="fas fa-sync-alt" id="refresh-icon"></i>
              <span>ğŸ”„ Refresh</span>
          </button>
          </div>
          
          <!-- Snapshot Info -->
          <div style="display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary);">
              <i class="fas fa-clock"></i>
              <span>Generated: </span>
              <span id="snapshot-timestamp" style="color: var(--text-primary);">â€”</span>
            </div>
            <div style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary);">
              <i class="fas fa-bolt"></i>
              <span>Time: </span>
              <span id="snapshot-generation-time" style="color: var(--accent-green);">â€”</span>
          </div>
        </div>
        
          <!-- Snapshot Stats -->
          <div id="snapshot-stats" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px;">
            <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; text-align: center;">
              <div style="font-size: 20px; font-weight: 700; color: var(--accent-orange);" id="stat-flows">â€”</div>
              <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase;">Flows</div>
            </div>
            <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; text-align: center;">
              <div style="font-size: 20px; font-weight: 700; color: var(--accent-blue);" id="stat-transfers">â€”</div>
              <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase;">Transfers</div>
            </div>
            <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; text-align: center;">
              <div style="font-size: 20px; font-weight: 700; color: var(--accent-green);" id="stat-contacts">â€”</div>
              <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase;">Contacts</div>
          </div>
        </div>
        
          <!-- JSON Display -->
          <div style="position: relative;">
            <div style="position: absolute; top: 8px; right: 8px; font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-secondary); background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 4px; z-index: 10;">
              READ-ONLY
            </div>
            <pre id="snapshot-json" style="background: #0d1117; border: 1px solid var(--border-subtle); border-radius: 12px; padding: 16px; font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace; font-size: 11px; line-height: 1.5; color: #c9d1d9; overflow: auto; max-height: 450px; margin: 0; white-space: pre-wrap; word-wrap: break-word;">
{
  "message": "Click 'Refresh' to load system snapshot",
  "hint": "This JSON contains EVERYTHING the AI agent can see"
}
            </pre>
          </div>
          
          <!-- Help Text -->
          <div style="margin-top: 16px; padding: 12px; background: rgba(249, 115, 22, 0.1); border-radius: 8px; border-left: 4px solid var(--accent-orange);">
            <p style="margin: 0; font-size: 13px; color: var(--text-secondary);">
              <strong style="color: var(--accent-orange);">ğŸ’¡ This is the Single Source of Truth</strong><br>
              If something is missing from this JSON, it is <strong>not wired</strong> and will <strong>not work in production</strong>.
              Copy this JSON when reporting issues or discussing system behavior.
            </p>
          </div>
        </div>
        
      </div>
    </div>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         DYNAMIC FLOW - The ONLY Routing Brain
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" data-panel="dynamic-flow">
      <div class="card">
        <div id="dynamic-flow-container">
          <div class="loading-container">
            <i class="fas fa-code-branch fa-spin"></i>
            <p>Loading Dynamic Flow Configuration...</p>
            </div>
          </div>
        </div>
      </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         DATA & CONFIG - Placeholders, Templates, Scenarios
         Global data + company overrides for multi-tenant system
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" data-panel="data-config">
      <div class="card">
        <h2>ğŸ“‚ Data & Config</h2>
        <p class="muted">Manage placeholders, templates, and scenarios. Global data with company-specific overrides.</p>
        
        <!-- Sub-tabs for Data & Config -->
        <div style="display: flex; gap: 8px; margin-bottom: 24px; border-bottom: 2px solid #e2e8f0; padding-bottom: 12px;">
          <button class="data-config-subtab active" data-subtab="placeholders" style="padding: 10px 20px; border: none; background: #3b82f6; color: white; border-radius: 8px 8px 0 0; font-weight: 600; cursor: pointer;">
            <i class="fas fa-tags"></i> Placeholders
          </button>
          <button class="data-config-subtab" data-subtab="templates" style="padding: 10px 20px; border: none; background: #f1f5f9; color: #64748b; border-radius: 8px 8px 0 0; font-weight: 600; cursor: pointer;">
            <i class="fas fa-file-alt"></i> Templates
          </button>
          <button class="data-config-subtab" data-subtab="scenarios" style="padding: 10px 20px; border: none; background: #f1f5f9; color: #64748b; border-radius: 8px 8px 0 0; font-weight: 600; cursor: pointer;">
            <i class="fas fa-theater-masks"></i> Scenarios
          </button>
        </div>
        
        <!-- PLACEHOLDERS (V2 - Replaces Variables) -->
        <div id="data-config-placeholders" class="data-config-content">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <div>
              <h3 style="font-size: 18px; font-weight: 600; margin: 0;">ğŸ·ï¸ Placeholders (Variables V2)</h3>
              <p style="font-size: 13px; color: #64748b; margin-top: 4px;">
                Dynamic tokens resolved at runtime. Use <code style="background: #f1f5f9; padding: 2px 6px; border-radius: 4px;">{companyName}</code> in prompts.
              </p>
          </div>
            <div style="display: flex; gap: 8px;">
              <button onclick="importPlaceholderDefaults()" class="btn btn-secondary" style="font-size: 13px;">
                <i class="fas fa-download"></i> Import Defaults
              </button>
              <button onclick="addPlaceholder()" class="btn btn-primary" style="font-size: 13px;">
                <i class="fas fa-plus"></i> Add Placeholder
              </button>
            </div>
          </div>
          
          <table id="placeholders-table">
              <thead>
                <tr>
                <th style="width: 30%;">Name (Token)</th>
                <th style="width: 50%;">Value</th>
                <th style="width: 20%;">Actions</th>
                </tr>
              </thead>
            <tbody id="placeholders-list">
              <tr>
                <td colspan="3" style="text-align: center; padding: 40px; color: #94a3b8;">
                  <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 12px; display: block;"></i>
                  Loading placeholders...
                </td>
              </tr>
              </tbody>
            </table>
          
          <div style="margin-top: 16px; display: flex; justify-content: flex-end; gap: 12px;">
            <button onclick="resetPlaceholders()" class="btn btn-secondary">
              <i class="fas fa-undo"></i> Reset to Defaults
            </button>
            <button onclick="savePlaceholders()" class="btn btn-primary">
              <i class="fas fa-save"></i> Save Changes
            </button>
          </div>
        </div>
        
        <!-- TEMPLATES (Using AiCoreTemplatesManager - YOUR original system) -->
        <div id="data-config-templates" class="data-config-content" style="display: none;">
          <!-- This container is used by AiCoreTemplatesManager -->
          <div id="aicore-templates-container">
            <div style="text-align: center; padding: 40px; color: #94a3b8;">
              <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 12px; display: block;"></i>
              Loading templates...
          </div>
        </div>
      </div>

        <!-- SCENARIOS (Using AiCoreLiveScenariosManager - YOUR original system) -->
        <div id="data-config-scenarios" class="data-config-content" style="display: none;">
          <!-- This container is used by AiCoreLiveScenariosManager -->
          <div id="aicore-live-scenarios-container">
            <div style="text-align: center; padding: 40px; color: #94a3b8;">
              <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 12px; display: block;"></i>
              Loading scenarios...
            </div>
          </div>
          </div>
        </div>
      </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         CALL PROTECTION (formerly Edge Cases)
         Pre-DFLOW filters: Spam, IVR, Machine, Silence, Abuse
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" data-panel="call-protection">
        <div class="card">
        <h2>ğŸ›¡ï¸ Call Protection</h2>
        <p class="muted">Pre-answer filters that execute BEFORE Dynamic Flow. Cannot route â€” only short-circuit or pass forward.</p>
        <div id="call-protection-container">
          <!-- CheatSheetManager will render Edge Cases here -->
          <div id="cheatsheet-subtab-edge-cases">
            <div id="edge-cases-section" class="bg-white rounded-lg p-6">
              <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:16px;">
                <div>
                  <h4 style="font-size: 16px; font-weight: 600; color: #111827; margin:0;">
                    <i class="fas fa-exclamation-triangle" style="margin-right:6px; color:#f59e0b;"></i>Edge Cases
                  </h4>
                  <p style="font-size: 12px; color:#6b7280; margin-top:4px;">
                    Edge cases short-circuit everything else. Use for spam, IVR detection, wrong number, etc.
                  </p>
          </div>
                <button type="button" data-cheatsheet-action="add-edge-case" style="padding:8px 14px; border-radius:8px; border:none; background:#f59e0b; color:#fff; font-size:13px; font-weight:600; display:flex; align-items:center; gap:6px;">
                  <i class="fas fa-plus"></i>Add Edge Case
                </button>
              </div>
              <div id="edge-cases-list" style="display:flex; flex-direction:column; gap:12px;">
                <div class="loading-container">
                  <i class="fas fa-shield-alt fa-spin"></i>
                  <p>Loading Call Protection Settings...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        </div>
      </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         TRANSFER CALLS - Transfer Target Directory
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" data-panel="transfer-calls">
        <div class="card">
        <h2>ğŸ“ Transfer Calls</h2>
        <p class="muted">Transfer target directory. DFLOW references transferTargetId. Defines destination, availability, and pre-transfer script.</p>
        <div id="transfer-calls-container">
          <!-- CheatSheetManager will render Transfer Rules here -->
          <div id="cheatsheet-subtab-transfer-calls">
            <div id="transfer-rules-section" class="bg-white rounded-lg p-6">
              <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:16px;">
                <div>
                  <h4 style="font-size: 16px; font-weight: 600; color: #111827; margin:0;">
                    <i class="fas fa-phone" style="margin-right:6px; color:#2563eb;"></i>Transfer Rules
                  </h4>
                  <p style="font-size: 12px; color:#6b7280; margin-top:4px;">
                    Transfer rules route calls to specific departments or people based on intent.
                  </p>
          </div>
                <button type="button" data-cheatsheet-action="add-transfer-rule" style="padding:8px 14px; border-radius:8px; border:none; background:#2563eb; color:#fff; font-size:13px; font-weight:600; display:flex; align-items:center; gap:6px;">
                  <i class="fas fa-plus"></i>Add Transfer Rule
                </button>
              </div>
              <div id="transfer-rules-list" style="display:flex; flex-direction:column; gap:12px;">
                <div class="loading-container">
                  <i class="fas fa-phone-alt fa-spin"></i>
                  <p>Loading Transfer Directory...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        </div>
      </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         COMPANY CONTACTS - Directory of humans for escalation
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" data-panel="company-contacts">
        <div class="card">
        <h2>ğŸ“‹ Company Contacts</h2>
        <p class="muted">Directory of humans AI can escalate or notify. Used by transfers, escalations, and notifications.</p>
        <div id="company-contacts-container">
          <!-- CheatSheetManager will render Company Contacts here -->
          <div id="cheatsheet-v2-dynamic-content" data-section="company-contacts" style="background: #fff; border-radius: 12px; min-height: 200px;">
            <div class="loading-container">
              <i class="fas fa-address-book fa-spin"></i>
              <p>Loading Company Contacts...</p>
            </div>
          </div>
          </div>
        </div>
      </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         LINKS - Outbound customer delivery
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" data-panel="links">
        <div class="card">
        <h2>ğŸ”— Links</h2>
        <p class="muted">Outbound customer delivery: payments, forms, financing. DFLOW actions may reference linkId.</p>
        <div id="links-container">
          <!-- CheatSheetManager will render Links here -->
          <div id="cheatsheet-v2-links-content" data-section="links" style="background: #fff; border-radius: 12px; min-height: 200px;">
            <div class="loading-container">
              <i class="fas fa-link fa-spin"></i>
              <p>Loading Links...</p>
          </div>
          </div>
          </div>
        </div>
      </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         VERSION HISTORY - Front Desk Configuration versioning
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" data-panel="version-history">
        <div class="card">
        <h2>ğŸ“š Version History</h2>
        <p class="muted">Versioning for Front Desk Configuration. Isolate LIVE vs DRAFT safely during calls.</p>
        <div id="version-history-container">
          <!-- CheatSheetManager will render Version History here -->
          <div id="cheatsheet-v2-version-content" data-section="version-history" style="background: #fff; border-radius: 12px; min-height: 200px;">
            <div class="loading-container">
              <i class="fas fa-history fa-spin"></i>
              <p>Loading Version History...</p>
            </div>
          </div>
          </div>
        </div>
      </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         LEGACY (Read-Only + Migration)
         Temporary tab to view old data modules during migration
         DO NOT DELETE DATA until migration is verified complete
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-panel" data-panel="legacy">
      <div class="card" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b;">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
          <span style="font-size: 32px;">ğŸ“¦</span>
          <div>
            <h2 style="margin: 0; color: #92400e;">Legacy Data (Read-Only)</h2>
            <p class="muted" style="color: #a16207;">This tab shows old data that existed before the Control Plane cleanup. Nothing has been deleted.</p>
          </div>
        </div>
        
        <!-- Full Inventory Button -->
        <div style="margin-bottom: 24px;">
          <button onclick="loadFullInventory()" id="btn-load-inventory" class="btn" style="background: #f59e0b; color: white; padding: 14px 24px; font-size: 15px;">
            <i class="fas fa-search"></i> Load Full Inventory (Prove Nothing Lost)
          </button>
          <button onclick="copyInventoryJson()" id="btn-copy-inventory" class="btn btn-secondary" style="margin-left: 12px;">
            <i class="fas fa-copy"></i> Copy JSON
          </button>
      </div>
        
        <!-- Inventory Stats Summary -->
        <div id="inventory-summary" style="display: none; margin-bottom: 24px;">
          <h3 style="font-size: 16px; font-weight: 600; color: #92400e; margin-bottom: 12px;">ğŸ“Š Inventory Summary</h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px;" id="inventory-stats-grid">
            <!-- Stats will be populated here -->
      </div>
        </div>
        
        <!-- Legacy Sections Accordion -->
        <div id="legacy-sections" style="display: flex; flex-direction: column; gap: 12px;">
          
          <!-- TRIAGE CARDS -->
          <div class="legacy-section" style="background: white; border-radius: 12px; overflow: hidden;">
            <button onclick="toggleLegacySection('triage')" style="width: 100%; padding: 16px; background: #f8fafc; border: none; text-align: left; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
              <span style="font-weight: 600; color: #1e293b;"><i class="fas fa-clipboard-list" style="margin-right: 8px; color: #f59e0b;"></i>Triage Cards</span>
              <span id="triage-count" style="background: #e2e8f0; padding: 4px 12px; border-radius: 20px; font-size: 12px;">â€”</span>
            </button>
            <div id="legacy-triage" style="display: none; padding: 16px; max-height: 400px; overflow-y: auto;">
              <pre id="legacy-triage-json" style="background: #0d1117; color: #c9d1d9; padding: 16px; border-radius: 8px; font-size: 11px; overflow-x: auto;">Click "Load Full Inventory" to view</pre>
        </div>
        </div>
          
          <!-- MISSION CONTROL -->
          <div class="legacy-section" style="background: white; border-radius: 12px; overflow: hidden;">
            <button onclick="toggleLegacySection('mission')" style="width: 100%; padding: 16px; background: #f8fafc; border: none; text-align: left; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
              <span style="font-weight: 600; color: #1e293b;"><i class="fas fa-rocket" style="margin-right: 8px; color: #8b5cf6;"></i>Mission Control</span>
              <span id="mission-count" style="background: #e2e8f0; padding: 4px 12px; border-radius: 20px; font-size: 12px;">â€”</span>
            </button>
            <div id="legacy-mission" style="display: none; padding: 16px; max-height: 400px; overflow-y: auto;">
              <pre id="legacy-mission-json" style="background: #0d1117; color: #c9d1d9; padding: 16px; border-radius: 8px; font-size: 11px; overflow-x: auto;">Click "Load Full Inventory" to view</pre>
        </div>
        </div>
          
          <!-- BEHAVIOR RULES -->
          <div class="legacy-section" style="background: white; border-radius: 12px; overflow: hidden;">
            <button onclick="toggleLegacySection('behavior')" style="width: 100%; padding: 16px; background: #f8fafc; border: none; text-align: left; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
              <span style="font-weight: 600; color: #1e293b;"><i class="fas fa-sliders-h" style="margin-right: 8px; color: #3b82f6;"></i>Behavior Rules</span>
              <span id="behavior-count" style="background: #e2e8f0; padding: 4px 12px; border-radius: 20px; font-size: 12px;">â€”</span>
            </button>
            <div id="legacy-behavior" style="display: none; padding: 16px; max-height: 400px; overflow-y: auto;">
              <pre id="legacy-behavior-json" style="background: #0d1117; color: #c9d1d9; padding: 16px; border-radius: 8px; font-size: 11px; overflow-x: auto;">Click "Load Full Inventory" to view</pre>
    </div>
  </div>

          <!-- GUARDRAILS -->
          <div class="legacy-section" style="background: white; border-radius: 12px; overflow: hidden;">
            <button onclick="toggleLegacySection('guardrails')" style="width: 100%; padding: 16px; background: #f8fafc; border: none; text-align: left; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
              <span style="font-weight: 600; color: #1e293b;"><i class="fas fa-shield-alt" style="margin-right: 8px; color: #10b981;"></i>Guardrails</span>
              <span id="guardrails-count" style="background: #e2e8f0; padding: 4px 12px; border-radius: 20px; font-size: 12px;">â€”</span>
            </button>
            <div id="legacy-guardrails" style="display: none; padding: 16px; max-height: 400px; overflow-y: auto;">
              <pre id="legacy-guardrails-json" style="background: #0d1117; color: #c9d1d9; padding: 16px; border-radius: 8px; font-size: 11px; overflow-x: auto;">Click "Load Full Inventory" to view</pre>
            </div>
          </div>
          
          <!-- LEGACY VARIABLES -->
          <div class="legacy-section" style="background: white; border-radius: 12px; overflow: hidden;">
            <button onclick="toggleLegacySection('variables')" style="width: 100%; padding: 16px; background: #f8fafc; border: none; text-align: left; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
              <span style="font-weight: 600; color: #1e293b;"><i class="fas fa-code" style="margin-right: 8px; color: #06b6d4;"></i>Legacy Variables</span>
              <span id="variables-count" style="background: #e2e8f0; padding: 4px 12px; border-radius: 20px; font-size: 12px;">â€”</span>
            </button>
            <div id="legacy-variables" style="display: none; padding: 16px; max-height: 400px; overflow-y: auto;">
              <pre id="legacy-variables-json" style="background: #0d1117; color: #c9d1d9; padding: 16px; border-radius: 8px; font-size: 11px; overflow-x: auto;">Click "Load Full Inventory" to view</pre>
            </div>
          </div>
          
          <!-- CALCULATORS -->
          <div class="legacy-section" style="background: white; border-radius: 12px; overflow: hidden;">
            <button onclick="toggleLegacySection('calculators')" style="width: 100%; padding: 16px; background: #f8fafc; border: none; text-align: left; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
              <span style="font-weight: 600; color: #1e293b;"><i class="fas fa-calculator" style="margin-right: 8px; color: #ec4899;"></i>Calculators</span>
              <span id="calculators-count" style="background: #e2e8f0; padding: 4px 12px; border-radius: 20px; font-size: 12px;">â€”</span>
            </button>
            <div id="legacy-calculators" style="display: none; padding: 16px; max-height: 400px; overflow-y: auto;">
              <pre id="legacy-calculators-json" style="background: #0d1117; color: #c9d1d9; padding: 16px; border-radius: 8px; font-size: 11px; overflow-x: auto;">Click "Load Full Inventory" to view</pre>
            </div>
          </div>
          
          <!-- BLACK BOX RECORDINGS -->
          <div class="legacy-section" style="background: white; border-radius: 12px; overflow: hidden;">
            <button onclick="toggleLegacySection('blackbox')" style="width: 100%; padding: 16px; background: #f8fafc; border: none; text-align: left; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
              <span style="font-weight: 600; color: #1e293b;"><i class="fas fa-video" style="margin-right: 8px; color: #f97316;"></i>Black Box Recordings</span>
              <span id="blackbox-count" style="background: #e2e8f0; padding: 4px 12px; border-radius: 20px; font-size: 12px;">â€”</span>
            </button>
            <div id="legacy-blackbox" style="display: none; padding: 16px; max-height: 400px; overflow-y: auto;">
              <pre id="legacy-blackbox-json" style="background: #0d1117; color: #c9d1d9; padding: 16px; border-radius: 8px; font-size: 11px; overflow-x: auto;">Click "Load Full Inventory" to view</pre>
            </div>
          </div>
          
        </div>
        
        <!-- Full JSON Display -->
        <div style="margin-top: 24px;">
          <h3 style="font-size: 16px; font-weight: 600; color: #92400e; margin-bottom: 12px;">ğŸ“ Full Inventory JSON</h3>
          <pre id="legacy-full-json" style="background: #0d1117; color: #c9d1d9; padding: 16px; border-radius: 12px; font-size: 11px; max-height: 500px; overflow: auto; white-space: pre-wrap;">
{
  "message": "Click 'Load Full Inventory' to fetch all legacy data",
  "hint": "This proves nothing has been deleted during the cleanup"
}
          </pre>
        </div>
      </div>
    </div>
    
  </main>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       JAVASCRIPT
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // GLOBAL STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const currentCompanyId = new URLSearchParams(window.location.search).get('companyId') || null;
    const authToken = localStorage.getItem('adminToken');
    const API_BASE = '';
    
    // Track initialized managers
    const initializedTabs = new Set();
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // NAVIGATION FUNCTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function goBackToProfile() {
      if (currentCompanyId) {
        window.location.href = `/company-profile.html?id=${currentCompanyId}#ai-agent-settings`;
      } else {
        window.location.href = '/admin-directory.html';
      }
    }

    function openCallCenter() {
      if (!currentCompanyId) {
        alert('No company ID found.');
        return;
      }
      window.open(`/call-center.html?companyId=${currentCompanyId}`, '_blank');
    }
    
    function openBlackBox() {
      if (!currentCompanyId) {
        alert('No company ID found.');
        return;
      }
      window.open(`/black-box.html?companyId=${currentCompanyId}`, '_blank');
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LAZY SCRIPT LOADER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const loadedScripts = new Set();
    
    function loadScript(src) {
      return new Promise((resolve, reject) => {
        if (loadedScripts.has(src)) {
          resolve();
          return;
        }
        
        console.log(`ğŸ“¦ [LAZY LOAD] Loading: ${src}`);
        const script = document.createElement('script');
        script.src = src;
        script.onload = () => {
          loadedScripts.add(src);
          console.log(`âœ… [LAZY LOAD] Loaded: ${src}`);
          resolve();
        };
        script.onerror = () => {
          console.error(`âŒ [LAZY LOAD] Failed: ${src}`);
          reject(new Error(`Failed to load: ${src}`));
        };
        document.body.appendChild(script);
      });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TAB SWITCHING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function switchTab(tabId) {
      console.log(`ğŸ¯ [NAV] Switching to: ${tabId}`);
      
      // Update nav buttons
      document.querySelectorAll('.nav-tab').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-tab') === tabId);
      });
      
      // Update panels
      document.querySelectorAll('.tab-panel').forEach(panel => {
        panel.classList.toggle('active', panel.getAttribute('data-panel') === tabId);
      });
      
      // Initialize tab content if not already done
      initializeTab(tabId);
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TAB INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initializeTab(tabId) {
      if (initializedTabs.has(tabId)) return;
      if (!currentCompanyId) {
        console.error('No companyId provided');
        return;
      }
      
      try {
        switch (tabId) {
          case 'front-desk':
            await initFrontDesk();
            break;
          case 'flow-tree':
            await initFlowTree();
            break;
          case 'dynamic-flow':
            await initDynamicFlow();
            break;
          case 'call-protection':
            await initCallProtection();
            break;
          case 'transfer-calls':
            await initTransferCalls();
            break;
          case 'company-contacts':
            await initCompanyContacts();
            break;
          case 'links':
            await initLinks();
            break;
          case 'version-history':
            await initVersionHistory();
            break;
          case 'data-config':
            await initDataConfig();
            break;
          case 'legacy':
            await initLegacy();
            break;
        }
        initializedTabs.add(tabId);
      } catch (error) {
        console.error(`âŒ [INIT] Failed to initialize ${tabId}:`, error);
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FRONT DESK INITIALIZATION
    // Uses existing FrontDeskBehaviorManager
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initFrontDesk() {
      console.log('ğŸ¢ [INIT] Initializing Front Desk...');
      await loadScript('/js/ai-agent-settings/FrontDeskBehaviorManager.js');
      
      const container = document.getElementById('front-desk-container');
      if (container && window.FrontDeskBehaviorManager) {
        window.frontDeskManager = new window.FrontDeskBehaviorManager(currentCompanyId);
        await window.frontDeskManager.load();
        window.frontDeskManager.render(container);
        console.log('âœ… [INIT] Front Desk initialized');
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FLOW TREE INITIALIZATION
    // Live visualization of AI decision flow + System Snapshot
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initFlowTree() {
      console.log('ğŸŒ³ [INIT] Initializing Flow Tree...');
      
      // Load company's dynamic flows to populate the tree
      try {
        const response = await fetch(`/api/company/${currentCompanyId}/dynamic-flows`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (response.ok) {
          const data = await response.json();
          if (data.flows && data.flows.length > 0) {
            renderFlowTreeNodes(data.flows);
          }
        }
      } catch (error) {
        console.error('Failed to load flows for tree:', error);
      }
      
      // Auto-load system snapshot
      await refreshSystemSnapshot();
      
      console.log('âœ… [INIT] Flow Tree initialized with System Snapshot');
    }
    
    function renderFlowTreeNodes(flows) {
      const container = document.getElementById('dynamic-flows-tree');
      if (!container) return;
      
      // Sort by priority descending
      const sortedFlows = flows.sort((a, b) => (b.priority || 0) - (a.priority || 0));
      
      container.innerHTML = sortedFlows.map(flow => {
        const triggerPhrases = flow.trigger?.phrases?.slice(0, 3).join('", "') || 'No triggers';
        const priority = flow.priority || 0;
        const actions = flow.actions?.map(a => a.type).join(', ') || 'No actions';
        
        // Color based on priority
        let borderColor = '#8b5cf6'; // Default purple
        if (priority >= 200) borderColor = '#dc2626'; // Red for emergency
        else if (priority >= 100) borderColor = '#f97316'; // Orange for high
        else if (priority >= 50) borderColor = '#3b82f6'; // Blue for medium
        
        return `
          <div class="tree-item" style="border-left-color: ${borderColor};">
            <div class="tree-icon">${flow.isActive ? 'âœ…' : 'â¸ï¸'}</div>
            <div class="tree-content">
              <h4>${flow.name || flow.flowKey || 'Unnamed Flow'}</h4>
              <p>Trigger: "${triggerPhrases}"</p>
              <div class="tree-meta">
                <span class="meta-badge ${priority >= 100 ? 'warning' : ''}">Priority: ${priority}</span>
                <span class="meta-badge">â†’ ${actions}</span>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DYNAMIC FLOW INITIALIZATION
    // Renders the Dynamic Flows tab from FrontDeskBehaviorManager
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initDynamicFlow() {
      console.log('ğŸ”€ [INIT] Initializing Dynamic Flow...');
      
      // Ensure FrontDeskBehaviorManager is loaded
      if (!window.frontDeskManager) {
        await loadScript('/js/ai-agent-settings/FrontDeskBehaviorManager.js');
        window.frontDeskManager = new window.FrontDeskBehaviorManager(currentCompanyId);
        await window.frontDeskManager.load();
      }
      
      const container = document.getElementById('dynamic-flow-container');
      if (container && window.frontDeskManager) {
        // Render just the Dynamic Flows tab content
        container.innerHTML = window.frontDeskManager.renderDynamicFlowsTab();
        window.frontDeskManager.initDynamicFlowsTab(container);
        console.log('âœ… [INIT] Dynamic Flow initialized');
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CALL PROTECTION INITIALIZATION (formerly Edge Cases)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initCallProtection() {
      console.log('ğŸ›¡ï¸ [INIT] Initializing Call Protection...');
      
      await loadScript('/js/ai-agent-settings/CheatSheetVersioningAdapter.js');
      await loadScript('/js/ai-agent-settings/CheatSheetManager.js');
      
      if (window.cheatSheetManager) {
        if (window.cheatSheetManager.companyId !== currentCompanyId) {
          await window.cheatSheetManager.load(currentCompanyId);
        }
        
        // Attach action handlers for Add Edge Case button
        const container = document.getElementById('call-protection-container');
          if (container) {
          container.addEventListener('click', (e) => {
            const actionBtn = e.target.closest('[data-cheatsheet-action]');
            if (actionBtn && actionBtn.getAttribute('data-cheatsheet-action') === 'add-edge-case') {
              e.preventDefault();
              window.cheatSheetManager.addEdgeCase();
            }
          });
        }
        
        window.cheatSheetManager.renderEdgeCases();
        console.log('âœ… [INIT] Call Protection initialized');
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TRANSFER CALLS INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initTransferCalls() {
      console.log('ğŸ“ [INIT] Initializing Transfer Calls...');
      
      await loadScript('/js/ai-agent-settings/CheatSheetVersioningAdapter.js');
      await loadScript('/js/ai-agent-settings/CheatSheetManager.js');
      
      if (window.cheatSheetManager) {
        if (window.cheatSheetManager.companyId !== currentCompanyId) {
          await window.cheatSheetManager.load(currentCompanyId);
        }
        
        // Attach action handlers for Add Transfer Rule button
        const container = document.getElementById('transfer-calls-container');
          if (container) {
          container.addEventListener('click', (e) => {
            const actionBtn = e.target.closest('[data-cheatsheet-action]');
            if (actionBtn && actionBtn.getAttribute('data-cheatsheet-action') === 'add-transfer-rule') {
              e.preventDefault();
              window.cheatSheetManager.addTransferRule();
            }
          });
        }
        
        window.cheatSheetManager.renderTransferRules();
        console.log('âœ… [INIT] Transfer Calls initialized');
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // COMPANY CONTACTS INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initCompanyContacts() {
      console.log('ğŸ“‹ [INIT] Initializing Company Contacts...');
      
      await loadScript('/js/ai-agent-settings/CheatSheetVersioningAdapter.js');
      await loadScript('/js/ai-agent-settings/CheatSheetManager.js');
      
      if (window.cheatSheetManager) {
        if (window.cheatSheetManager.companyId !== currentCompanyId) {
          await window.cheatSheetManager.load(currentCompanyId);
        }
        
        // renderCompanyContacts expects #cheatsheet-v2-dynamic-content
        window.cheatSheetManager.renderCompanyContacts();
        console.log('âœ… [INIT] Company Contacts initialized');
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LINKS INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initLinks() {
      console.log('ğŸ”— [INIT] Initializing Links...');
      
      await loadScript('/js/ai-agent-settings/CheatSheetVersioningAdapter.js');
      await loadScript('/js/ai-agent-settings/CheatSheetManager.js');
      
      if (window.cheatSheetManager) {
        if (window.cheatSheetManager.companyId !== currentCompanyId) {
          await window.cheatSheetManager.load(currentCompanyId);
        }
        
        // Links needs its own container - update cheatSheetManager to render there
        const linksContainer = document.getElementById('cheatsheet-v2-links-content');
        if (linksContainer) {
          // Temporarily override the container lookup for links
          window.cheatSheetManager.renderLinksToContainer(linksContainer);
        }
        console.log('âœ… [INIT] Links initialized');
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // VERSION HISTORY INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function initVersionHistory() {
      console.log('ğŸ“š [INIT] Initializing Version History...');
      
      await loadScript('/js/ai-agent-settings/CheatSheetVersioningAdapter.js');
      await loadScript('/js/ai-agent-settings/CheatSheetManager.js');
      
      if (window.cheatSheetManager) {
        if (window.cheatSheetManager.companyId !== currentCompanyId) {
          await window.cheatSheetManager.load(currentCompanyId);
        }
        
        // Version history needs its own container
        const versionContainer = document.getElementById('cheatsheet-v2-version-content');
        if (versionContainer) {
          window.cheatSheetManager.renderVersionHistoryToContainer(versionContainer);
        }
        console.log('âœ… [INIT] Version History initialized');
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DATA & CONFIG INITIALIZATION
    // Placeholders (V2), Templates, Scenarios
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let currentPlaceholders = {};
    
    // Store references to the original managers
    let aiCoreTemplatesManager = null;
    let aiCoreLiveScenariosManager = null;
    
    async function initDataConfig() {
      console.log('ğŸ“‚ [INIT] Initializing Data & Config...');
      
      // Load the ORIGINAL manager scripts
      await loadScript('/js/ai-agent-settings/AiCoreTemplatesManager.js');
      await loadScript('/js/ai-agent-settings/AiCoreLiveScenariosManager.js');
      
      // Set up sub-tab switching
      document.querySelectorAll('.data-config-subtab').forEach(btn => {
        btn.addEventListener('click', () => {
          const subtab = btn.getAttribute('data-subtab');
          switchDataConfigSubtab(subtab);
      });
    });

      // Load placeholders by default
      await loadPlaceholders();
      
      console.log('âœ… [INIT] Data & Config initialized');
    }
    
    async function switchDataConfigSubtab(subtab) {
      // Update subtab buttons
      document.querySelectorAll('.data-config-subtab').forEach(btn => {
        const isActive = btn.getAttribute('data-subtab') === subtab;
        btn.style.background = isActive ? '#3b82f6' : '#f1f5f9';
        btn.style.color = isActive ? 'white' : '#64748b';
        btn.classList.toggle('active', isActive);
      });
      
      // Update content panels
      document.querySelectorAll('.data-config-content').forEach(panel => {
        panel.style.display = 'none';
      });
      
      const activePanel = document.getElementById(`data-config-${subtab}`);
      if (activePanel) {
        activePanel.style.display = 'block';
      }
      
      // Load content for the subtab using ORIGINAL managers
      if (subtab === 'placeholders') {
        loadPlaceholders();
      } else if (subtab === 'templates') {
        await loadTemplatesWithOriginalManager();
      } else if (subtab === 'scenarios') {
        await loadScenariosWithOriginalManager();
      }
    }
    
    async function loadTemplatesWithOriginalManager() {
      console.log('ğŸ“„ [TEMPLATES] Using AiCoreTemplatesManager...');
      
      if (!window.AiCoreTemplatesManager) {
        console.error('AiCoreTemplatesManager not loaded!');
        return;
      }
      
      // Create a minimal parent object that the manager expects
      const parentManager = {
        companyId: currentCompanyId
      };
      
      if (!aiCoreTemplatesManager) {
        aiCoreTemplatesManager = new window.AiCoreTemplatesManager(parentManager);
      }
      
      await aiCoreTemplatesManager.load();
    }
    
    async function loadScenariosWithOriginalManager() {
      console.log('ğŸ­ [SCENARIOS] Using AiCoreLiveScenariosManager...');
      
      if (!window.AiCoreLiveScenariosManager) {
        console.error('AiCoreLiveScenariosManager not loaded!');
        return;
      }
      
      // Create a minimal parent object that the manager expects
      const parentManager = {
        companyId: currentCompanyId
      };
      
      if (!aiCoreLiveScenariosManager) {
        aiCoreLiveScenariosManager = new window.AiCoreLiveScenariosManager(parentManager);
      }
      
      await aiCoreLiveScenariosManager.load();
    }
    
    async function loadPlaceholders() {
      const tbody = document.getElementById('placeholders-list');
      
      try {
        // Load from company.variables (legacy) until we have a proper placeholders endpoint
        const response = await fetch(`/api/company/${currentCompanyId}`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (response.ok) {
          const data = await response.json();
          const company = data.company || data;
          const variables = company.variables || {};
          
          currentPlaceholders = variables;
          
          if (Object.keys(variables).length === 0) {
            tbody.innerHTML = `
              <tr>
                <td colspan="3" style="text-align: center; padding: 40px; color: #94a3b8;">
                  <i class="fas fa-tags" style="font-size: 32px; margin-bottom: 12px; display: block;"></i>
                  No placeholders yet. Click "Add Placeholder" or "Import Defaults".
                </td>
              </tr>
            `;
          } else {
            tbody.innerHTML = Object.entries(variables).map(([key, value]) => `
              <tr data-placeholder-key="${key}">
                <td>
                  <code style="background: #f1f5f9; padding: 4px 8px; border-radius: 4px; font-size: 13px;">{${key}}</code>
                </td>
                <td>
                  <input type="text" value="${escapeHtml(value)}" 
                         onchange="updatePlaceholder('${key}', this.value)"
                         style="width: 100%; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px;">
                </td>
                <td>
                  <button onclick="deletePlaceholder('${key}')" style="padding: 6px 12px; border: none; background: #fee2e2; color: #dc2626; border-radius: 6px; cursor: pointer; font-size: 12px;">
                    <i class="fas fa-trash"></i>
                  </button>
            </td>
          </tr>
        `).join('');
          }
        }
      } catch (error) {
        console.error('Failed to load placeholders:', error);
        tbody.innerHTML = `
          <tr>
            <td colspan="3" style="text-align: center; padding: 40px; color: #ef4444;">
              <i class="fas fa-exclamation-triangle" style="font-size: 24px; margin-bottom: 12px; display: block;"></i>
              Failed to load placeholders: ${error.message}
            </td>
          </tr>
        `;
      }
    }
    
    function addPlaceholder() {
      const name = prompt('Enter placeholder name (no spaces, e.g., "companyName"):');
      if (!name) return;
      
      const sanitizedName = name.replace(/[^a-zA-Z0-9_]/g, '');
      if (!sanitizedName) {
        alert('Invalid placeholder name');
        return;
      }
      
      if (currentPlaceholders[sanitizedName]) {
        alert('Placeholder already exists');
        return;
      }
      
      currentPlaceholders[sanitizedName] = '';
      loadPlaceholders();
    }
    
    function updatePlaceholder(key, value) {
      currentPlaceholders[key] = value;
    }
    
    function deletePlaceholder(key) {
      if (confirm(`Delete placeholder {${key}}?`)) {
        delete currentPlaceholders[key];
        loadPlaceholders();
      }
    }
    
    async function savePlaceholders() {
      try {
        const response = await fetch(`/api/company/${currentCompanyId}`, {
          method: 'PATCH',
          headers: {
            'Authorization': `Bearer ${authToken}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ variables: currentPlaceholders })
        });
        
        if (response.ok) {
          alert('âœ… Placeholders saved!');
        } else {
          throw new Error('Failed to save');
        }
      } catch (error) {
        alert('âŒ Failed to save placeholders: ' + error.message);
      }
    }
    
    async function importPlaceholderDefaults() {
      // Import common defaults
      const defaults = {
        companyName: '',
        companyPhone: '',
        companyAddress: '',
        businessHours: 'Monday-Friday 8am-5pm',
        serviceArea: '',
        emergencyPhone: '',
        websiteUrl: ''
      };
      
      currentPlaceholders = { ...defaults, ...currentPlaceholders };
      loadPlaceholders();
      alert('âœ… Default placeholders imported. Fill in the values and click Save.');
    }
    
    function resetPlaceholders() {
      if (confirm('Reset all placeholders to defaults? This will clear custom values.')) {
        currentPlaceholders = {};
        importPlaceholderDefaults();
      }
    }
    
    // OLD loadTemplates/loadScenarios removed
    // Now using AiCoreTemplatesManager and AiCoreLiveScenariosManager (the original managers)
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text || '';
      return div.innerHTML;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LEGACY TAB - Full Inventory & Read-Only View
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let fullInventory = null;
    
    async function initLegacy() {
      console.log('ğŸ“¦ [INIT] Initializing Legacy tab...');
      // Auto-load inventory when tab is first opened
      await loadFullInventory();
      console.log('âœ… [INIT] Legacy tab initialized');
    }
    
    async function loadFullInventory() {
      const btn = document.getElementById('btn-load-inventory');
      const jsonDisplay = document.getElementById('legacy-full-json');
      
      try {
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
        btn.disabled = true;
        
        const response = await fetch(`/api/company/${currentCompanyId}/full-inventory`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (!response.ok) {
          throw new Error(`Failed to fetch inventory: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.success && data.inventory) {
          fullInventory = data.inventory;
          
          // Update full JSON display
          jsonDisplay.textContent = JSON.stringify(data.inventory, null, 2);
          
          // Update summary stats
          const summaryDiv = document.getElementById('inventory-summary');
          const statsGrid = document.getElementById('inventory-stats-grid');
          summaryDiv.style.display = 'block';
          
          const inv = data.inventory;
          const collections = inv.collections || {};
          const separate = inv.separateCollections || {};
          
          statsGrid.innerHTML = `
            <div style="background: #fef3c7; padding: 12px; border-radius: 8px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #92400e;">${collections.triage?.count || 0}</div>
              <div style="font-size: 11px; color: #a16207;">Triage Cards</div>
            </div>
            <div style="background: #e0e7ff; padding: 12px; border-radius: 8px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #4338ca;">${collections.behaviorRules?.count || 0}</div>
              <div style="font-size: 11px; color: #6366f1;">Behavior Rules</div>
            </div>
            <div style="background: #d1fae5; padding: 12px; border-radius: 8px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #059669;">${collections.guardrails?.count || 0}</div>
              <div style="font-size: 11px; color: #10b981;">Guardrails</div>
            </div>
            <div style="background: #cffafe; padding: 12px; border-radius: 8px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #0891b2;">${collections.variablesLegacy?.count || 0}</div>
              <div style="font-size: 11px; color: #06b6d4;">Variables</div>
            </div>
            <div style="background: #fce7f3; padding: 12px; border-radius: 8px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #be185d;">${collections.calculators?.count || 0}</div>
              <div style="font-size: 11px; color: #ec4899;">Calculators</div>
            </div>
            <div style="background: #ffedd5; padding: 12px; border-radius: 8px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #c2410c;">${separate.blackBoxRecordings?.count || 0}</div>
              <div style="font-size: 11px; color: #f97316;">Black Box</div>
            </div>
            <div style="background: #f1f5f9; padding: 12px; border-radius: 8px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #475569;">${separate.dynamicFlows?.count || 0}</div>
              <div style="font-size: 11px; color: #64748b;">Dynamic Flows</div>
            </div>
            <div style="background: #f1f5f9; padding: 12px; border-radius: 8px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #475569;">${collections.transferRules?.count || 0}</div>
              <div style="font-size: 11px; color: #64748b;">Transfer Rules</div>
            </div>
          `;
          
          // Update individual section counts
          document.getElementById('triage-count').textContent = collections.triage?.count || 0;
          document.getElementById('mission-count').textContent = collections.missionControl?.exists ? 'âœ“' : 'â€”';
          document.getElementById('behavior-count').textContent = collections.behaviorRules?.count || 0;
          document.getElementById('guardrails-count').textContent = collections.guardrails?.count || 0;
          document.getElementById('variables-count').textContent = collections.variablesLegacy?.count || 0;
          document.getElementById('calculators-count').textContent = collections.calculators?.count || 0;
          document.getElementById('blackbox-count').textContent = separate.blackBoxRecordings?.count || 0;
          
          // Update section JSON displays
          document.getElementById('legacy-triage-json').textContent = JSON.stringify(collections.triage, null, 2);
          document.getElementById('legacy-mission-json').textContent = JSON.stringify(collections.missionControl, null, 2);
          document.getElementById('legacy-behavior-json').textContent = JSON.stringify(collections.behaviorRules, null, 2);
          document.getElementById('legacy-guardrails-json').textContent = JSON.stringify(collections.guardrails, null, 2);
          document.getElementById('legacy-variables-json').textContent = JSON.stringify(collections.variablesLegacy, null, 2);
          document.getElementById('legacy-calculators-json').textContent = JSON.stringify(collections.calculators, null, 2);
          document.getElementById('legacy-blackbox-json').textContent = JSON.stringify(separate.blackBoxRecordings, null, 2);
          
          console.log('âœ… [INVENTORY] Loaded:', {
            triage: collections.triage?.count,
            variables: collections.variablesLegacy?.count,
            dynamicFlows: separate.dynamicFlows?.count
          });
        }
        
      } catch (error) {
        console.error('âŒ [INVENTORY] Error:', error);
        jsonDisplay.textContent = JSON.stringify({
          error: true,
          message: error.message,
          timestamp: new Date().toISOString()
        }, null, 2);
      } finally {
        btn.innerHTML = '<i class="fas fa-search"></i> Load Full Inventory (Prove Nothing Lost)';
        btn.disabled = false;
      }
    }
    
    function toggleLegacySection(section) {
      const content = document.getElementById(`legacy-${section}`);
      if (content) {
        content.style.display = content.style.display === 'none' ? 'block' : 'none';
      }
    }
    
    function copyInventoryJson() {
      const jsonDisplay = document.getElementById('legacy-full-json');
      navigator.clipboard.writeText(jsonDisplay.textContent).then(() => {
        const btn = document.getElementById('btn-copy-inventory');
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
        setTimeout(() => { btn.innerHTML = originalHTML; }, 2000);
      }).catch(err => {
        alert('Failed to copy: ' + err.message);
      });
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // AI TEST CONSOLE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function openAITestConsole() {
      if (!currentCompanyId) {
        alert('Please select a company first');
        return;
      }
      
      if (!window.AITestConsole) {
        await loadScript('/js/ai-agent-settings/AITestConsole.js');
      }
      
      const testConsole = new window.AITestConsole(currentCompanyId);
      testConsole.open();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SYSTEM SNAPSHOT - Single Source of Truth
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let currentSnapshot = null;
    
    async function refreshSystemSnapshot() {
      if (!currentCompanyId) {
        alert('No company selected');
        return;
      }
      
      const refreshIcon = document.getElementById('refresh-icon');
      const jsonDisplay = document.getElementById('snapshot-json');
      
      try {
        // Show loading state
        if (refreshIcon) refreshIcon.classList.add('fa-spin');
        jsonDisplay.textContent = '{\n  "loading": true,\n  "message": "Generating system snapshot..."\n}';
        
        const response = await fetch(`/api/company/${currentCompanyId}/system-snapshot`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (!response.ok) {
          throw new Error(`Failed to fetch snapshot: ${response.status}`);
        }
        
          const data = await response.json();
        
        if (data.success && data.snapshot) {
          currentSnapshot = data.snapshot;
          
          // Update display
          jsonDisplay.textContent = JSON.stringify(data.snapshot, null, 2);
          
          // Update stats
          document.getElementById('stat-flows').textContent = data.snapshot.dynamicFlows?.length || 0;
          document.getElementById('stat-transfers').textContent = data.snapshot.transferTargets?.length || 0;
          document.getElementById('stat-contacts').textContent = data.snapshot.companyContacts?.length || 0;
          
          // Update timestamp
          document.getElementById('snapshot-timestamp').textContent = new Date(data.snapshot.timestamp).toLocaleTimeString();
          document.getElementById('snapshot-generation-time').textContent = data.snapshot.generatedIn;
          
          // Update mode indicator
          const modeIcon = document.getElementById('snapshot-mode-icon');
          const modeText = document.getElementById('snapshot-mode-text');
          const statusDiv = document.getElementById('snapshot-status');
          
          if (data.snapshot.mode === 'LIVE') {
            modeIcon.textContent = 'ğŸŸ¢';
            modeText.textContent = 'LIVE CALL';
            statusDiv.style.background = 'rgba(16, 185, 129, 0.2)';
            statusDiv.style.color = 'var(--accent-green)';
        } else {
            modeIcon.textContent = 'ğŸŸ¡';
            modeText.textContent = 'IDLE';
            statusDiv.style.background = 'rgba(249, 115, 22, 0.2)';
            statusDiv.style.color = 'var(--accent-orange)';
          }
          
          // Update Flow Tree status
          const flowTreeStatus = document.getElementById('flow-tree-status');
          if (flowTreeStatus) {
            if (data.snapshot.mode === 'LIVE') {
              flowTreeStatus.innerHTML = '<i class="fas fa-circle" style="color: var(--accent-green);"></i><span>Live Call</span>';
              flowTreeStatus.style.background = 'rgba(16, 185, 129, 0.2)';
              flowTreeStatus.style.color = 'var(--accent-green)';
            } else {
              flowTreeStatus.innerHTML = '<i class="fas fa-circle"></i><span>Ready</span>';
              flowTreeStatus.style.background = 'rgba(16, 185, 129, 0.2)';
              flowTreeStatus.style.color = 'var(--accent-green)';
            }
          }
          
          console.log('âœ… [SNAPSHOT] System snapshot loaded:', {
            mode: data.snapshot.mode,
            flows: data.snapshot.dynamicFlows?.length,
            generatedIn: data.snapshot.generatedIn
          });
          
        } else {
          throw new Error(data.error || 'Unknown error');
        }
        
      } catch (error) {
        console.error('âŒ [SNAPSHOT] Error:', error);
        jsonDisplay.textContent = JSON.stringify({
          error: true,
          message: error.message,
          timestamp: new Date().toISOString()
        }, null, 2);
      } finally {
        if (refreshIcon) refreshIcon.classList.remove('fa-spin');
      }
    }
    
    function copySystemSnapshot() {
      const jsonDisplay = document.getElementById('snapshot-json');
      const text = jsonDisplay.textContent;
      
      navigator.clipboard.writeText(text).then(() => {
        // Visual feedback
        const btn = document.getElementById('btn-copy-snapshot');
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i><span>âœ… Copied!</span>';
        btn.style.background = 'var(--accent-green)';
        btn.style.borderColor = 'var(--accent-green)';
        
        setTimeout(() => {
          btn.innerHTML = originalHTML;
          btn.style.background = 'var(--accent-orange)';
          btn.style.borderColor = 'var(--accent-orange)';
        }, 2000);
        
        console.log('ğŸ“‹ [SNAPSHOT] Copied to clipboard');
      }).catch(err => {
        console.error('âŒ [SNAPSHOT] Failed to copy:', err);
        alert('Failed to copy to clipboard');
      });
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // EVENT LISTENERS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    document.addEventListener('DOMContentLoaded', () => {
      // Wire up nav tabs
      document.querySelectorAll('.nav-tab').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const tabId = btn.getAttribute('data-tab');
          // Skip for Call Center (opens in new tab)
          if (tabId === 'call-center') return;
          switchTab(tabId);
        });
      });
      
      // Auto-initialize Front Desk (default tab)
      if (currentCompanyId) {
        initializeTab('front-desk');
      } else {
        document.getElementById('front-desk-container').innerHTML = `
          <div style="padding: 60px; text-align: center; color: #ef4444;">
            <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 16px;"></i>
            <h3>No Company Selected</h3>
            <p>Please add ?companyId=... to the URL</p>
          </div>
        `;
      }
    });
    
    console.log('âœ… [CONTROL PLANE] Clean Architecture loaded - Dec 2025');
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PLATFORM SNAPSHOT (Enterprise Introspection)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    let currentSnapshot = null;
    let currentSnapshotScope = 'full';
    
    // Load badge on page load
    async function loadSnapshotBadge() {
      try {
        const response = await fetch(`/api/company/${companyId}/platform-snapshot/badge`, {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
        });
        const data = await response.json();
        
        if (data.success && data.badge) {
          const badge = data.badge;
          document.getElementById('json-badge-emoji').textContent = badge.emoji;
          
          const scoreEl = document.getElementById('json-badge-score');
          scoreEl.textContent = badge.score + '%';
          scoreEl.className = 'json-badge-score ' + badge.status.toLowerCase();
        }
      } catch (error) {
        console.warn('[SNAPSHOT] Badge load failed:', error);
      }
    }
    
    // Initialize badge on page load
    setTimeout(loadSnapshotBadge, 1000);
    
    async function openPlatformSnapshotModal() {
      const overlay = document.getElementById('snapshot-modal-overlay');
      overlay.classList.add('active');
      
      // Load snapshot
      await loadPlatformSnapshot(currentSnapshotScope);
    }
    
    function closePlatformSnapshotModal() {
      const overlay = document.getElementById('snapshot-modal-overlay');
      overlay.classList.remove('active');
    }
    
    async function loadPlatformSnapshot(scope = 'full') {
      currentSnapshotScope = scope;
      
      const jsonPre = document.getElementById('snapshot-json-content');
      const statusBadge = document.getElementById('snapshot-status-badge');
      const penaltiesPanel = document.getElementById('snapshot-penalties-panel');
      const summaryText = document.getElementById('snapshot-summary-text');
      const genTimeText = document.getElementById('snapshot-gen-time');
      
      // Show loading
      jsonPre.textContent = 'Loading snapshot...';
      statusBadge.textContent = 'â³ Loading';
      statusBadge.className = 'snapshot-status-badge';
      
      try {
        const response = await fetch(`/api/company/${companyId}/platform-snapshot?scope=${scope}`, {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('adminToken')}` }
        });
        const data = await response.json();
        
        if (!data.success) {
          throw new Error(data.error || 'Failed to load snapshot');
        }
        
        currentSnapshot = data.snapshot;
        const completeness = currentSnapshot.completeness || {};
        
        // Update status badge
        const emoji = completeness.status === 'GREEN' ? 'ğŸŸ¢' : 
                      completeness.status === 'YELLOW' ? 'ğŸŸ¡' : 'ğŸ”´';
        statusBadge.textContent = `${emoji} ${completeness.score}% (${completeness.grade})`;
        statusBadge.className = `snapshot-status-badge ${completeness.status?.toLowerCase() || 'yellow'}`;
        
        // Update summary
        summaryText.textContent = completeness.summary || '';
        
        // Update generation time
        genTimeText.textContent = `Generated in ${currentSnapshot.meta?.generationMs || 0}ms`;
        
        // Update penalties panel
        const penalties = completeness.penalties || [];
        if (penalties.length > 0) {
          penaltiesPanel.style.display = 'block';
          penaltiesPanel.className = `snapshot-penalties-panel ${completeness.status?.toLowerCase()}`;
          penaltiesPanel.innerHTML = `
            <div style="font-weight: 600; margin-bottom: 12px;">
              âš ï¸ ${penalties.length} Issue${penalties.length > 1 ? 's' : ''} Found
            </div>
            ${penalties.map(p => `
              <div style="display: flex; align-items: center; gap: 8px; padding: 8px; background: rgba(255,255,255,0.5); border-radius: 6px; margin-bottom: 6px;">
                <span style="font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: 600;
                  background: ${p.severity === 'RED' ? '#ef4444' : p.severity === 'YELLOW' ? '#f59e0b' : '#10b981'};
                  color: white;">${p.severity}</span>
                <span style="flex: 1; font-size: 13px; color: #374151;">${p.message}</span>
                <span style="font-size: 12px; color: #6b7280;">-${p.weight}</span>
              </div>
            `).join('')}
            ${(completeness.recommendations || []).length > 0 ? `
              <div style="margin-top: 16px; padding-top: 16px; border-top: 1px dashed rgba(0,0,0,0.2);">
                <div style="font-weight: 600; margin-bottom: 8px; font-size: 13px;">ğŸ’¡ Recommendations</div>
                ${completeness.recommendations.map(r => `
                  <div style="font-size: 12px; color: #4b5563; padding: 4px 0;">â€¢ ${r}</div>
                `).join('')}
              </div>
            ` : ''}
          `;
        } else {
          penaltiesPanel.style.display = 'none';
        }
        
        // Update JSON display
        jsonPre.textContent = JSON.stringify(currentSnapshot, null, 2);
        
        // Update header badge too
        loadSnapshotBadge();
        
      } catch (error) {
        console.error('[SNAPSHOT] Load failed:', error);
        jsonPre.textContent = `Error: ${error.message}`;
        statusBadge.textContent = 'ğŸ”´ Error';
        statusBadge.className = 'snapshot-status-badge red';
        summaryText.textContent = error.message;
        penaltiesPanel.style.display = 'none';
      }
    }
    
    function copySnapshotToClipboard() {
      if (!currentSnapshot) {
        alert('No snapshot loaded');
        return;
      }
      
      const jsonText = JSON.stringify(currentSnapshot, null, 2);
      navigator.clipboard.writeText(jsonText).then(() => {
        const btn = document.getElementById('btn-copy-snapshot');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
        btn.style.background = '#10b981';
        setTimeout(() => {
          btn.innerHTML = originalText;
          btn.style.background = '';
        }, 2000);
      }).catch(err => {
        alert('Failed to copy: ' + err);
      });
    }
    
    function refreshPlatformSnapshot() {
      loadPlatformSnapshot(currentSnapshotScope);
    }
    
    function changeSnapshotScope(scope) {
      loadPlatformSnapshot(scope);
    }
  </script>
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PLATFORM SNAPSHOT MODAL
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="snapshot-modal-overlay" class="snapshot-modal-overlay" onclick="if(event.target === this) closePlatformSnapshotModal()">
    <div class="snapshot-modal">
      
      <!-- Header -->
      <div class="snapshot-modal-header">
        <div class="snapshot-modal-title">
          <h2 style="margin: 0; font-size: 18px; font-weight: 600;">ğŸ“„ Platform Snapshot</h2>
          <span id="snapshot-status-badge" class="snapshot-status-badge">Loading...</span>
        </div>
        <div class="snapshot-modal-controls">
          <button id="btn-copy-snapshot" onclick="copySnapshotToClipboard()" 
                  style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 6px;">
            <i class="fas fa-copy"></i> Copy JSON
          </button>
          <button onclick="refreshPlatformSnapshot()" 
                  style="padding: 8px 16px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 6px;">
            <i class="fas fa-sync-alt"></i> Refresh
          </button>
          <button onclick="closePlatformSnapshotModal()" 
                  style="padding: 8px 16px; background: transparent; color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; cursor: pointer; font-weight: 500;">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      
      <!-- Body -->
      <div class="snapshot-modal-body">
        
        <!-- Scope Selector -->
        <div class="snapshot-scope-selector">
          <span class="snapshot-scope-label">Snapshot Scope:</span>
          <div class="snapshot-scope-options">
            <label><input type="radio" name="snapshot-scope" value="full" checked onchange="changeSnapshotScope('full')"> FULL PLATFORM</label>
            <label><input type="radio" name="snapshot-scope" value="control" onchange="changeSnapshotScope('control')"> Control Plane Only</label>
            <label><input type="radio" name="snapshot-scope" value="scenarios" onchange="changeSnapshotScope('scenarios')"> Scenario Brain Only</label>
            <label><input type="radio" name="snapshot-scope" value="runtime" onchange="changeSnapshotScope('runtime')"> Runtime Wiring</label>
          </div>
        </div>
        
        <!-- Penalties Panel (conditional) -->
        <div id="snapshot-penalties-panel" class="snapshot-penalties-panel" style="display: none;">
          <!-- Populated by JS -->
        </div>
        
        <!-- JSON Display -->
        <div class="snapshot-json-container">
          <pre id="snapshot-json-content" class="snapshot-json-pre">Click "Refresh" to load snapshot...</pre>
        </div>
        
      </div>
      
      <!-- Footer -->
      <div class="snapshot-modal-footer">
        <div style="display: flex; align-items: center; gap: 16px;">
          <span id="snapshot-summary-text" style="font-size: 14px; color: #64748b;"></span>
        </div>
        <div style="display: flex; align-items: center; gap: 16px;">
          <span id="snapshot-gen-time" style="font-size: 12px; color: #94a3b8;"></span>
          <span style="font-size: 12px; color: #94a3b8;">v1.0</span>
        </div>
      </div>
      
    </div>
  </div>
  
</body>
</html>
