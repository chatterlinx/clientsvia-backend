<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Company Profile</title>
    <link rel="icon" href="/favicon.ico">
    
    <!-- Tailwind CSS (Production Build) -->
    <link rel="stylesheet" href="/css/output.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        
        /* Global Navigation Styling */
        .nav-link-global { 
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #6B7280;
            text-decoration: none;
            transition: all 0.2s ease-in-out;
            border: 1px solid transparent;
        }
        .nav-link-global:hover {
            color: #4F46E5;
            background-color: #EEF2FF;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .nav-link-global.active { 
            background-color: #4F46E5;
            color: white;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(79, 70, 229, 0.3);
        }
        
        /* Tab Navigation Styling */
        .nav-link.active-tab { border-bottom-width: 2px; border-color: #4F46E5; color: #4F46E5; font-weight: 600; background-color: #EEF2FF; }
        .nav-link { @apply px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100 hover:text-gray-900; }
        
        .profile-section-title { @apply text-xl font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-200; }
        .detail-item { @apply flex flex-col sm:flex-row py-2; }
        .detail-label { @apply sm:w-1/3 font-medium text-gray-600 mb-1 sm:mb-0; }
        .detail-value { @apply sm:w-2/3 text-gray-800; }
        .config-block { @apply mt-3 p-4 border border-gray-200 rounded-md bg-gray-50; }
        .form-input, .form-select, .form-textarea, .form-checkbox { @apply mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm transition duration-150 ease-in-out; }
        .form-checkbox { @apply w-auto h-4 text-indigo-600; } 
        .form-label { @apply block text-sm font-medium text-gray-700; }
        .form-check-label { @apply ml-2 text-sm text-gray-700; }
        .tab-button { padding: 0.5rem 1rem; font-weight: 500; font-size: 0.875rem; line-height: 1.25rem; border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem; transition-property: color, background-color, border-color, text-decoration-color, fill, stroke; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; cursor: pointer; }
        .tab-button:focus { outline: 2px solid transparent; outline-offset: 2px; }
        .tab-button-active { background-color: #4F46E5; color: white; }
        .tab-button-inactive { background-color: #E5E7EB; color: #374151; }
        .tab-button-inactive:hover { background-color: #D1D5DB; }
        .tab-content-item { @apply p-0 pt-6; } 
        .tab-content-item.hidden { display: none; }
        .notes-textarea { @apply w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out; min-height: 150px; }
        .wider-textbox { max-width: 800px; width: 100%; }
        .note-card { @apply bg-white p-4 rounded-lg shadow border border-gray-200 mb-4; }
        .note-card.pinned { @apply bg-yellow-50 border-yellow-300; }
        .note-content { @apply text-gray-800 whitespace-pre-wrap; }
        .note-timestamps { @apply text-xs text-gray-500 mt-2; }
        .note-actions { @apply mt-3 flex items-center space-x-3; }
        .note-action-button { @apply text-xs text-indigo-600 hover:text-indigo-800 font-medium; }
        .note-action-button .fa-thumbtack.pinned-icon { color: #F59E0B; }
        .status-badge { @apply px-2.5 py-0.5 rounded-full text-xs font-medium; }
        .status-active { @apply bg-green-100 text-green-800; }
        .status-inactive { @apply bg-red-100 text-red-800; }

        


        
        .contact-block-view { @apply mt-3 pt-3 border-t border-gray-200; }
        .contact-block-view .detail-item:last-child { padding-bottom: 0; }
        .scheduling-rule-daily-hours-header { @apply grid grid-cols-4 gap-x-3 mb-1 px-2 text-xs font-medium text-gray-500; }
        .scheduling-rule-daily-hours-row { @apply grid grid-cols-4 gap-x-3 items-center p-2 hover:bg-gray-100 rounded-md; }
        #toast-notification { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: #333; color: white; padding: 10px 20px; border-radius: 5px; z-index: 1000; opacity: 0; transition: opacity 0.5s ease-in-out; }
        #toast-notification.show { opacity: 1; }
        #toast-notification.success { background-color: #4CAF50; }
        #toast-notification.error { background-color: #f44336; }
        @media (min-width: 768px) { .wider-textbox { max-width: 800px; } }
        @media (max-width: 767px) { .wider-textbox { max-width: 100%; } }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app" class="flex flex-col min-h-screen">
        <header class="bg-white shadow-md sticky top-0 z-40">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex-shrink-0">
                        <a href="/index.html" class="text-2xl font-bold text-indigo-600">
                            <i class="fas fa-tachometer-alt mr-2"></i>Admin Dashboard
                        </a>
                    </div>
                    <nav class="hidden md:flex items-center" style="gap: 20px;">
                        <a href="/index.html" class="nav-link-global" id="nav-home">Home</a>
                        <a href="/directory.html" class="nav-link-global" id="nav-directory">Directory</a>
                        <a href="/add-company.html" class="nav-link-global" id="nav-add-company">Add Company</a>
                        <a href="/trade-category-management.html" class="nav-link-global" id="nav-trade-categories">Trade Categories</a>
                        <a href="/company-profile.html" class="nav-link-global active" id="nav-company-profile">Company Profile</a>
                    </nav>
                    <div class="md:hidden flex items-center">
                        <button id="mobile-menu-button" class="text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500">
                            <span class="sr-only">Open main menu</span>
                            <i class="fas fa-bars text-2xl"></i>
                        </button>
                    </div>
                </div>

            <!-- ...existing code... -->
            <div id="mobile-menu" class="md:hidden hidden">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <a href="/index.html" class="block nav-link text-base">Home</a>
                    <a href="/directory.html" class="block nav-link text-base">Directory</a>
                    <a href="/add-company.html" class="block nav-link text-base">Add Company</a>
                    <a href="/trade-category-management.html" class="block nav-link text-base">Trade Categories</a>
                    <a href="/company-profile.html" class="block nav-link text-base">Company Profile</a>
                </div>
            </div>
        </header>

        <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-1">
                    <div> 
                        <h1 class="text-3xl font-semibold text-gray-800" id="company-name-header">Loading...</h1>
                        <p id="company-id-subheader" class="text-xs text-gray-500 mt-1">ID: Loading...</p> 
                    </div>
                    <div class="flex items-center gap-x-3 mt-3 md:mt-0">
                         <span id="company-status-badge" class="status-badge mr-3">Status</span> 
                    </div>
                </div>
                <hr class="mb-6 mt-3">

                <div class="mb-6">
                    <div class="border-b border-gray-300">
                        <nav class="-mb-px flex flex-wrap space-x-1" aria-label="Tabs">
                            <button class="tab-button tab-button-active" id="tab-overview" data-tab="overview">
                                <i class="fas fa-info-circle mr-1"></i>Overview
                            </button>
                            <button class="tab-button tab-button-inactive" id="tab-config" data-tab="config">
                                <i class="fas fa-cogs mr-1"></i>Configuration
                            </button>
                            <button class="tab-button tab-button-inactive" id="tab-notes" data-tab="notes">
                                <i class="fas fa-sticky-note mr-1"></i>Notes
                            </button>
                             <button class="tab-button tab-button-inactive" id="tab-calendar-settings" data-tab="calendar-settings">
                                <i class="fas fa-calendar-alt mr-1"></i>Calendar Settings
                            </button>
                            <button class="tab-button tab-button-inactive" id="tab-ai-settings" data-tab="ai-settings">
                                <i class="fas fa-robot mr-1"></i>AI Settings
                            </button>
                            <button class="tab-button tab-button-inactive" id="tab-ai-voice" data-tab="ai-voice">
                                <i class="fas fa-microphone-alt mr-1"></i>AI Voice Settings
                            </button>
                            <button class="tab-button tab-button-inactive" id="tab-personality-responses" data-tab="personality-responses">
                                <i class="fas fa-comment-dots mr-1"></i>Agent Personality Responses
                            </button>
                            <button class="tab-button tab-button-inactive" id="tab-ai-agent-logic" data-tab="ai-agent-logic">
                                <i class="fas fa-brain mr-1"></i>AI Agent Logic
                            </button>

                        </nav>
                    </div>
                </div>

                <div id="tab-content-area">
                    <div id="overview-content" class="tab-content-item">
                        <section class="profile-section bg-transparent shadow-none p-0">
                            <div id="company-details-edit-form">
                                <!-- Modern form will be inserted here by JavaScript -->
                                <p class="text-gray-500 text-center py-8">Loading company information...</p>
                            </div>
                            <!-- Company Contacts Section -->
                            <div id="company-contacts-section" class="mt-8">
                                <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                    <i class="fas fa-address-book mr-2 text-indigo-600"></i>Company Contacts
                                </h2>
                                <div id="contacts-list" class="space-y-6"></div>
                                <button type="button" id="add-contact-btn" class="mt-4 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition duration-150">
                                    <i class="fas fa-plus mr-1"></i>Add Contact
                                </button>
                            </div>
                        </section>
                    </div>

                    <div id="config-content" class="tab-content-item hidden">
                        <section class="profile-section bg-transparent shadow-none p-0">
                            <h2 class="profile-section-title"><i class="fas fa-cogs mr-2 text-indigo-600"></i>Service Configuration</h2>
                            <form id="config-settings-form">
                                <div class="config-block">
                                    <h3 class="font-semibold text-gray-700 mb-2">Twilio Integration Credentials</h3>
                                    <p class="text-sm text-gray-500 mb-3">Enter the Twilio credentials that this company's AI agent will use.</p>
                                    <div class="space-y-3">
                                        <div>
                                            <label for="twilioAccountSid" class="form-label">Account SID</label>
                                            <input type="text" id="twilioAccountSid" name="twilioAccountSid" class="form-input wider-textbox" placeholder="ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                                        </div>
                                        <div>
                                            <label for="twilioAuthToken" class="form-label">Auth Token</label>
                                            <input type="text" id="twilioAuthToken" name="twilioAuthToken" class="form-input wider-textbox" placeholder="Enter Auth Token" style="font-family: monospace;">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Phone Numbers Management -->
                                <div class="config-block mt-6">
                                    <div class="flex justify-between items-center mb-3">
                                        <h3 class="font-semibold text-gray-700">Twilio Phone Numbers</h3>
                                        <button type="button" id="addPhoneNumberBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white text-sm px-3 py-1 rounded-md flex items-center">
                                            <i class="fas fa-plus mr-1"></i>Add Number
                                        </button>
                                    </div>
                                    <p class="text-sm text-gray-500 mb-3">Manage all Twilio phone numbers available for this company's AI agents.</p>
                                    
                                    <!-- Phone Numbers List -->
                                    <div id="phoneNumbersList" class="space-y-3">
                                        <!-- Primary Phone Number (Default) -->
                                        <div class="phone-number-item border border-gray-200 rounded-lg p-4 bg-gray-50">
                                            <div class="flex items-center justify-between">
                                                <div class="flex-1 grid grid-cols-1 md:grid-cols-3 gap-4">
                                                    <div>
                                                        <label class="form-label text-sm">Phone Number (E.164 format)</label>
                                                        <input type="tel" name="phoneNumber" class="form-input" placeholder="+12395551212" value="">
                                                    </div>
                                                    <div>
                                                        <label class="form-label text-sm">Friendly Name</label>
                                                        <input type="text" name="friendlyName" class="form-input" placeholder="Main Business Line" value="Primary Number">
                                                    </div>
                                                    <div>
                                                        <label class="form-label text-sm">Status</label>
                                                        <select name="status" class="form-select">
                                                            <option value="active" selected>Active</option>
                                                            <option value="inactive">Inactive</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="ml-4 flex items-center space-x-2">
                                                    <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">Primary</span>
                                                    <button type="button" class="text-red-600 hover:text-red-800" title="Remove">
                                                        <i class="fas fa-trash text-sm"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Add Phone Number Template (Hidden) -->
                                    <template id="phoneNumberTemplate">
                                        <div class="phone-number-item border border-gray-200 rounded-lg p-4">
                                            <div class="flex items-center justify-between">
                                                <div class="flex-1 grid grid-cols-1 md:grid-cols-3 gap-4">
                                                    <div>
                                                        <label class="form-label text-sm">Phone Number (E.164 format)</label>
                                                        <input type="tel" name="phoneNumber" class="form-input" placeholder="+12395551212">
                                                    </div>
                                                    <div>
                                                        <label class="form-label text-sm">Friendly Name</label>
                                                        <input type="text" name="friendlyName" class="form-input" placeholder="e.g., Emergency Line, Sales Line">
                                                    </div>
                                                    <div>
                                                        <label class="form-label text-sm">Status</label>
                                                        <select name="status" class="form-select">
                                                            <option value="active" selected>Active</option>
                                                            <option value="inactive">Inactive</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="ml-4 flex items-center space-x-2">
                                                    <button type="button" class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full hover:bg-blue-200" title="Set as Primary">
                                                        Set Primary
                                                    </button>
                                                    <button type="button" class="text-red-600 hover:text-red-800" title="Remove">
                                                        <i class="fas fa-trash text-sm"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                                
                                <!-- Webhook Configuration Reference -->
                                <div class="config-block mt-6">
                                    <div class="flex justify-between items-center mb-3">
                                        <h3 class="font-semibold text-gray-700">Twilio Webhook Configuration</h3>
                                        <button type="button" id="toggleWebhookInfo" class="text-indigo-600 hover:text-indigo-800 text-sm flex items-center">
                                            <i class="fas fa-info-circle mr-1"></i>Show Webhook URLs
                                        </button>
                                    </div>
                                    <p class="text-sm text-gray-500 mb-3">Use these webhook URLs in your Twilio Console for phone number configuration.</p>
                                    
                                    <div id="webhookInfoPanel" class="hidden">
                                        <!-- Dynamic webhook content will be generated by JavaScript -->
                                    </div>
                                </div>
                                
                                <!-- Additional API Configuration -->
                                <div class="config-block mt-6">
                                    <h3 class="font-semibold text-gray-700 mb-2">Additional API Keys</h3>
                                    <p class="text-sm text-gray-500 mb-3">Configure additional integrations and services.</p>
                                    <div class="space-y-3">
                                        <div>
                                            <label for="twilioApiKey" class="form-label">Twilio API Key (Optional)</label>
                                            <input type="text" id="twilioApiKey" name="twilioApiKey" class="form-input wider-textbox" placeholder="SKxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" style="font-family: monospace;">
                                        </div>
                                        <div>
                                            <label for="twilioApiSecret" class="form-label">Twilio API Secret (Optional)</label>
                                            <input type="text" id="twilioApiSecret" name="twilioApiSecret" class="form-input wider-textbox" placeholder="Enter API Secret" style="font-family: monospace;">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-8 pt-5 border-t border-gray-200">
                                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-150 ease-in-out">
                                        <i class="fas fa-save mr-2"></i>Save Configuration
                                    </button>
                                </div>
                            </form>
                        </section>
                    </div>

                    <div id="notes-content" class="tab-content-item hidden">
                        <section class="profile-section bg-transparent shadow-none p-0"> 
                            <h2 class="profile-section-title"><i class="fas fa-sticky-note mr-2 text-indigo-600"></i>Company Notes</h2>
                            <div id="add-note-area" class="mb-6">
                                <textarea id="new-note-textarea" class="notes-textarea wider-textbox" placeholder="Type your new note here..."></textarea>
                                <button id="add-new-note-button" class="mt-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out">
                                    <i class="fas fa-plus-circle mr-2"></i>Add Note
                                </button>
                            </div>
                            <div id="notes-display-area">
                                <p class="text-gray-500 italic text-center py-4">Notes will appear here.</p>
                            </div>
                        </section>
                    </div>
                    
                    <div id="calendar-settings-content" class="tab-content-item hidden">
                         <section class="profile-section bg-transparent shadow-none p-0">
                            <h2 class="profile-section-title"><i class="fas fa-calendar-alt mr-2 text-indigo-600"></i>Google Calendar Integration</h2>
                            <div id="gcal-status-container" class="p-4 rounded-lg border bg-gray-50 mb-6">
                                 <!-- Status content will be dynamically inserted here -->
                                 <p class="text-gray-500">Checking connection status...</p>
                            </div>

                            <div id="gcal-calendars-list-container" class="hidden">
                                <h3 class="text-lg font-semibold text-gray-700 mb-2">Available Calendars</h3>
                                <p class="text-sm text-gray-500 mb-4">These calendars can be selected within the 'Service Scheduling Rules'. Only calendars you have 'write' access to are shown.</p>
                                <div id="gcal-calendars-list" class="space-y-3 border rounded-lg p-4 bg-white max-h-96 overflow-y-auto">
                                    <!-- Calendar list will be dynamically inserted here -->
                                    <p class="text-gray-500">Loading calendars...</p>
                                </div>
                            </div>
                         </section>
                    </div>

                    <div id="ai-settings-content" class="tab-content-item hidden">
                        <section class="profile-section bg-transparent shadow-none p-0">
                            <h2 class="profile-section-title"><i class="fas fa-robot mr-2 text-indigo-600"></i>AI Core Parameters</h2>
                            <p class="text-sm text-gray-500 mb-4">High-level AI settings for core functionality.</p>
                            <form id="ai-settings-form">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                    <div>
                                        <label for="aiModel" class="form-label">AI Model Engine</label>
                                        <select id="aiModel" name="aiModel" class="form-select">
                                            <option value="gemini-2.5-flash">Gemini 2.5 Flash (High Speed)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="aiCorePersonality" class="form-label">AI Base Personality</label>
                                        <select id="aiCorePersonality" name="aiCorePersonality" class="form-select">
                                            <option value="friendly">Friendly & Empathetic</option>
                                            <option value="formal">Formal & Professional</option>
                                            <option value="efficient">Quick & Efficient</option>
                                            <option value="witty">Witty & Engaging</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label for="knowledgeBaseSource" class="form-label">External Knowledge Base URL/ID (Optional)</label>
                                    <input type="text" id="knowledgeBaseSource" name="knowledgeBaseSource" class="form-input wider-textbox" placeholder="e.g., FAQ page URL, Document ID">
                                </div>
                                <div class="mt-4">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="llmFallbackEnabled" name="llmFallbackEnabled" class="form-checkbox">
                                        <span class="form-check-label">Enable LLM Chain (Ollama Primary → Gemini Backup)</span>
                                    </label>
                                    <p class="text-xs text-gray-500 mt-1">Local AI runs first for privacy, cloud backup for reliability</p>
                                </div>
                                
                                <!-- Ollama Local LLM Settings -->
                                <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg" id="ollamaSettingsContainer">
                                    <h4 class="text-sm font-semibold text-blue-800 mb-3 flex items-center">
                                        <i class="fas fa-robot mr-2"></i>Local LLM (Ollama) Configuration
                                    </h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="flex items-center">
                                                <input type="checkbox" id="ollamaEnabled" name="ollamaEnabled" class="form-checkbox">
                                                <span class="form-check-label">Enable Local Ollama LLM</span>
                                            </label>
                                            <p class="text-xs text-gray-600 mt-1">Use local AI for maximum privacy</p>
                                        </div>
                                        <div>
                                            <label for="ollamaModel" class="form-label text-sm">Ollama Model</label>
                                            <select id="ollamaModel" name="ollamaModel" class="form-select text-sm">
                                                <option value="llama3.1:8b-instruct-q4_0">Llama 3.1 8B (Recommended)</option>
                                                <option value="llama3.2:3b">Llama 3.2 3B (Faster)</option>
                                                <option value="llama3.2:1b">Llama 3.2 1B (Ultra Fast)</option>
                                                <option value="qwen2.5:7b">Qwen 2.5 7B</option>
                                                <option value="gemma2:9b">Gemma 2 9B</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="useGeminiBackup" name="useGeminiBackup" class="form-checkbox">
                                            <span class="form-check-label">Fall back to Gemini if Ollama fails</span>
                                        </label>
                                        <p class="text-xs text-gray-600 mt-1">Ensures 99.9% uptime with cloud backup</p>
                                    </div>
                                </div>
                                <div class="mt-4" id="escalationMessageContainer">
                                    <label for="customEscalationMessage" class="form-label">Custom Escalation Message</label>
                                    <textarea id="customEscalationMessage" name="customEscalationMessage" class="form-textarea wider-textbox" rows="3" placeholder="I’m unable to answer that, let me connect you to a team member who can help."></textarea>
                                </div>
                                <div class="mt-6 border-t border-gray-200 pt-6">
                                    <h3 class="text-md font-medium text-gray-700 mb-3">Conversation Flow Settings</h3>
                                    <div class="space-y-3">
                                        <label class="flex items-start">
                                            <input type="checkbox" id="bargeIn" name="bargeIn" class="form-checkbox mt-1">
                                            <div class="ml-2">
                                                <span class="form-check-label font-medium">Allow Caller Interruption (Barge-In)</span>
                                                <p class="text-xs text-gray-500 mt-1">
                                                    <strong>ON:</strong> Callers can interrupt the agent while speaking (may cause choppy conversations)<br>
                                                    <strong>OFF:</strong> Agent finishes speaking before listening (natural conversation flow)
                                                </p>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="mt-6 border-t border-gray-200 pt-6">
                                    <h3 class="text-md font-medium text-gray-700 mb-3">Advanced Options</h3>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="sentimentAnalysis" name="sentimentAnalysis" class="form-checkbox">
                                            <span class="form-check-label">Enable Sentiment Analysis</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="dataLogging" name="dataLogging" class="form-checkbox" checked>
                                            <span class="form-check-label">Enable Interaction Logging (for improvements)</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="mt-8 pt-5 border-t border-gray-200">
                                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-150 ease-in-out">
                                        <i class="fas fa-save mr-2"></i>Save AI Core Settings
                                    </button>
                                </div>
                            </form>
                        </section>
                    </div>

                    <div id="ai-voice-content" class="tab-content-item hidden">
                        <section class="profile-section bg-transparent shadow-none p-0">
                            <h2 class="profile-section-title"><i class="fas fa-microphone-alt mr-2 text-indigo-600"></i>AI Voice Settings</h2>
                            <form id="elevenlabs-settings-form" class="mb-6">
                                <div class="mb-4">
                                    <label for="elevenlabsApiKey" class="form-label">ElevenLabs API Key</label>
                                    <input type="text" id="elevenlabsApiKey" name="elevenlabsApiKey" class="form-input wider-textbox" placeholder="Enter your ElevenLabs API Key">
                                </div>
                                <div class="mb-4">
                                    <label for="elevenlabsVoice" class="form-label">Voice Selection</label>
                                    <select id="elevenlabsVoice" name="elevenlabsVoice" class="form-select wider-textbox">
                                        <option value="">Select a voice</option>
                                        <option value="Rachel">Rachel</option>
                                        <option value="Domi">Domi</option>
                                        <option value="Bella">Bella</option>
                                        <option value="Antoni">Antoni</option>
                                        <option value="Elli">Elli</option>
                                        <option value="Josh">Josh</option>
                                        <option value="Arnold">Arnold</option>
                                        <option value="Adam">Adam</option>
                                        <option value="Sam">Sam</option>
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label for="elevenlabsTestPhrase" class="form-label">Test Phrase</label>
                                    <input type="text" id="elevenlabsTestPhrase" name="elevenlabsTestPhrase" class="form-input wider-textbox" placeholder="Type a phrase to test voice playback" value="Hello, this is a test from ElevenLabs!">
                                </div>
                                <button type="button" id="testElevenLabsVoiceBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-150 ease-in-out">Listen to Test Phrase</button>
                            <button type="submit" class="ml-4 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-150 ease-in-out">Save ElevenLabs Settings</button>
                        </form>

                        <!-- Agent Performance Controls Section -->
                        <section class="profile-section bg-gray-50 border border-gray-200 rounded-lg p-6 mt-8">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-tachometer-alt mr-2 text-indigo-600"></i>Agent Performance Controls
                                <span class="ml-2 text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">Advanced</span>
                            </h3>
                            <p class="text-sm text-gray-600 mb-6">Fine-tune agent response timing and behavior for optimal call experience.</p>
                            
                            <form id="agent-performance-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Speech Confidence Threshold -->
                                    <div>
                                        <label for="speechConfidenceThreshold" class="form-label">Speech Recognition Sensitivity</label>
                                        <input type="range" id="speechConfidenceThreshold" name="speechConfidenceThreshold" 
                                               class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" 
                                               value="0.4" min="0.1" max="0.9" step="0.1">
                                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                                            <span>Low (0.1)</span>
                                            <span id="speechConfidenceValue">0.4</span>
                                            <span>High (0.9)</span>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">Lower = more sensitive, Higher = more accurate</p>
                                    </div>

                                    <!-- Fuzzy Match Threshold -->
                                    <div>
                                        <label for="fuzzyMatchThreshold" class="form-label">Q&A Matching Sensitivity</label>
                                        <input type="range" id="fuzzyMatchThreshold" name="fuzzyMatchThreshold" 
                                               class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" 
                                               value="0.3" min="0.1" max="0.8" step="0.1">
                                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                                            <span>Strict (0.1)</span>
                                            <span id="fuzzyThresholdValue">0.3</span>
                                            <span>Flexible (0.8)</span>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">How closely caller words must match Q&A keywords</p>
                                    </div>

                                    <!-- Max Repeats -->
                                    <div>
                                        <label for="maxRepeats" class="form-label">Max Retry Attempts</label>
                                        <select id="maxRepeats" name="maxRepeats" class="form-select">
                                            <option value="1">1 time</option>
                                            <option value="2">2 times</option>
                                            <option value="3" selected>3 times</option>
                                            <option value="4">4 times</option>
                                            <option value="5">5 times</option>
                                        </select>
                                        <p class="text-xs text-gray-500 mt-1">Times to retry before escalating unclear speech</p>
                                    </div>

                                    <!-- TTS Provider -->
                                    <div>
                                        <label for="ttsProvider" class="form-label">TTS Provider</label>
                                        <select id="ttsProvider" name="ttsProvider" class="form-select">
                                            <option value="elevenlabs" selected>ElevenLabs (Premium)</option>
                                        </select>
                                        <p class="text-xs text-gray-500 mt-1">Voice synthesis provider for agent responses</p>
                                    </div>
                                </div>

                                <!-- Trade Categories Section -->
                                <div class="mt-6 border-t border-gray-200 pt-6">
                                    <h3 class="text-md font-medium text-gray-700 mb-3">
                                        <i class="fas fa-industry mr-2 text-indigo-600"></i>Trade Categories
                                    </h3>
                                    <label for="trade-category-select" class="block text-sm font-medium text-gray-700 mb-2">
                                        Select all applicable trades this company serves:
                                    </label>
                                    <select 
                                        id="trade-category-select" 
                                        multiple 
                                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm h-32 form-select"
                                    >
                                        <!-- Options will be loaded dynamically -->
                                    </select>
                                    <p class="mt-1 text-sm text-gray-500">
                                        <i class="fas fa-info-circle mr-1 text-blue-500"></i>
                                        Controls Q&A fallback and booking routing logic
                                    </p>

                                    <button 
                                        type="button"
                                        onclick="saveTradeCategories()" 
                                        class="mt-3 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition duration-150 ease-in-out"
                                    >
                                        <i class="fas fa-save mr-2"></i>Save Categories
                                    </button>
                                </div>

                                <div class="border-t border-gray-200 pt-6">
                                    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-150 ease-in-out">
                                        <i class="fas fa-save mr-2"></i>Save Performance Settings
                                    </button>
                                </div>
                            </form>
                        </section>
                    </div>

                    <div id="personality-responses-content" class="tab-content-item hidden">
                        <section class="profile-section bg-transparent shadow-none p-0">
                            <h2 class="profile-section-title"><i class="fas fa-comment-dots mr-2 text-indigo-600"></i>Agent Personality Responses</h2>
                            <div class="mb-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded-r-lg">
                                <div class="flex">
                                    <div class="flex-shrink-0">
                                        <i class="fas fa-info-circle text-blue-400"></i>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm text-blue-700">
                                            Customize how your AI agent responds in common scenarios. These responses will be used 
                                            to maintain consistent, professional communication that reflects your company's voice and brand.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Placeholder Management Section -->
                            <div class="mb-8 bg-gray-50 border border-gray-200 rounded-lg p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-semibold text-gray-900">
                                        <i class="fas fa-tags mr-2 text-purple-600"></i>Response Placeholders
                                    </h3>
                                    <button type="button" id="add-placeholder-btn" class="bg-purple-600 hover:bg-purple-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition duration-150">
                                        <i class="fas fa-plus mr-1"></i>Add Placeholder
                                    </button>
                                </div>
                                <p class="text-sm text-gray-600 mb-4">
                                    Use placeholders in your responses to automatically insert dynamic content. Placeholders are enclosed in curly braces like <code class="bg-gray-200 px-1 rounded text-purple-700">{companyname}</code>.
                                </p>
                                
                                <!-- Placeholder Table -->
                                <div class="overflow-hidden border border-gray-200 rounded-lg">
                                    <table class="min-w-full bg-white">
                                        <thead class="bg-gray-100">
                                            <tr>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Placeholder</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Value/Description</th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="placeholders-table-body" class="bg-white divide-y divide-gray-200">
                                            <!-- Placeholders will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Response Categories Management Section -->
                            <div class="mb-8 bg-gradient-to-r from-indigo-50 to-blue-50 border border-indigo-200 rounded-lg p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-semibold text-gray-900">
                                        <i class="fas fa-comment-alt mr-2 text-indigo-600"></i>Response Categories
                                    </h3>
                                    <button type="button" id="add-response-category-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition duration-150">
                                        <i class="fas fa-plus mr-1"></i>Add Response Category
                                    </button>
                                </div>
                                <p class="text-sm text-gray-600 mb-4">
                                    Manage response categories for different scenarios. Each category defines how your AI agent responds in specific situations.
                                </p>
                                
                                <!-- Response Categories List -->
                                <div id="response-categories-container" class="space-y-3">
                                    <!-- Response categories will be populated here -->
                                </div>
                            </div>
                            <form id="personality-responses-form">
                                <div id="personality-responses-list" class="space-y-4"></div>
                                <div class="mt-8 pt-5 border-t border-gray-200">
                                </div>
                            </form>
                        </section>
                    </div>

                    <!-- Add/Edit Placeholder Modal -->
                    <div id="placeholder-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
                        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                            <div class="mt-3">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-medium text-gray-900" id="placeholder-modal-title">Add Placeholder</h3>
                                    <button type="button" class="text-gray-400 hover:text-gray-600" id="close-placeholder-modal">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <form id="placeholder-form">
                                    <div class="mb-4">
                                        <label for="placeholder-name" class="block text-sm font-medium text-gray-700 mb-2">
                                            Placeholder Name
                                        </label>
                                        <div class="relative">
                                            <span class="absolute left-3 top-2 text-gray-500">{</span>
                                            <input type="text" id="placeholder-name" name="placeholder-name" 
                                                   class="pl-8 pr-8 py-2 w-full border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
                                                   placeholder="companyname" required>
                                            <span class="absolute right-3 top-2 text-gray-500">}</span>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">Use lowercase, no spaces (e.g., companyname, phonenumber)</p>
                                    </div>
                                    <div class="mb-4">
                                        <label for="placeholder-value" class="block text-sm font-medium text-gray-700 mb-2">
                                            Value
                                        </label>
                                        <input type="text" id="placeholder-value" name="placeholder-value" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
                                               placeholder="Your Company Name" required>
                                        <p class="text-xs text-gray-500 mt-1">The text that will replace this placeholder</p>
                                    </div>
                                    <div class="mb-6">
                                        <label for="placeholder-description" class="block text-sm font-medium text-gray-700 mb-2">
                                            Description (Optional)
                                        </label>
                                        <input type="text" id="placeholder-description" name="placeholder-description" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
                                               placeholder="Brief description of this placeholder">
                                    </div>
                                    <div class="flex justify-end space-x-3">
                                        <button type="button" id="cancel-placeholder" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">
                                            Cancel
                                        </button>
                                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-purple-600 rounded-md hover:bg-purple-700">
                                            <span id="placeholder-submit-text">Add Placeholder</span>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Add/Edit Response Category Modal -->
                    <div id="response-category-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
                        <div class="relative top-10 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
                            <div class="mt-3">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-medium text-gray-900" id="response-category-modal-title">Add Response Category</h3>
                                    <button type="button" class="text-gray-400 hover:text-gray-600" id="close-response-category-modal">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <form id="response-category-form">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <label for="response-category-key" class="block text-sm font-medium text-gray-700 mb-2">
                                                Category Key <span class="text-red-500">*</span>
                                            </label>
                                            <input type="text" id="response-category-key" name="response-category-key" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                                   placeholder="e.g., greeting, pricing, support" required>
                                            <p class="text-xs text-gray-500 mt-1">Lowercase, no spaces (used for identification)</p>
                                        </div>
                                        <div>
                                            <label for="response-category-label" class="block text-sm font-medium text-gray-700 mb-2">
                                                Display Label <span class="text-red-500">*</span>
                                            </label>
                                            <input type="text" id="response-category-label" name="response-category-label" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                                   placeholder="e.g., Greeting Response" required>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <label for="response-category-icon" class="block text-sm font-medium text-gray-700 mb-2">
                                            Icon Class
                                        </label>
                                        <input type="text" id="response-category-icon" name="response-category-icon" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                               placeholder="e.g., fas fa-hand-wave">
                                        <p class="text-xs text-gray-500 mt-1">FontAwesome icon class (optional)</p>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <label for="response-category-description" class="block text-sm font-medium text-gray-700 mb-2">
                                            Description
                                        </label>
                                        <textarea id="response-category-description" name="response-category-description" 
                                                  rows="2"
                                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                                  placeholder="Brief description of when this response is used"></textarea>
                                    </div>
                                    
                                    <div class="mb-6">
                                        <label for="response-category-default" class="block text-sm font-medium text-gray-700 mb-2">
                                            Default Response Template
                                        </label>
                                        <textarea id="response-category-default" name="response-category-default" 
                                                  rows="3"
                                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                                                  placeholder="Enter the default response template (you can use placeholders like {companyname})"></textarea>
                                        <p class="text-xs text-gray-500 mt-1">Use placeholders like {companyname} for dynamic content</p>
                                    </div>
                                    
                                    <div class="flex justify-end space-x-3">
                                        <button type="button" id="cancel-response-category" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">
                                            Cancel
                                        </button>
                                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700">
                                            <span id="response-category-submit-text">Add Category</span>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div id="ai-agent-logic-content" class="tab-content-item hidden">
                        <section class="profile-section bg-transparent shadow-none p-0">
                            <h2 class="profile-section-title"><i class="fas fa-brain mr-2 text-indigo-600"></i>AI Agent Logic</h2>
                            
                            <!-- Notepad Section -->
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                                <div class="border-b border-gray-200 bg-gray-50 px-4 py-3 rounded-t-lg">
                                    <h3 class="text-lg font-medium text-gray-800">
                                        <i class="fas fa-sticky-note mr-2 text-yellow-600"></i>Logic Notes
                                    </h3>
                                    <p class="text-sm text-gray-600 mt-1">Keep track of AI logic decisions, rules, and implementation notes</p>
                                </div>
                                
                                <div class="p-4">
                                    <!-- Add New Note Form -->
                                    <div class="mb-4 pb-4 border-b border-gray-200">
                                        <label for="new-logic-note" class="form-label">Add New Note</label>
                                        <textarea 
                                            id="new-logic-note" 
                                            class="form-textarea wider-textbox" 
                                            rows="3" 
                                            placeholder="Enter your AI logic note here..."
                                        ></textarea>
                                        <div class="mt-2 flex justify-end">
                                            <button 
                                                type="button" 
                                                onclick="addLogicNote()" 
                                                class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-md shadow-sm transition duration-150 ease-in-out"
                                            >
                                                <i class="fas fa-plus mr-2"></i>Add Note
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Notes List -->
                                    <div id="logic-notes-list" class="space-y-3">
                                        <p class="text-gray-500 italic text-center py-4">No notes yet. Add your first note above.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Booking Flow Config Section -->
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                                <div class="border-b border-gray-200 bg-gradient-to-r from-blue-50 to-cyan-50 px-4 py-3 rounded-t-lg">
                                    <h3 class="text-lg font-medium text-gray-800 flex items-center">
                                        <i class="fas fa-calendar-check mr-2 text-blue-600"></i>Booking Flow Configuration
                                        <span class="ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">Interactive</span>
                                    </h3>
                                    <p class="text-sm text-gray-600 mt-1">Configure the conversation flow for booking appointments with customers</p>
                                </div>
                                
                                <div class="p-4">
                                    <div class="mb-4">
                                        <table id="booking-flow-table" class="table-auto w-full border mb-4 text-sm">
                                            <thead>
                                                <tr class="bg-gray-100">
                                                    <th class="p-3 text-left font-medium text-gray-700">Prompt</th>
                                                    <th class="p-3 text-left font-medium text-gray-700">Field Name</th>
                                                    <th class="p-3 text-left font-medium text-gray-700">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="booking-flow-body">
                                                <!-- Fields will load here -->
                                            </tbody>
                                        </table>
                                    </div>

                                    <div class="flex items-center gap-2 mb-4 p-3 bg-gray-50 rounded-lg">
                                        <input 
                                            id="new-prompt" 
                                            placeholder="Prompt (e.g. What's your address?)" 
                                            class="form-input flex-1 text-sm"
                                        />
                                        <input 
                                            id="new-name" 
                                            placeholder="Field Name (e.g. address)" 
                                            class="form-input w-1/3 text-sm"
                                        />
                                        <button 
                                            type="button"
                                            class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md shadow-sm transition duration-150 ease-in-out" 
                                            onclick="addBookingField()"
                                        >
                                            <i class="fas fa-plus mr-1"></i>Add Field
                                        </button>
                                    </div>

                                    <div class="flex justify-between items-center pt-3 border-t border-gray-200">
                                        <div class="text-sm text-gray-600">
                                            <i class="fas fa-info-circle mr-1 text-blue-500"></i>
                                            These fields define the conversation flow for booking appointments
                                        </div>
                                        <div class="flex items-center space-x-3">
                                            <button 
                                                type="button"
                                                class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md shadow-sm transition duration-150 ease-in-out" 
                                                onclick="saveBookingFlow()"
                                            >
                                                <i class="fas fa-save mr-2"></i>Save Booking Flow
                                            </button>
                                            <span id="booking-flow-saved" class="text-green-600 text-sm hidden">
                                                <i class="fas fa-check-circle mr-1"></i>Saved!
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 🚀 ENTERPRISE AI AGENT INTELLIGENCE CONTROL CENTER -->
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                                <div class="border-b border-gray-200 bg-gradient-to-r from-indigo-50 to-purple-50 px-4 py-3 rounded-t-lg">
                                    <h3 class="text-lg font-medium text-gray-800 flex items-center">
                                        <i class="fas fa-brain mr-2 text-indigo-600"></i>AI Intelligence Settings
                                        <span class="ml-2 px-2 py-1 bg-indigo-100 text-indigo-800 text-xs font-medium rounded-full">Enterprise</span>
                                    </h3>
                                    <p class="text-sm text-gray-600 mt-1">Complete control over AI agent behavior, thresholds, and decision making</p>
                                </div>
                                
                                <div class="p-6">
                                    <!-- Agent Intelligence Control Panel -->
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <!-- Left Column: Core AI Settings -->
                                        <div class="space-y-4">
                                            <h4 class="text-md font-semibold text-gray-700 border-b pb-2">
                                                <i class="fas fa-cogs mr-2 text-blue-600"></i>AI Core Configuration
                                            </h4>
                                            
                                            <!-- Trade Categories -->
                                            <div>
                                                <label for="agent-trade-categories" class="form-label">Trade Categories</label>
                                                <select id="agent-trade-categories" multiple class="form-select h-24 text-sm">
                                                    <!-- Options loaded dynamically -->
                                                </select>
                                                <p class="text-xs text-gray-500 mt-1">Controls which Q&A categories the agent can access</p>
                                            </div>

                                            <!-- LLM Toggle -->
                                            <div>
                                                <label class="form-label">Use Large Language Model (LLM)</label>
                                                <select id="agent-useLLM" class="form-select">
                                                    <option value="true">Yes - Enable AI reasoning</option>
                                                    <option value="false">No - Use Q&A only</option>
                                                </select>
                                                <p class="text-xs text-gray-500 mt-1">Enable intelligent responses beyond Q&A database</p>
                                            </div>

                                            <!-- Model Selection -->
                                            <div>
                                                <label class="form-label">AI Model</label>
                                                <select id="agent-llmModel" class="form-select">
                                                    <option value="ollama-mistral">Ollama Mistral (Local)</option>
                                                    <option value="ollama-phi3">Ollama Phi3 (Fast)</option>
                                                    <option value="gemini-pro">Gemini Pro (Cloud)</option>
                                                    <option value="openai-gpt4">OpenAI GPT-4 (Premium)</option>
                                                </select>
                                                <p class="text-xs text-gray-500 mt-1">Choose the AI model for intelligent responses</p>
                                            </div>

                                            <!-- Memory Mode -->
                                            <div>
                                                <label class="form-label">Memory Mode</label>
                                                <select id="agent-memoryMode" class="form-select">
                                                    <option value="short">Short - Forget after response</option>
                                                    <option value="conversation">Conversation - Remember context</option>
                                                </select>
                                                <p class="text-xs text-gray-500 mt-1">How much conversation history to retain</p>
                                            </div>
                                        </div>

                                        <!-- Right Column: Intelligence Thresholds -->
                                        <div class="space-y-4">
                                            <h4 class="text-md font-semibold text-gray-700 border-b pb-2">
                                                <i class="fas fa-sliders-h mr-2 text-green-600"></i>Intelligence Thresholds
                                            </h4>

                                            <!-- Confidence Threshold -->
                                            <div>
                                                <label class="form-label">Fallback Threshold (0-1)</label>
                                                <div class="flex items-center space-x-3">
                                                    <input type="range" id="agent-fallbackThreshold" class="flex-1" min="0" max="1" step="0.05" value="0.5">
                                                    <span id="fallback-threshold-value" class="text-sm font-medium text-gray-700 w-12">0.5</span>
                                                </div>
                                                <p class="text-xs text-gray-500 mt-1">Lower = more likely to escalate, Higher = more AI responses</p>
                                            </div>

                                            <!-- Escalation Mode -->
                                            <div>
                                                <label class="form-label">Escalation Strategy</label>
                                                <select id="agent-escalationMode" class="form-select">
                                                    <option value="ask">Ask - Confirm before escalating</option>
                                                    <option value="auto">Auto - Escalate immediately</option>
                                                </select>
                                                <p class="text-xs text-gray-500 mt-1">How to handle low-confidence situations</p>
                                            </div>

                                            <!-- Re-prompt Settings -->
                                            <div>
                                                <label class="form-label">Re-prompt After Turns</label>
                                                <select id="agent-rePromptAfterTurns" class="form-select">
                                                    <option value="1">1 turn</option>
                                                    <option value="2">2 turns</option>
                                                    <option value="3">3 turns</option>
                                                    <option value="4">4 turns</option>
                                                    <option value="5">5 turns</option>
                                                </select>
                                                <p class="text-xs text-gray-500 mt-1">When to ask clarifying questions</p>
                                            </div>

                                            <!-- Max Prompts -->
                                            <div>
                                                <label class="form-label">Max Prompts Per Call</label>
                                                <select id="agent-maxPromptsPerCall" class="form-select">
                                                    <option value="1">1 prompt</option>
                                                    <option value="2">2 prompts</option>
                                                    <option value="3">3 prompts</option>
                                                    <option value="4">4 prompts</option>
                                                    <option value="5">5 prompts</option>
                                                </select>
                                                <p class="text-xs text-gray-500 mt-1">Maximum clarification attempts</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Advanced Features Row -->
                                    <div class="mt-6 pt-4 border-t border-gray-200">
                                        <h4 class="text-md font-semibold text-gray-700 mb-4">
                                            <i class="fas fa-star mr-2 text-yellow-600"></i>Advanced Features
                                        </h4>
                                        
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <label class="flex items-center p-3 bg-blue-50 rounded-lg border border-blue-200">
                                                <input type="checkbox" id="agent-semanticSearchEnabled" class="form-checkbox">
                                                <div class="ml-3">
                                                    <span class="text-sm font-medium text-gray-900">Semantic Search</span>
                                                    <p class="text-xs text-gray-500">AI-powered question matching</p>
                                                </div>
                                            </label>

                                            <label class="flex items-center p-3 bg-green-50 rounded-lg border border-green-200">
                                                <input type="checkbox" id="agent-confidenceScoring" class="form-checkbox">
                                                <div class="ml-3">
                                                    <span class="text-sm font-medium text-gray-900">Confidence Scoring</span>
                                                    <p class="text-xs text-gray-500">Track response certainty</p>
                                                </div>
                                            </label>

                                            <label class="flex items-center p-3 bg-purple-50 rounded-lg border border-purple-200">
                                                <input type="checkbox" id="agent-autoLearningQueue" class="form-checkbox">
                                                <div class="ml-3">
                                                    <span class="text-sm font-medium text-gray-900">Auto Learning</span>
                                                    <p class="text-xs text-gray-500">Learn from conversations</p>
                                                </div>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="mt-6 pt-4 border-t border-gray-200 flex justify-between items-center">
                                        <div class="flex items-center space-x-4">
                                            <button type="button" onclick="testAgentConfiguration()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md shadow-sm transition duration-150 ease-in-out">
                                                <i class="fas fa-flask mr-2"></i>Test Configuration
                                            </button>
                                            <button type="button" onclick="resetToDefaults()" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-md shadow-sm transition duration-150 ease-in-out">
                                                <i class="fas fa-undo mr-2"></i>Reset to Defaults
                                            </button>
                                        </div>
                                        <div class="flex items-center space-x-3">
                                            <span id="agent-settings-saved" class="text-green-600 text-sm hidden">
                                                <i class="fas fa-check-circle mr-1"></i>Settings Saved!
                                            </span>
                                            <button type="button" onclick="saveAgentSettings()" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-6 rounded-md shadow-sm transition duration-150 ease-in-out">
                                                <i class="fas fa-save mr-2"></i>Save AI Settings
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Agent Performance Analytics -->
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                                <div class="border-b border-gray-200 bg-gradient-to-r from-green-50 to-teal-50 px-4 py-3 rounded-t-lg">
                                    <h3 class="text-lg font-medium text-gray-800 flex items-center">
                                        <i class="fas fa-chart-line mr-2 text-green-600"></i>Agent Performance Analytics
                                        <span class="ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">Live Data</span>
                                    </h3>
                                    <p class="text-sm text-gray-600 mt-1">Monitor AI agent performance and optimization opportunities</p>
                                </div>
                                
                                <div class="p-6">
                                    <div id="agent-analytics-container">
                                        <p class="text-gray-500 text-center py-8">
                                            <i class="fas fa-spinner fa-spin mr-2"></i>Loading performance data...
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- 🎭 AGENT PERSONALITY CONFIGURATION - Module 1: Voice & Behavior Control -->
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                                <div class="border-b border-gray-200 bg-gradient-to-r from-pink-50 to-rose-50 px-4 py-3 rounded-t-lg">
                                    <h3 class="text-lg font-medium text-gray-800 flex items-center">
                                        <i class="fas fa-theater-masks mr-2 text-pink-600"></i>Agent Personality
                                        <span class="ml-2 px-2 py-1 bg-pink-100 text-pink-800 text-xs font-medium rounded-full">Module 1</span>
                                    </h3>
                                    <p class="text-sm text-gray-600 mt-1">Configure voice tone, speech pace, and behavioral characteristics</p>
                                </div>
                                
                                <div class="p-6">
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <!-- Left Column: Voice Settings -->
                                        <div class="space-y-4">
                                            <h4 class="text-md font-semibold text-gray-700 border-b pb-2">
                                                <i class="fas fa-microphone mr-2 text-pink-600"></i>Voice Configuration
                                            </h4>
                                            
                                            <!-- Voice Tone -->
                                            <div>
                                                <label for="voiceToneSelect" class="form-label">Voice Tone</label>
                                                <select id="voiceToneSelect" class="form-select">
                                                    <option value="friendly">Friendly - Warm and approachable</option>
                                                    <option value="professional">Professional - Business-focused</option>
                                                    <option value="playful">Playful - Light and engaging</option>
                                                </select>
                                                <p class="text-xs text-gray-500 mt-1">Controls word choice and phrasing style</p>
                                            </div>

                                            <!-- Speech Pace -->
                                            <div>
                                                <label for="speechPaceSelect" class="form-label">Speech Pace</label>
                                                <select id="speechPaceSelect" class="form-select">
                                                    <option value="slow">Slow - Deliberate and clear</option>
                                                    <option value="normal">Normal - Standard pace</option>
                                                    <option value="fast">Fast - Quick and efficient</option>
                                                </select>
                                                <p class="text-xs text-gray-500 mt-1">Adjusts TTS speed for ElevenLabs or Google</p>
                                            </div>
                                        </div>

                                        <!-- Right Column: Behavior Settings -->
                                        <div class="space-y-4">
                                            <h4 class="text-md font-semibold text-gray-700 border-b pb-2">
                                                <i class="fas fa-user-cog mr-2 text-rose-600"></i>Behavior Controls
                                            </h4>
                                            
                                            <!-- Interactive Behaviors -->
                                            <div class="space-y-3">
                                                <label class="flex items-center p-3 bg-blue-50 rounded-lg border border-blue-200">
                                                    <input type="checkbox" id="bargeInToggle" class="form-checkbox">
                                                    <div class="ml-3">
                                                        <span class="text-sm font-medium text-gray-900">Allow Barge-In</span>
                                                        <p class="text-xs text-gray-500">Caller can interrupt AI while speaking</p>
                                                    </div>
                                                </label>

                                                <label class="flex items-center p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                                                    <input type="checkbox" id="emotionToggle" class="form-checkbox">
                                                    <div class="ml-3">
                                                        <span class="text-sm font-medium text-gray-900">Acknowledge Emotion</span>
                                                        <p class="text-xs text-gray-500">Respond to frustration, urgency, etc.</p>
                                                    </div>
                                                </label>

                                                <label class="flex items-center p-3 bg-green-50 rounded-lg border border-green-200">
                                                    <input type="checkbox" id="emojiToggle" class="form-checkbox">
                                                    <div class="ml-3">
                                                        <span class="text-sm font-medium text-gray-900">Use Emojis</span>
                                                        <p class="text-xs text-gray-500">Add emojis in SMS/email (👍 😊 ❌)</p>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="mt-6 pt-4 border-t border-gray-200 flex justify-between items-center">
                                        <div class="flex items-center space-x-4">
                                            <button type="button" onclick="previewPersonality()" class="bg-pink-600 hover:bg-pink-700 text-white font-medium py-2 px-4 rounded-md shadow-sm transition duration-150 ease-in-out">
                                                <i class="fas fa-play mr-2"></i>Preview Voice
                                            </button>
                                            <button type="button" onclick="resetPersonalityDefaults()" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-md shadow-sm transition duration-150 ease-in-out">
                                                <i class="fas fa-undo mr-2"></i>Reset Defaults
                                            </button>
                                        </div>
                                        <div class="flex items-center space-x-3">
                                            <span id="personality-settings-saved" class="text-green-600 text-sm hidden">
                                                <i class="fas fa-check-circle mr-1"></i>Personality Saved!
                                            </span>
                                            <button type="button" onclick="saveAgentPersonalitySettings()" class="bg-rose-600 hover:bg-rose-700 text-white font-medium py-2 px-6 rounded-md shadow-sm transition duration-150 ease-in-out">
                                                <i class="fas fa-save mr-2"></i>Save Personality
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 📚 KNOWLEDGE Q&A SOURCE CONTROLS - Module 2: Knowledge Source Priority & Configuration -->
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                                <div class="border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50 px-4 py-3 rounded-t-lg">
                                    <h3 class="text-lg font-medium text-gray-800 flex items-center">
                                        <i class="fas fa-book-open mr-2 text-indigo-600"></i>Knowledge Source Controls
                                        <span class="ml-2 px-2 py-1 bg-indigo-100 text-indigo-800 text-xs font-medium rounded-full">Module 2</span>
                                    </h3>
                                    <p class="text-sm text-gray-600 mt-1">Prioritize and configure knowledge sources, confidence thresholds, and memory settings</p>
                                </div>
                                
                                <div class="p-6">
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <!-- Left Column: Source Priority & Configuration -->
                                        <div class="space-y-5">
                                            <h4 class="text-md font-semibold text-gray-700 border-b pb-2">
                                                <i class="fas fa-layer-group mr-2 text-indigo-600"></i>Knowledge Source Priority
                                                <span class="text-xs text-gray-500 ml-2">(Drag to reorder)</span>
                                            </h4>
                                            
                                            <div id="source-priority-container" class="space-y-2">
                                                <!-- Source Priority Items (will be populated via JS) -->
                                                <div id="source-companyQnA" data-source="companyQnA" class="priority-item flex items-center p-3 bg-white border border-gray-300 rounded-lg cursor-move hover:bg-blue-50 transition duration-150">
                                                    <div class="handle mr-3 text-gray-400">
                                                        <i class="fas fa-grip-vertical"></i>
                                                    </div>
                                                    <div class="flex-1">
                                                        <div class="flex items-center justify-between">
                                                            <div class="flex items-center">
                                                                <i class="fas fa-building text-blue-500 mr-2"></i>
                                                                <span class="font-medium">Company Q&A</span>
                                                            </div>
                                                            <div class="text-sm font-mono bg-blue-100 text-blue-800 px-2 py-0.5 rounded">
                                                                Priority: <span class="priority-value">1</span>
                                                            </div>
                                                        </div>
                                                        <p class="text-xs text-gray-600 mt-1">Company-specific questions and answers</p>
                                                        <div class="mt-2">
                                                            <label class="flex items-center space-x-2 text-sm">
                                                                <span class="text-gray-700">Confidence:</span>
                                                                <input type="range" 
                                                                    id="threshold-companyQnA" 
                                                                    class="w-1/2" 
                                                                    min="0" max="1" step="0.05" value="0.8">
                                                                <span id="threshold-value-companyQnA" class="text-sm font-mono">0.80</span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div id="source-tradeQnA" data-source="tradeQnA" class="priority-item flex items-center p-3 bg-white border border-gray-300 rounded-lg cursor-move hover:bg-blue-50 transition duration-150">
                                                    <div class="handle mr-3 text-gray-400">
                                                        <i class="fas fa-grip-vertical"></i>
                                                    </div>
                                                    <div class="flex-1">
                                                        <div class="flex items-center justify-between">
                                                            <div class="flex items-center">
                                                                <i class="fas fa-tools text-purple-500 mr-2"></i>
                                                                <span class="font-medium">Trade Category Q&A</span>
                                                            </div>
                                                            <div class="text-sm font-mono bg-purple-100 text-purple-800 px-2 py-0.5 rounded">
                                                                Priority: <span class="priority-value">2</span>
                                                            </div>
                                                        </div>
                                                        <p class="text-xs text-gray-600 mt-1">Industry-specific knowledge (HVAC, plumbing, etc.)</p>
                                                        <div class="mt-2">
                                                            <label class="flex items-center space-x-2 text-sm">
                                                                <span class="text-gray-700">Confidence:</span>
                                                                <input type="range" 
                                                                    id="threshold-tradeQnA" 
                                                                    class="w-1/2" 
                                                                    min="0" max="1" step="0.05" value="0.75">
                                                                <span id="threshold-value-tradeQnA" class="text-sm font-mono">0.75</span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div id="source-vectorSearch" data-source="vectorSearch" class="priority-item flex items-center p-3 bg-white border border-gray-300 rounded-lg cursor-move hover:bg-blue-50 transition duration-150">
                                                    <div class="handle mr-3 text-gray-400">
                                                        <i class="fas fa-grip-vertical"></i>
                                                    </div>
                                                    <div class="flex-1">
                                                        <div class="flex items-center justify-between">
                                                            <div class="flex items-center">
                                                                <i class="fas fa-network-wired text-green-500 mr-2"></i>
                                                                <span class="font-medium">Vector Search</span>
                                                            </div>
                                                            <div class="text-sm font-mono bg-green-100 text-green-800 px-2 py-0.5 rounded">
                                                                Priority: <span class="priority-value">3</span>
                                                            </div>
                                                        </div>
                                                        <p class="text-xs text-gray-600 mt-1">Semantic search across all knowledge</p>
                                                        <div class="mt-2">
                                                            <label class="flex items-center space-x-2 text-sm">
                                                                <span class="text-gray-700">Confidence:</span>
                                                                <input type="range" 
                                                                    id="threshold-vectorSearch" 
                                                                    class="w-1/2" 
                                                                    min="0" max="1" step="0.05" value="0.7">
                                                                <span id="threshold-value-vectorSearch" class="text-sm font-mono">0.70</span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div id="source-llmFallback" data-source="llmFallback" class="priority-item flex items-center p-3 bg-white border border-gray-300 rounded-lg cursor-move hover:bg-blue-50 transition duration-150">
                                                    <div class="handle mr-3 text-gray-400">
                                                        <i class="fas fa-grip-vertical"></i>
                                                    </div>
                                                    <div class="flex-1">
                                                        <div class="flex items-center justify-between">
                                                            <div class="flex items-center">
                                                                <i class="fas fa-robot text-amber-500 mr-2"></i>
                                                                <span class="font-medium">LLM Fallback</span>
                                                            </div>
                                                            <div class="text-sm font-mono bg-amber-100 text-amber-800 px-2 py-0.5 rounded">
                                                                Priority: <span class="priority-value">4</span>
                                                            </div>
                                                        </div>
                                                        <p class="text-xs text-gray-600 mt-1">AI-generated responses (last resort)</p>
                                                        <div class="mt-2">
                                                            <label class="flex items-center space-x-2 text-sm">
                                                                <span class="text-gray-700">Confidence:</span>
                                                                <input type="range" 
                                                                    id="threshold-llmFallback" 
                                                                    class="w-1/2" 
                                                                    min="0" max="1" step="0.05" value="0.6">
                                                                <span id="threshold-value-llmFallback" class="text-sm font-mono">0.60</span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Right Column: Memory & Fallback Settings -->
                                        <div class="space-y-5">
                                            <h4 class="text-md font-semibold text-gray-700 border-b pb-2">
                                                <i class="fas fa-brain mr-2 text-indigo-600"></i>Memory & Fallback Options
                                            </h4>
                                            
                                            <!-- Memory Mode Selection -->
                                            <div>
                                                <label for="memoryModeSelect" class="form-label">Memory Mode</label>
                                                <select id="memoryModeSelect" class="form-select">
                                                    <option value="short">Short-term (Basic context)</option>
                                                    <option value="conversational" selected>Conversational (Full dialog history)</option>
                                                    <option value="session">Session (Persistent memory)</option>
                                                </select>
                                                <p class="text-xs text-gray-500 mt-1">How agent remembers previous interactions</p>
                                            </div>
                                            
                                            <!-- Context Retention Time -->
                                            <div>
                                                <label for="contextRetentionSlider" class="form-label">Context Retention Time</label>
                                                <div class="flex items-center space-x-3">
                                                    <input type="range" id="contextRetentionSlider" 
                                                        class="w-1/2" min="5" max="120" step="5" value="30">
                                                    <span id="contextRetentionValue" class="text-sm font-mono bg-gray-100 px-2 py-1 rounded">30 minutes</span>
                                                </div>
                                                <p class="text-xs text-gray-500 mt-1">How long to maintain conversation history</p>
                                            </div>
                                            
                                            <!-- Fallback Behaviors -->
                                            <div class="mt-5">
                                                <h5 class="text-sm font-medium text-gray-700 mb-3">Fallback Behavior</h5>
                                                <div class="space-y-3">
                                                    <label class="flex items-center p-3 bg-red-50 rounded-lg border border-red-200">
                                                        <input type="checkbox" id="rejectLowConfidenceToggle" class="form-checkbox" checked>
                                                        <div class="ml-3">
                                                            <span class="text-sm font-medium text-gray-900">Reject Low Confidence Matches</span>
                                                            <p class="text-xs text-gray-500">Don't use answers below threshold</p>
                                                        </div>
                                                    </label>
                                                    
                                                    <label class="flex items-center p-3 bg-orange-50 rounded-lg border border-orange-200">
                                                        <input type="checkbox" id="escalateNoMatchToggle" class="form-checkbox" checked>
                                                        <div class="ml-3">
                                                            <span class="text-sm font-medium text-gray-900">Escalate On No Match</span>
                                                            <p class="text-xs text-gray-500">Connect to human when no good answers</p>
                                                        </div>
                                                    </label>
                                                </div>
                                            </div>
                                            
                                            <!-- Fallback Message -->
                                            <div class="mt-4">
                                                <label for="fallbackMessageInput" class="form-label">Fallback Message</label>
                                                <textarea id="fallbackMessageInput" class="form-textarea" rows="3">I want to make sure I give you accurate information. Let me connect you with a specialist who can help.</textarea>
                                                <p class="text-xs text-gray-500 mt-1">Message to use when escalating to human</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="mt-6 pt-4 border-t border-gray-200 flex justify-between items-center">
                                        <button type="button" onclick="resetKnowledgeDefaults()" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-md shadow-sm transition duration-150 ease-in-out">
                                            <i class="fas fa-undo mr-2"></i>Reset Defaults
                                        </button>
                                        <div class="flex items-center space-x-3">
                                            <span id="knowledge-settings-saved" class="text-green-600 text-sm hidden">
                                                <i class="fas fa-check-circle mr-1"></i>Knowledge Settings Saved!
                                            </span>
                                            <button type="button" onclick="saveKnowledgeSettings()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-6 rounded-md shadow-sm transition duration-150 ease-in-out">
                                                <i class="fas fa-save mr-2"></i>Save Knowledge Settings
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </section>
                    </div>

                </div>
            </div>
        </div>
    </body>

    <script>
        // Global function to get current company ID
        function getCurrentCompanyId() {
            // First try to get from global variable
            if (window.currentCompanyId) {
                return window.currentCompanyId;
            }
            
            // Fallback: extract from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const companyId = urlParams.get('id');
            
            if (!companyId) {
                console.error('Company ID not found in URL or global variable');
                return null;
            }
            
            return companyId;
        }

        // 🚀 ENTERPRISE AI AGENT FUNCTIONS
        
        // Load trade categories for agent configuration
        async function loadAgentTradeCategories() {
            try {
                // Use the GLOBAL trade categories endpoint
                const response = await fetch('/api/trade-categories/');
                const categories = await response.json();
                
                const selector = document.getElementById('agent-trade-categories');
                selector.innerHTML = '';
                
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.name;
                    const qaCount = category.commonQAs ? category.commonQAs.length : 0;
                    option.textContent = `${category.name} (${qaCount} Q&As)`;
                    selector.appendChild(option);
                });
                
                console.log('✅ Global trade categories loaded for agent configuration');
            } catch (error) {
                console.error('❌ Failed to load trade categories:', error);
            }
        }

        // Load current agent settings
        async function loadAgentSettings() {
            const companyId = getCurrentCompanyId();
            if (!companyId) return;

            try {
                const response = await fetch(`/api/agent/companies/${companyId}/agent-settings`);
                const data = await response.json();
                
                // Populate trade categories
                const tradeSelector = document.getElementById('agent-trade-categories');
                const selectedTrades = data.tradeCategories || [];
                
                Array.from(tradeSelector.options).forEach(option => {
                    option.selected = selectedTrades.includes(option.value);
                });

                // Populate agent settings
                const settings = data.agentSettings || {};
                
                document.getElementById('agent-useLLM').value = settings.useLLM !== false ? 'true' : 'false';
                document.getElementById('agent-llmModel').value = settings.llmModel || 'ollama-mistral';
                document.getElementById('agent-memoryMode').value = settings.memoryMode || 'short';
                document.getElementById('agent-escalationMode').value = settings.escalationMode || 'ask';
                document.getElementById('agent-rePromptAfterTurns').value = settings.rePromptAfterTurns || 3;
                document.getElementById('agent-maxPromptsPerCall').value = settings.maxPromptsPerCall || 2;
                
                // Fallback threshold slider
                const thresholdSlider = document.getElementById('agent-fallbackThreshold');
                const thresholdValue = document.getElementById('fallback-threshold-value');
                thresholdSlider.value = settings.fallbackThreshold || 0.5;
                thresholdValue.textContent = thresholdSlider.value;
                
                // Advanced features
                document.getElementById('agent-semanticSearchEnabled').checked = settings.semanticSearchEnabled !== false;
                document.getElementById('agent-confidenceScoring').checked = settings.confidenceScoring !== false;
                document.getElementById('agent-autoLearningQueue').checked = settings.autoLearningQueue !== false;
                
                console.log('✅ Agent settings loaded successfully');
                
            } catch (error) {
                console.error('❌ Failed to load agent settings:', error);
                alert('Failed to load agent settings. Please refresh the page.');
            }
        }

        // Save agent settings
        async function saveAgentSettings() {
            const companyId = getCurrentCompanyId();
            if (!companyId) {
                alert('Company ID not found. Please refresh the page.');
                return;
            }

            try {
                // Collect trade categories
                const tradeSelector = document.getElementById('agent-trade-categories');
                const tradeCategories = Array.from(tradeSelector.selectedOptions).map(option => option.value);

                // Collect agent settings
                const agentSettings = {
                    useLLM: document.getElementById('agent-useLLM').value === 'true',
                    llmModel: document.getElementById('agent-llmModel').value,
                    memoryMode: document.getElementById('agent-memoryMode').value,
                    fallbackThreshold: parseFloat(document.getElementById('agent-fallbackThreshold').value),
                    escalationMode: document.getElementById('agent-escalationMode').value,
                    rePromptAfterTurns: parseInt(document.getElementById('agent-rePromptAfterTurns').value),
                    maxPromptsPerCall: parseInt(document.getElementById('agent-maxPromptsPerCall').value),
                    semanticSearchEnabled: document.getElementById('agent-semanticSearchEnabled').checked,
                    confidenceScoring: document.getElementById('agent-confidenceScoring').checked,
                    autoLearningQueue: document.getElementById('agent-autoLearningQueue').checked
                };

                const response = await fetch(`/api/agent/companies/${companyId}/agent-settings`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tradeCategories, agentSettings })
                });

                if (response.ok) {
                    const savedIndicator = document.getElementById('agent-settings-saved');
                    savedIndicator.classList.remove('hidden');
                    setTimeout(() => savedIndicator.classList.add('hidden'), 3000);
                    console.log('✅ Agent settings saved successfully');
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to save settings');
                }

            } catch (error) {
                console.error('❌ Failed to save agent settings:', error);
                alert(`Failed to save agent settings: ${error.message}`);
            }
        }

        // Test agent configuration
        async function testAgentConfiguration() {
            const companyId = getCurrentCompanyId();
            if (!companyId) return;

            const testMessage = prompt('Enter a test message for the AI agent:', 'What are your business hours?');
            if (!testMessage) return;

            try {
                const response = await fetch(`/api/agent/companies/${companyId}/test-agent`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ testMessage })
                });

                const result = await response.json();
                
                if (response.ok) {
                    alert(`Test Results:\n\nMessage: ${result.message}\nUsed LLM: ${result.usedLLM}\nModel: ${result.model}\nConfidence: ${(result.confidence * 100).toFixed(1)}%\nResponse Time: ${result.responseTime.toFixed(2)}s\nEscalation: ${result.escalationTriggered ? 'Yes' : 'No'}`);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('❌ Agent test failed:', error);
                alert(`Test failed: ${error.message}`);
            }
        }

        // Reset to default settings
        function resetToDefaults() {
            if (!confirm('Reset all AI agent settings to defaults? This cannot be undone.')) return;

            // Reset form to defaults
            document.getElementById('agent-useLLM').value = 'true';
            document.getElementById('agent-llmModel').value = 'ollama-mistral';
            document.getElementById('agent-memoryMode').value = 'short';
            document.getElementById('agent-escalationMode').value = 'ask';
            document.getElementById('agent-rePromptAfterTurns').value = '3';
            document.getElementById('agent-maxPromptsPerCall').value = '2';
            
            const thresholdSlider = document.getElementById('agent-fallbackThreshold');
            const thresholdValue = document.getElementById('fallback-threshold-value');
            thresholdSlider.value = '0.5';
            thresholdValue.textContent = '0.5';
            
            document.getElementById('agent-semanticSearchEnabled').checked = true;
            document.getElementById('agent-confidenceScoring').checked = true;
            document.getElementById('agent-autoLearningQueue').checked = true;
            
            // Clear trade category selection
            const tradeSelector = document.getElementById('agent-trade-categories');
            Array.from(tradeSelector.options).forEach(option => option.selected = false);
            
            console.log('✅ Agent settings reset to defaults');
        }

        // Load agent analytics
        async function loadAgentAnalytics() {
            const companyId = getCurrentCompanyId();
            if (!companyId) return;

            try {
                const response = await fetch(`/api/agent/companies/${companyId}/agent-analytics?days=7`);
                const analytics = await response.json();
                
                const container = document.getElementById('agent-analytics-container');
                container.innerHTML = `
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-blue-600">${analytics.metrics.totalInteractions}</div>
                            <div class="text-sm text-gray-600">Total Interactions</div>
                        </div>
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-green-600">${(analytics.metrics.averageConfidence * 100).toFixed(1)}%</div>
                            <div class="text-sm text-gray-600">Avg Confidence</div>
                        </div>
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-yellow-600">${(analytics.metrics.escalationRate * 100).toFixed(1)}%</div>
                            <div class="text-sm text-gray-600">Escalation Rate</div>
                        </div>
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-purple-600">${analytics.metrics.responseTime.toFixed(1)}s</div>
                            <div class="text-sm text-gray-600">Avg Response Time</div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="font-semibold text-gray-700 mb-2">Top Questions (Last 7 Days)</h4>
                        <div class="space-y-2">
                            ${analytics.topQuestions.map(q => `
                                <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                    <span class="text-sm">${q.question}</span>
                                    <div class="flex items-center space-x-2">
                                        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">${q.frequency}x</span>
                                        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">${(q.confidence * 100).toFixed(0)}%</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                console.log('✅ Agent analytics loaded successfully');
                
            } catch (error) {
                console.error('❌ Failed to load agent analytics:', error);
                document.getElementById('agent-analytics-container').innerHTML = `
                    <p class="text-red-500 text-center py-4">
                        <i class="fas fa-exclamation-triangle mr-2"></i>Failed to load analytics data
                    </p>
                `;
            }
        }

        // 🎭 AGENT PERSONALITY SETTINGS FUNCTIONS - Module 1
        
        // Load agent personality settings
        async function loadAgentPersonalitySettings() {
            const companyId = getCurrentCompanyId();
            if (!companyId) return;

            try {
                const response = await fetch(`/api/company/companies/${companyId}/personality`);
                if (!response.ok) {
                    console.log('Using default personality settings');
                    return;
                }
                
                const data = await response.json();
                
                document.getElementById('voiceToneSelect').value = data.voiceTone || 'friendly';
                document.getElementById('speechPaceSelect').value = data.speechPace || 'normal';
                document.getElementById('bargeInToggle').checked = data.bargeInMode ?? true;
                document.getElementById('emotionToggle').checked = data.acknowledgeEmotion ?? true;
                document.getElementById('emojiToggle').checked = data.useEmojis ?? false;
                
                console.log('✅ Personality settings loaded');
            } catch (error) {
                console.error('❌ Failed to load personality settings:', error);
            }
        }

        // Save agent personality settings
        async function saveAgentPersonalitySettings() {
            const companyId = getCurrentCompanyId();
            if (!companyId) return;

            const personalityData = {
                voiceTone: document.getElementById('voiceToneSelect').value,
                speechPace: document.getElementById('speechPaceSelect').value,
                bargeInMode: document.getElementById('bargeInToggle').checked,
                acknowledgeEmotion: document.getElementById('emotionToggle').checked,
                useEmojis: document.getElementById('emojiToggle').checked
            };

            try {
                const response = await fetch(`/api/company/companies/${companyId}/personality`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(personalityData)
                });

                if (response.ok) {
                    // Show success message
                    const savedIndicator = document.getElementById('personality-settings-saved');
                    savedIndicator.classList.remove('hidden');
                    setTimeout(() => savedIndicator.classList.add('hidden'), 3000);
                    
                    console.log('✅ Personality settings saved');
                    alert('✅ Personality settings saved successfully!');
                } else {
                    throw new Error('Failed to save settings');
                }
            } catch (error) {
                console.error('❌ Failed to save personality settings:', error);
                alert(`❌ Failed to save personality settings: ${error.message}`);
            }
        }

        // Preview personality voice
        async function previewPersonality() {
            const voiceTone = document.getElementById('voiceToneSelect').value;
            const speechPace = document.getElementById('speechPaceSelect').value;
            
            // Generate sample text based on voice tone
            let sampleText = "";
            switch(voiceTone) {
                case 'friendly':
                    sampleText = "Hi there! Thanks for calling. I'm here to help make your day better. How can I assist you?";
                    break;
                case 'professional':
                    sampleText = "Good day. Thank you for contacting us. I'm ready to assist you with your needs. How may I help?";
                    break;
                case 'playful':
                    sampleText = "Hey! What's up? Ready to get things done? I'm excited to help you out today!";
                    break;
            }
            
            alert(`🎭 Voice Preview (${voiceTone} tone, ${speechPace} pace):\n\n"${sampleText}"\n\nNote: Full TTS preview will be available in production.`);
        }

        // Reset personality to defaults
        function resetPersonalityDefaults() {
            if (!confirm('Reset personality settings to defaults?')) return;
            
            document.getElementById('voiceToneSelect').value = 'friendly';
            document.getElementById('speechPaceSelect').value = 'normal';
            document.getElementById('bargeInToggle').checked = true;
            document.getElementById('emotionToggle').checked = true;
            document.getElementById('emojiToggle').checked = false;
            
            console.log('✅ Personality settings reset to defaults');
        }
        
        // 📚 KNOWLEDGE Q&A SOURCE CONTROLS FUNCTIONS - Module 2
        
        // Initialize drag-and-drop functionality for knowledge source priority
        function initKnowledgeSources() {
            // Set up range input event listeners
            const rangeInputs = document.querySelectorAll('input[type="range"][id^="threshold-"]');
            rangeInputs.forEach(input => {
                const valueDisplay = document.getElementById(`threshold-value-${input.id.split('-')[1]}`);
                input.addEventListener('input', () => {
                    valueDisplay.textContent = parseFloat(input.value).toFixed(2);
                });
            });
            
            // Set up context retention slider
            const contextSlider = document.getElementById('contextRetentionSlider');
            const contextValue = document.getElementById('contextRetentionValue');
            contextSlider.addEventListener('input', () => {
                contextValue.textContent = `${contextSlider.value} minutes`;
            });
            
            // Initialize drag & drop (simulated for now)
            const container = document.getElementById('source-priority-container');
            const items = container.querySelectorAll('.priority-item');
            
            // Simple click-based priority switching (since full drag-drop requires libraries)
            items.forEach(item => {
                item.addEventListener('click', function() {
                    if (event.target.tagName === 'INPUT') return; // Don't trigger on slider clicks
                    
                    // Ask user which priority to assign
                    const currentPriority = parseInt(this.querySelector('.priority-value').textContent);
                    const newPriority = prompt(`Change "${this.dataset.source}" priority (1-4):`, currentPriority);
                    
                    if (newPriority && !isNaN(newPriority) && newPriority >= 1 && newPriority <= 4) {
                        // Find the item that currently has the target priority
                        const targetItem = Array.from(items).find(i => 
                            parseInt(i.querySelector('.priority-value').textContent) === parseInt(newPriority)
                        );
                        
                        if (targetItem) {
                            // Swap priorities
                            targetItem.querySelector('.priority-value').textContent = currentPriority;
                            this.querySelector('.priority-value').textContent = newPriority;
                            
                            // Update visual order
                            updateSourcePriorityOrder();
                        }
                    }
                });
            });
            
            console.log('✅ Knowledge source controls initialized');
        }
        
        // Update the visual order of sources based on priority
        function updateSourcePriorityOrder() {
            const container = document.getElementById('source-priority-container');
            const items = Array.from(container.querySelectorAll('.priority-item'));
            
            // Sort items by priority
            items.sort((a, b) => {
                const priorityA = parseInt(a.querySelector('.priority-value').textContent);
                const priorityB = parseInt(b.querySelector('.priority-value').textContent);
                return priorityA - priorityB;
            });
            
            // Remove all items
            items.forEach(item => container.removeChild(item));
            
            // Add them back in sorted order
            items.forEach(item => container.appendChild(item));
        }
        
        // Load knowledge settings from API
        async function loadKnowledgeSettings() {
            const companyId = getCurrentCompanyId();
            if (!companyId) return;
            
            try {
                const response = await fetch(`/api/company/companies/${companyId}/knowledge`);
                if (!response.ok) {
                    console.log('Using default knowledge settings');
                    return;
                }
                
                const data = await response.json();
                
                if (data.success && data.data) {
                    const settings = data.data;
                    
                    // Update source priorities
                    if (settings.sourcePriority) {
                        for (const [source, priority] of Object.entries(settings.sourcePriority)) {
                            const element = document.querySelector(`#source-${source} .priority-value`);
                            if (element) element.textContent = priority;
                        }
                        updateSourcePriorityOrder();
                    }
                    
                    // Update confidence thresholds
                    if (settings.confidenceThresholds) {
                        for (const [source, threshold] of Object.entries(settings.confidenceThresholds)) {
                            const slider = document.getElementById(`threshold-${source}`);
                            const display = document.getElementById(`threshold-value-${source}`);
                            
                            if (slider && display) {
                                slider.value = threshold;
                                display.textContent = parseFloat(threshold).toFixed(2);
                            }
                        }
                    }
                    
                    // Update memory settings
                    if (settings.memoryMode) {
                        document.getElementById('memoryModeSelect').value = settings.memoryMode;
                    }
                    
                    if (settings.contextRetentionMinutes) {
                        const slider = document.getElementById('contextRetentionSlider');
                        const display = document.getElementById('contextRetentionValue');
                        slider.value = settings.contextRetentionMinutes;
                        display.textContent = `${settings.contextRetentionMinutes} minutes`;
                    }
                    
                    // Update fallback behaviors
                    document.getElementById('rejectLowConfidenceToggle').checked = 
                        settings.rejectLowConfidence !== undefined ? settings.rejectLowConfidence : true;
                        
                    document.getElementById('escalateNoMatchToggle').checked = 
                        settings.escalateOnNoMatch !== undefined ? settings.escalateOnNoMatch : true;
                    
                    // Update fallback message
                    if (settings.fallbackMessage) {
                        document.getElementById('fallbackMessageInput').value = settings.fallbackMessage;
                    }
                    
                    console.log('✅ Knowledge settings loaded');
                }
            } catch (error) {
                console.error('❌ Failed to load knowledge settings:', error);
            }
        }
        
        // Save knowledge settings to API
        async function saveKnowledgeSettings() {
            const companyId = getCurrentCompanyId();
            if (!companyId) return;
            
            // Build source priority object
            const sourcePriority = {};
            document.querySelectorAll('.priority-item').forEach(item => {
                const source = item.dataset.source;
                const priority = parseInt(item.querySelector('.priority-value').textContent);
                sourcePriority[source] = priority;
            });
            
            // Build confidence thresholds object
            const confidenceThresholds = {};
            document.querySelectorAll('input[type="range"][id^="threshold-"]').forEach(input => {
                const source = input.id.split('-')[1];
                confidenceThresholds[source] = parseFloat(input.value);
            });
            
            // Build complete settings object
            const knowledgeData = {
                sourcePriority,
                confidenceThresholds,
                memoryMode: document.getElementById('memoryModeSelect').value,
                contextRetentionMinutes: parseInt(document.getElementById('contextRetentionSlider').value),
                rejectLowConfidence: document.getElementById('rejectLowConfidenceToggle').checked,
                escalateOnNoMatch: document.getElementById('escalateNoMatchToggle').checked,
                fallbackMessage: document.getElementById('fallbackMessageInput').value.trim()
            };
            
            try {
                const response = await fetch(`/api/company/companies/${companyId}/knowledge`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(knowledgeData)
                });
                
                if (response.ok) {
                    // Show success message
                    const savedIndicator = document.getElementById('knowledge-settings-saved');
                    savedIndicator.classList.remove('hidden');
                    setTimeout(() => savedIndicator.classList.add('hidden'), 3000);
                    
                    console.log('✅ Knowledge settings saved');
                    alert('✅ Knowledge settings saved successfully!');
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to save settings');
                }
            } catch (error) {
                console.error('❌ Failed to save knowledge settings:', error);
                alert(`❌ Failed to save knowledge settings: ${error.message}`);
            }
        }
        
        // Reset knowledge settings to defaults
        function resetKnowledgeDefaults() {
            if (!confirm('Reset knowledge settings to defaults?')) return;
            
            // Reset source priorities
            document.querySelector('#source-companyQnA .priority-value').textContent = '1';
            document.querySelector('#source-tradeQnA .priority-value').textContent = '2';
            document.querySelector('#source-vectorSearch .priority-value').textContent = '3';
            document.querySelector('#source-llmFallback .priority-value').textContent = '4';
            updateSourcePriorityOrder();
            
            // Reset confidence thresholds
            document.getElementById('threshold-companyQnA').value = 0.8;
            document.getElementById('threshold-value-companyQnA').textContent = '0.80';
            
            document.getElementById('threshold-tradeQnA').value = 0.75;
            document.getElementById('threshold-value-tradeQnA').textContent = '0.75';
            
            document.getElementById('threshold-vectorSearch').value = 0.7;
            document.getElementById('threshold-value-vectorSearch').textContent = '0.70';
            
            document.getElementById('threshold-llmFallback').value = 0.6;
            document.getElementById('threshold-value-llmFallback').textContent = '0.60';
            
            // Reset memory settings
            document.getElementById('memoryModeSelect').value = 'conversational';
            document.getElementById('contextRetentionSlider').value = 30;
            document.getElementById('contextRetentionValue').textContent = '30 minutes';
            
            // Reset fallback behaviors
            document.getElementById('rejectLowConfidenceToggle').checked = true;
            document.getElementById('escalateNoMatchToggle').checked = true;
            
            // Reset fallback message
            document.getElementById('fallbackMessageInput').value = 
                "I want to make sure I give you accurate information. Let me connect you with a specialist who can help.";
            
            console.log('✅ Knowledge settings reset to defaults');
        }
        
        // Update threshold value display
        document.addEventListener('DOMContentLoaded', function() {
            const thresholdSlider = document.getElementById('agent-fallbackThreshold');
            const thresholdValue = document.getElementById('fallback-threshold-value');
            
            if (thresholdSlider && thresholdValue) {
                thresholdSlider.addEventListener('input', function() {
                    thresholdValue.textContent = this.value;
                });
            }
        });

        // Basic mobile menu toggle
        // Mobile menu toggle
        document.getElementById('mobile-menu-button')?.addEventListener('click', () => {
            document.getElementById('mobile-menu')?.classList.toggle('hidden');
        });

        // Navigation link highlighting only
        document.addEventListener('DOMContentLoaded', function() {
            let currentPath = window.location.pathname.replace(/\/$/, "") || "/index.html";
            document.querySelectorAll('header nav a.nav-link, #mobile-menu a.nav-link').forEach(link => {
                let linkPath = new URL(link.href).pathname.replace(/\/$/, "") || "/index.html";
                link.classList.remove('active-tab', 'text-gray-700');
                if (linkPath === currentPath) {
                    link.classList.add('active-tab');
                } else {
                    link.classList.add('text-gray-700');
                }
            });

            // Load AI Agent data when tab is accessed
            const aiAgentTab = document.getElementById('tab-ai-agent-logic');
            if (aiAgentTab) {
                aiAgentTab.addEventListener('click', function() {
                    // Add small delay to ensure tab content is visible
                    setTimeout(() => {
                        loadAgentTradeCategories();
                        loadAgentSettings();
                        loadAgentPersonalitySettings(); // Module 1: Load personality settings
                        initKnowledgeSources(); // Module 2: Initialize knowledge source controls
                        loadKnowledgeSettings(); // Module 2: Load knowledge settings
                        loadAgentAnalytics();
                    }, 100);
                });
            }
        });
    </script>
    
    <script src="/js/company-profile-modern.js?v=2.1"></script>
    
    <!-- Modern implementation handles all initialization -->
</body>
