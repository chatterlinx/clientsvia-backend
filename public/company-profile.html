<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Company Profile</title>
    <link rel="icon" href="/favicon.ico">
    
    <!-- Production Tailwind CSS (CDN disabled for production) -->
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <link rel="stylesheet" href="/css/tailwind-production.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        
        /* Global Navigation Styling */
        .nav-link-global { 
            @apply px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 transition-all duration-200 ease-in-out;
            border: 1px solid transparent;
        }
        .nav-link-global:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .nav-link-global.active { 
            @apply bg-indigo-600 text-white font-semibold;
            box-shadow: 0 2px 8px rgba(79, 70, 229, 0.3);
        }
        
        /* Tab Navigation Styling */
        .nav-link.active-tab { border-bottom-width: 2px; border-color: #4F46E5; color: #4F46E5; font-weight: 600; background-color: #EEF2FF; }
        .nav-link { @apply px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100 hover:text-gray-900; }
        
        .profile-section-title { @apply text-xl font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-200; }
        .detail-item { @apply flex flex-col sm:flex-row py-2; }
        .detail-label { @apply sm:w-1/3 font-medium text-gray-600 mb-1 sm:mb-0; }
        .detail-value { @apply sm:w-2/3 text-gray-800; }
        .config-block { @apply mt-3 p-4 border border-gray-200 rounded-md bg-gray-50; }
        .form-input, .form-select, .form-textarea, .form-checkbox { @apply mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm transition duration-150 ease-in-out; }
        .form-checkbox { @apply w-auto h-4 text-indigo-600; } 
        .form-label { @apply block text-sm font-medium text-gray-700; }
        .form-check-label { @apply ml-2 text-sm text-gray-700; }
        .tab-button { padding: 0.5rem 1rem; font-weight: 500; font-size: 0.875rem; line-height: 1.25rem; border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem; transition-property: color, background-color, border-color, text-decoration-color, fill, stroke; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; cursor: pointer; }
        .tab-button:focus { outline: 2px solid transparent; outline-offset: 2px; }
        .tab-button-active { background-color: #4F46E5; color: white; }
        .tab-button-inactive { background-color: #E5E7EB; color: #374151; }
        .tab-button-inactive:hover { background-color: #D1D5DB; }
        .tab-content-item { @apply p-0 pt-6; } 
        .tab-content-item.hidden { display: none; }
        .notes-textarea { @apply w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out; min-height: 150px; }
        .wider-textbox { max-width: 800px; width: 100%; }
        .note-card { @apply bg-white p-4 rounded-lg shadow border border-gray-200 mb-4; }
        .note-card.pinned { @apply bg-yellow-50 border-yellow-300; }
        .note-content { @apply text-gray-800 whitespace-pre-wrap; }
        .note-timestamps { @apply text-xs text-gray-500 mt-2; }
        .note-actions { @apply mt-3 flex items-center space-x-3; }
        .note-action-button { @apply text-xs text-indigo-600 hover:text-indigo-800 font-medium; }
        .note-action-button .fa-thumbtack.pinned-icon { color: #F59E0B; }
        .status-badge { @apply px-2.5 py-0.5 rounded-full text-xs font-medium; }
        .status-active { @apply bg-green-100 text-green-800; }
        .status-inactive { @apply bg-red-100 text-red-800; }

        


        
        .contact-block-view { @apply mt-3 pt-3 border-t border-gray-200; }
        .contact-block-view .detail-item:last-child { padding-bottom: 0; }
        .scheduling-rule-daily-hours-header { @apply grid grid-cols-4 gap-x-3 mb-1 px-2 text-xs font-medium text-gray-500; }
        .scheduling-rule-daily-hours-row { @apply grid grid-cols-4 gap-x-3 items-center p-2 hover:bg-gray-100 rounded-md; }
        #toast-notification { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: #333; color: white; padding: 10px 20px; border-radius: 5px; z-index: 1000; opacity: 0; transition: opacity 0.5s ease-in-out; }
        #toast-notification.show { opacity: 1; }
        #toast-notification.success { background-color: #4CAF50; }
        #toast-notification.error { background-color: #f44336; }
        @media (min-width: 768px) { .wider-textbox { max-width: 800px; } }
        @media (max-width: 767px) { .wider-textbox { max-width: 100%; } }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app" class="flex flex-col min-h-screen">
        <header class="bg-white shadow-md sticky top-0 z-40">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex-shrink-0">
                        <a href="/index.html" class="text-2xl font-bold text-indigo-600">
                            <i class="fas fa-tachometer-alt mr-2"></i>Admin Dashboard
                        </a>
                    </div>
                    <nav class="hidden md:flex space-x-8 items-center">
                        <a href="/index.html" class="nav-link-global" id="nav-home">Home</a>
                        <a href="/directory.html" class="nav-link-global" id="nav-directory">Directory</a>
                        <a href="/add-company.html" class="nav-link-global" id="nav-add-company">Add Company</a>
                        <a href="/trade-category-management.html" class="nav-link-global" id="nav-trade-categories">Trade Categories</a>
                        <a href="/company-profile.html" class="nav-link-global active" id="nav-company-profile">Company Profile</a>
                    </nav>
                    <div class="md:hidden flex items-center">
                        <button id="mobile-menu-button" class="text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500">
                            <span class="sr-only">Open main menu</span>
                            <i class="fas fa-bars text-2xl"></i>
                        </button>
                    </div>
                </div>

            <!-- ...existing code... -->
            <div id="mobile-menu" class="md:hidden hidden">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <a href="/index.html" class="block nav-link text-base">Home</a>
                    <a href="/directory.html" class="block nav-link text-base">Directory</a>
                    <a href="/add-company.html" class="block nav-link text-base">Add Company</a>
                    <a href="/trade-category-management.html" class="block nav-link text-base">Trade Categories</a>
                    <a href="/company-profile.html" class="block nav-link text-base">Company Profile</a>
                </div>
            </div>
        </header>

        <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-1">
                    <div> 
                        <h1 class="text-3xl font-semibold text-gray-800" id="company-name-header">Loading...</h1>
                        <p id="company-id-subheader" class="text-xs text-gray-500 mt-1">ID: Loading...</p> 
                    </div>
                    <div class="flex items-center gap-x-3 mt-3 md:mt-0">
                         <span id="company-status-badge" class="status-badge mr-3">Status</span> 
                    </div>
                </div>
                <hr class="mb-6 mt-3">

                <div class="mb-6">
                    <div class="border-b border-gray-300">
                        <nav class="-mb-px flex flex-wrap space-x-1" aria-label="Tabs">
                            <button class="tab-button tab-button-active" id="tab-overview" data-tab="overview">
                                <i class="fas fa-info-circle mr-1"></i>Overview
                            </button>
                            <button class="tab-button tab-button-inactive" id="tab-config" data-tab="config">
                                <i class="fas fa-cogs mr-1"></i>Configuration
                            </button>
                            <button class="tab-button tab-button-inactive" id="tab-notes" data-tab="notes">
                                <i class="fas fa-sticky-note mr-1"></i>Notes
                            </button>
                             <button class="tab-button tab-button-inactive" id="tab-calendar-settings" data-tab="calendar-settings">
                                <i class="fas fa-calendar-alt mr-1"></i>Calendar Settings
                            </button>
                            <button class="tab-button tab-button-inactive" id="tab-ai-settings" data-tab="ai-settings">
                                <i class="fas fa-robot mr-1"></i>AI Settings
                            </button>
                            <button class="tab-button tab-button-inactive" id="tab-ai-voice" data-tab="ai-voice">
                                <i class="fas fa-microphone-alt mr-1"></i>AI Voice Settings
                            </button>
                            <button class="tab-button tab-button-inactive" id="tab-personality-responses" data-tab="personality-responses">
                                <i class="fas fa-comment-dots mr-1"></i>Agent Personality Responses
                            </button>
                            <button class="tab-button tab-button-inactive" id="tab-ai-agent-logic" data-tab="ai-agent-logic">
                                <i class="fas fa-brain mr-1"></i>AI Agent Logic
                            </button>

                        </nav>
                    </div>
                </div>

                <div id="tab-content-area">
                    <div id="overview-content" class="tab-content-item">
                        <section class="profile-section bg-transparent shadow-none p-0">
                            <div class="flex justify-between items-center mb-2">
                                <h2 class="profile-section-title !mb-0"><i class="fas fa-building mr-2 text-indigo-600"></i>Company Information</h2>
                                <button id="edit-profile-button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out flex items-center">
                                    <i class="fas fa-edit mr-2"></i>Edit Profile
                                </button>
                            </div>
                            <div id="company-details-view">
                                <div class="detail-item"><span class="detail-label">Company Name:</span><span class="detail-value" id="company-name-view">Loading...</span></div> 
                                <div class="detail-item"><span class="detail-label">Owner:</span><span class="detail-value" id="company-owner-view">Loading...</span></div>
                                <div class="detail-item"><span class="detail-label">Owner Email:</span><span class="detail-value" id="company-owner-email-view">Loading...</span></div>
                                <div class="detail-item"><span class="detail-label">Owner Phone:</span><span class="detail-value" id="company-owner-phone-view">Loading...</span></div>
                                <div class="detail-item"><span class="detail-label">Primary Contact:</span><span class="detail-value" id="company-contact-name-view">Loading...</span></div>
                                <div class="detail-item"><span class="detail-label">Contact Email:</span><span class="detail-value" id="company-contact-email-view">Loading...</span></div>
                                <div class="detail-item"><span class="detail-label">Contact Phone:</span><span class="detail-value" id="company-contact-phone-view">Loading...</span></div>
                                <div class="detail-item"><span class="detail-label">Address:</span><span class="detail-value" id="company-address-view">Loading...</span></div>
                                <div id="additional-contacts-view-container" class="mt-4"></div>
                            </div>
                            <div id="company-details-edit-form" class="hidden mt-4">
                                <p class="text-gray-500"><em>Loading edit form...</em></p>
                            </div>
                        </section>
                    </div>

                    <div id="config-content" class="tab-content-item hidden">
                        <section class="profile-section bg-transparent shadow-none p-0">
                            <h2 class="profile-section-title"><i class="fas fa-cogs mr-2 text-indigo-600"></i>Service Configuration</h2>
                            <form id="config-settings-form">
                                <div class="config-block">
                                    <h3 class="font-semibold text-gray-700 mb-2">Twilio Integration Credentials</h3>
                                    <p class="text-sm text-gray-500 mb-3">Enter the Twilio credentials that this company's AI agent will use.</p>
                                    <div class="space-y-3">
                                        <div>
                                            <label for="twilioAccountSid" class="form-label">Account SID</label>
                                            <input type="text" id="twilioAccountSid" name="twilioAccountSid" class="form-input wider-textbox" placeholder="ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                                        </div>
                                        <div>
                                            <label for="twilioAuthToken" class="form-label">Auth Token</label>
                                            <input type="password" id="twilioAuthToken" name="twilioAuthToken" class="form-input wider-textbox" placeholder="Enter Auth Token">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Phone Numbers Management -->
                                <div class="config-block mt-6">
                                    <div class="flex justify-between items-center mb-3">
                                        <h3 class="font-semibold text-gray-700">Twilio Phone Numbers</h3>
                                        <button type="button" id="addPhoneNumberBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white text-sm px-3 py-1 rounded-md flex items-center">
                                            <i class="fas fa-plus mr-1"></i>Add Number
                                        </button>
                                    </div>
                                    <p class="text-sm text-gray-500 mb-3">Manage all Twilio phone numbers available for this company's AI agents.</p>
                                    
                                    <!-- Phone Numbers List -->
                                    <div id="phoneNumbersList" class="space-y-3">
                                        <!-- Primary Phone Number (Default) -->
                                        <div class="phone-number-item border border-gray-200 rounded-lg p-4 bg-gray-50">
                                            <div class="flex items-center justify-between">
                                                <div class="flex-1 grid grid-cols-1 md:grid-cols-3 gap-4">
                                                    <div>
                                                        <label class="form-label text-sm">Phone Number (E.164 format)</label>
                                                        <input type="tel" name="phoneNumber" class="form-input" placeholder="+12395551212" value="">
                                                    </div>
                                                    <div>
                                                        <label class="form-label text-sm">Friendly Name</label>
                                                        <input type="text" name="friendlyName" class="form-input" placeholder="Main Business Line" value="Primary Number">
                                                    </div>
                                                    <div>
                                                        <label class="form-label text-sm">Status</label>
                                                        <select name="status" class="form-select">
                                                            <option value="active" selected>Active</option>
                                                            <option value="inactive">Inactive</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="ml-4 flex items-center space-x-2">
                                                    <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">Primary</span>
                                                    <button type="button" class="text-red-600 hover:text-red-800" onclick="removePhoneNumber(this)" title="Remove">
                                                        <i class="fas fa-trash text-sm"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Add Phone Number Template (Hidden) -->
                                    <template id="phoneNumberTemplate">
                                        <div class="phone-number-item border border-gray-200 rounded-lg p-4">
                                            <div class="flex items-center justify-between">
                                                <div class="flex-1 grid grid-cols-1 md:grid-cols-3 gap-4">
                                                    <div>
                                                        <label class="form-label text-sm">Phone Number (E.164 format)</label>
                                                        <input type="tel" name="phoneNumber" class="form-input" placeholder="+12395551212">
                                                    </div>
                                                    <div>
                                                        <label class="form-label text-sm">Friendly Name</label>
                                                        <input type="text" name="friendlyName" class="form-input" placeholder="e.g., Emergency Line, Sales Line">
                                                    </div>
                                                    <div>
                                                        <label class="form-label text-sm">Status</label>
                                                        <select name="status" class="form-select">
                                                            <option value="active" selected>Active</option>
                                                            <option value="inactive">Inactive</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="ml-4 flex items-center space-x-2">
                                                    <button type="button" class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full hover:bg-blue-200" onclick="setPrimaryNumber(this)" title="Set as Primary">
                                                        Set Primary
                                                    </button>
                                                    <button type="button" class="text-red-600 hover:text-red-800" onclick="removePhoneNumber(this)" title="Remove">
                                                        <i class="fas fa-trash text-sm"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                                
                                <!-- Webhook Configuration Reference -->
                                <div class="config-block mt-6">
                                    <div class="flex justify-between items-center mb-3">
                                        <h3 class="font-semibold text-gray-700">Twilio Webhook Configuration</h3>
                                        <button type="button" id="toggleWebhookInfo" class="text-indigo-600 hover:text-indigo-800 text-sm flex items-center">
                                            <i class="fas fa-info-circle mr-1"></i>Show Webhook URLs
                                        </button>
                                    </div>
                                    <p class="text-sm text-gray-500 mb-3">Use these webhook URLs in your Twilio Console for phone number configuration.</p>
                                    
                                    <div id="webhookInfoPanel" class="hidden">
                                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 space-y-4">
                                            <!-- Voice Webhook -->
                                            <div class="webhook-item">
                                                <div class="flex justify-between items-center mb-2">
                                                    <h4 class="text-sm font-medium text-gray-900">🎤 Voice Webhook (Primary)</h4>
                                                    <button type="button" class="copy-webhook-btn text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 px-2 py-1 rounded" data-webhook="https://clientsvia-backend.onrender.com/api/twilio/voice">
                                                        <i class="fas fa-copy mr-1"></i>Copy
                                                    </button>
                                                </div>
                                                <div class="bg-white border rounded p-2 font-mono text-sm text-gray-800">
                                                    https://clientsvia-backend.onrender.com/api/twilio/voice
                                                </div>
                                                <p class="text-xs text-gray-600 mt-1">Configure this in Twilio Console → Phone Numbers → Voice Configuration</p>
                                            </div>
                                            
                                            <!-- Speech Webhook -->
                                            <div class="webhook-item">
                                                <div class="flex justify-between items-center mb-2">
                                                    <h4 class="text-sm font-medium text-gray-900">🗣️ Speech Recognition</h4>
                                                    <button type="button" class="copy-webhook-btn text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 px-2 py-1 rounded" data-webhook="https://clientsvia-backend.onrender.com/api/twilio/handle-speech">
                                                        <i class="fas fa-copy mr-1"></i>Copy
                                                    </button>
                                                </div>
                                                <div class="bg-white border rounded p-2 font-mono text-sm text-gray-800">
                                                    https://clientsvia-backend.onrender.com/api/twilio/handle-speech
                                                </div>
                                                <p class="text-xs text-gray-600 mt-1">Used internally for AI speech processing</p>
                                            </div>
                                            
                                            <!-- Additional Webhooks -->
                                            <div class="webhook-item">
                                                <div class="flex justify-between items-center mb-2">
                                                    <h4 class="text-sm font-medium text-gray-900">⚡ Additional Endpoints</h4>
                                                    <span class="text-xs text-gray-500">For advanced configurations</span>
                                                </div>
                                                <div class="space-y-2">
                                                    <div class="flex justify-between items-center">
                                                        <span class="font-mono text-xs text-gray-700">../api/twilio/partial-speech</span>
                                                        <button type="button" class="copy-webhook-btn text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 px-2 py-1 rounded" data-webhook="https://clientsvia-backend.onrender.com/api/twilio/partial-speech">
                                                            <i class="fas fa-copy"></i>
                                                        </button>
                                                    </div>
                                                    <div class="flex justify-between items-center">
                                                        <span class="font-mono text-xs text-gray-700">../api/twilio/speech-timing-test</span>
                                                        <button type="button" class="copy-webhook-btn text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 px-2 py-1 rounded" data-webhook="https://clientsvia-backend.onrender.com/api/twilio/speech-timing-test">
                                                            <i class="fas fa-copy"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Configuration Instructions -->
                                            <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded">
                                                <h5 class="text-sm font-medium text-blue-900 mb-2">📋 Quick Setup Instructions:</h5>
                                                <ol class="text-xs text-blue-800 space-y-1">
                                                    <li>1. Go to <a href="https://console.twilio.com" target="_blank" class="underline hover:no-underline">Twilio Console</a></li>
                                                    <li>2. Navigate to Phone Numbers → Manage → Active Numbers</li>
                                                    <li>3. Click on your phone number</li>
                                                    <li>4. Set Voice Configuration webhook to the Voice Webhook URL above</li>
                                                    <li>5. Set HTTP method to POST</li>
                                                    <li>6. Save configuration</li>
                                                </ol>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-8 pt-5 border-t border-gray-200">
                                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-150 ease-in-out">
                                        <i class="fas fa-save mr-2"></i>Save Configuration
                                    </button>
                                </div>
                            </form>
                        </section>
                    </div>

                    <div id="notes-content" class="tab-content-item hidden">
                        <section class="profile-section bg-transparent shadow-none p-0"> 
                            <h2 class="profile-section-title"><i class="fas fa-sticky-note mr-2 text-indigo-600"></i>Company Notes</h2>
                            <div id="add-note-area" class="mb-6">
                                <textarea id="new-note-textarea" class="notes-textarea wider-textbox" placeholder="Type your new note here..."></textarea>
                                <button id="add-new-note-button" class="mt-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out">
                                    <i class="fas fa-plus-circle mr-2"></i>Add Note
                                </button>
                            </div>
                            <div id="notes-display-area">
                                <p class="text-gray-500 italic text-center py-4">Notes will appear here.</p>
                            </div>
                        </section>
                    </div>
                    
                    <div id="calendar-settings-content" class="tab-content-item hidden">
                         <section class="profile-section bg-transparent shadow-none p-0">
                            <h2 class="profile-section-title"><i class="fas fa-calendar-alt mr-2 text-indigo-600"></i>Google Calendar Integration</h2>
                            <div id="gcal-status-container" class="p-4 rounded-lg border bg-gray-50 mb-6">
                                 <!-- Status content will be dynamically inserted here -->
                                 <p class="text-gray-500">Checking connection status...</p>
                            </div>

                            <div id="gcal-calendars-list-container" class="hidden">
                                <h3 class="text-lg font-semibold text-gray-700 mb-2">Available Calendars</h3>
                                <p class="text-sm text-gray-500 mb-4">These calendars can be selected within the 'Service Scheduling Rules'. Only calendars you have 'write' access to are shown.</p>
                                <div id="gcal-calendars-list" class="space-y-3 border rounded-lg p-4 bg-white max-h-96 overflow-y-auto">
                                    <!-- Calendar list will be dynamically inserted here -->
                                    <p class="text-gray-500">Loading calendars...</p>
                                </div>
                            </div>
                         </section>
                    </div>

                    <div id="ai-settings-content" class="tab-content-item hidden">
                        <section class="profile-section bg-transparent shadow-none p-0">
                            <h2 class="profile-section-title"><i class="fas fa-robot mr-2 text-indigo-600"></i>AI Core Parameters</h2>
                            <p class="text-sm text-gray-500 mb-4">High-level AI settings for core functionality.</p>
                            <form id="ai-settings-form">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                    <div>
                                        <label for="aiModel" class="form-label">AI Model Engine</label>
                                        <select id="aiModel" name="aiModel" class="form-select">
                                            <option value="gemini-2.5-flash">Gemini 2.5 Flash (High Speed)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="aiCorePersonality" class="form-label">AI Base Personality</label>
                                        <select id="aiCorePersonality" name="aiCorePersonality" class="form-select">
                                            <option value="friendly">Friendly & Empathetic</option>
                                            <option value="formal">Formal & Professional</option>
                                            <option value="efficient">Quick & Efficient</option>
                                            <option value="witty">Witty & Engaging</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label for="knowledgeBaseSource" class="form-label">External Knowledge Base URL/ID (Optional)</label>
                                    <input type="text" id="knowledgeBaseSource" name="knowledgeBaseSource" class="form-input wider-textbox" placeholder="e.g., FAQ page URL, Document ID">
                                </div>
                                <div class="mt-4">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="llmFallbackEnabled" name="llmFallbackEnabled" class="form-checkbox">
                                        <span class="form-check-label">Enable LLM Chain (Ollama Primary → Gemini Backup)</span>
                                    </label>
                                    <p class="text-xs text-gray-500 mt-1">Local AI runs first for privacy, cloud backup for reliability</p>
                                </div>
                                
                                <!-- Ollama Local LLM Settings -->
                                <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg" id="ollamaSettingsContainer">
                                    <h4 class="text-sm font-semibold text-blue-800 mb-3 flex items-center">
                                        <i class="fas fa-robot mr-2"></i>Local LLM (Ollama) Configuration
                                    </h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="flex items-center">
                                                <input type="checkbox" id="ollamaEnabled" name="ollamaEnabled" class="form-checkbox">
                                                <span class="form-check-label">Enable Local Ollama LLM</span>
                                            </label>
                                            <p class="text-xs text-gray-600 mt-1">Use local AI for maximum privacy</p>
                                        </div>
                                        <div>
                                            <label for="ollamaModel" class="form-label text-sm">Ollama Model</label>
                                            <select id="ollamaModel" name="ollamaModel" class="form-select text-sm">
                                                <option value="llama3.1:8b-instruct-q4_0">Llama 3.1 8B (Recommended)</option>
                                                <option value="llama3.2:3b">Llama 3.2 3B (Faster)</option>
                                                <option value="llama3.2:1b">Llama 3.2 1B (Ultra Fast)</option>
                                                <option value="qwen2.5:7b">Qwen 2.5 7B</option>
                                                <option value="gemma2:9b">Gemma 2 9B</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="useGeminiBackup" name="useGeminiBackup" class="form-checkbox">
                                            <span class="form-check-label">Fall back to Gemini if Ollama fails</span>
                                        </label>
                                        <p class="text-xs text-gray-600 mt-1">Ensures 99.9% uptime with cloud backup</p>
                                    </div>
                                </div>
                                <div class="mt-4" id="escalationMessageContainer">
                                    <label for="customEscalationMessage" class="form-label">Custom Escalation Message</label>
                                    <textarea id="customEscalationMessage" name="customEscalationMessage" class="form-textarea wider-textbox" rows="3" placeholder="I’m unable to answer that, let me connect you to a team member who can help."></textarea>
                                </div>
                                <div class="mt-6 border-t border-gray-200 pt-6">
                                    <h3 class="text-md font-medium text-gray-700 mb-3">Conversation Flow Settings</h3>
                                    <div class="space-y-3">
                                        <label class="flex items-start">
                                            <input type="checkbox" id="bargeIn" name="bargeIn" class="form-checkbox mt-1">
                                            <div class="ml-2">
                                                <span class="form-check-label font-medium">Allow Caller Interruption (Barge-In)</span>
                                                <p class="text-xs text-gray-500 mt-1">
                                                    <strong>ON:</strong> Callers can interrupt the agent while speaking (may cause choppy conversations)<br>
                                                    <strong>OFF:</strong> Agent finishes speaking before listening (natural conversation flow)
                                                </p>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="mt-6 border-t border-gray-200 pt-6">
                                    <h3 class="text-md font-medium text-gray-700 mb-3">Advanced Options</h3>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="sentimentAnalysis" name="sentimentAnalysis" class="form-checkbox">
                                            <span class="form-check-label">Enable Sentiment Analysis</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="dataLogging" name="dataLogging" class="form-checkbox" checked>
                                            <span class="form-check-label">Enable Interaction Logging (for improvements)</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="mt-8 pt-5 border-t border-gray-200">
                                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-150 ease-in-out">
                                        <i class="fas fa-save mr-2"></i>Save AI Core Settings
                                    </button>
                                </div>
                            </form>
                        </section>
                    </div>

                    <div id="ai-voice-content" class="tab-content-item hidden">
                        <section class="profile-section bg-transparent shadow-none p-0">
                            <h2 class="profile-section-title"><i class="fas fa-microphone-alt mr-2 text-indigo-600"></i>AI Voice Settings</h2>
                            <form id="elevenlabs-settings-form" class="mb-6">
                                <div class="mb-4">
                                    <label for="elevenlabsApiKey" class="form-label">ElevenLabs API Key</label>
                                    <input type="text" id="elevenlabsApiKey" name="elevenlabsApiKey" class="form-input wider-textbox" placeholder="Enter your ElevenLabs API Key">
                                </div>
                                <div class="mb-4">
                                    <label for="elevenlabsVoice" class="form-label">Voice Selection</label>
                                    <select id="elevenlabsVoice" name="elevenlabsVoice" class="form-select wider-textbox">
                                        <option value="">Select a voice</option>
                                        <option value="Rachel">Rachel</option>
                                        <option value="Domi">Domi</option>
                                        <option value="Bella">Bella</option>
                                        <option value="Antoni">Antoni</option>
                                        <option value="Elli">Elli</option>
                                        <option value="Josh">Josh</option>
                                        <option value="Arnold">Arnold</option>
                                        <option value="Adam">Adam</option>
                                        <option value="Sam">Sam</option>
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label for="elevenlabsTestPhrase" class="form-label">Test Phrase</label>
                                    <input type="text" id="elevenlabsTestPhrase" name="elevenlabsTestPhrase" class="form-input wider-textbox" placeholder="Type a phrase to test voice playback" value="Hello, this is a test from ElevenLabs!">
                                </div>
                                <button type="button" id="testElevenLabsVoiceBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-150 ease-in-out">Listen to Test Phrase</button>
                            <button type="submit" class="ml-4 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-150 ease-in-out">Save ElevenLabs Settings</button>
                        </form>

                        <!-- Agent Performance Controls Section -->
                        <section class="profile-section bg-gray-50 border border-gray-200 rounded-lg p-6 mt-8">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-tachometer-alt mr-2 text-indigo-600"></i>Agent Performance Controls
                                <span class="ml-2 text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">Advanced</span>
                            </h3>
                            <p class="text-sm text-gray-600 mb-6">Fine-tune agent response timing and behavior for optimal call experience.</p>
                            
                            <form id="agent-performance-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Speech Confidence Threshold -->
                                    <div>
                                        <label for="speechConfidenceThreshold" class="form-label">Speech Recognition Sensitivity</label>
                                        <input type="range" id="speechConfidenceThreshold" name="speechConfidenceThreshold" 
                                               class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" 
                                               value="0.4" min="0.1" max="0.9" step="0.1">
                                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                                            <span>Low (0.1)</span>
                                            <span id="speechConfidenceValue">0.4</span>
                                            <span>High (0.9)</span>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">Lower = more sensitive, Higher = more accurate</p>
                                    </div>

                                    <!-- Fuzzy Match Threshold -->
                                    <div>
                                        <label for="fuzzyMatchThreshold" class="form-label">Q&A Matching Sensitivity</label>
                                        <input type="range" id="fuzzyMatchThreshold" name="fuzzyMatchThreshold" 
                                               class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" 
                                               value="0.3" min="0.1" max="0.8" step="0.1">
                                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                                            <span>Strict (0.1)</span>
                                            <span id="fuzzyThresholdValue">0.3</span>
                                            <span>Flexible (0.8)</span>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">How closely caller words must match Q&A keywords</p>
                                    </div>

                                    <!-- Max Repeats -->
                                    <div>
                                        <label for="maxRepeats" class="form-label">Max Retry Attempts</label>
                                        <select id="maxRepeats" name="maxRepeats" class="form-select">
                                            <option value="1">1 time</option>
                                            <option value="2">2 times</option>
                                            <option value="3" selected>3 times</option>
                                            <option value="4">4 times</option>
                                            <option value="5">5 times</option>
                                        </select>
                                        <p class="text-xs text-gray-500 mt-1">Times to retry before escalating unclear speech</p>
                                    </div>

                                    <!-- TTS Provider -->
                                    <div>
                                        <label for="ttsProvider" class="form-label">TTS Provider</label>
                                        <select id="ttsProvider" name="ttsProvider" class="form-select">
                                            <option value="elevenlabs" selected>ElevenLabs (Premium)</option>
                                        </select>
                                        <p class="text-xs text-gray-500 mt-1">Voice synthesis provider for agent responses</p>
                                    </div>
                                </div>

                                <!-- Trade Categories Section -->
                                <div class="mt-6 border-t border-gray-200 pt-6">
                                    <h3 class="text-md font-medium text-gray-700 mb-3">
                                        <i class="fas fa-industry mr-2 text-indigo-600"></i>Trade Categories
                                    </h3>
                                    <label for="trade-category-select" class="block text-sm font-medium text-gray-700 mb-2">
                                        Select all applicable trades this company serves:
                                    </label>
                                    <select 
                                        id="trade-category-select" 
                                        multiple 
                                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm h-32 form-select"
                                    >
                                        <!-- Options will be loaded dynamically -->
                                    </select>
                                    <p class="mt-1 text-sm text-gray-500">
                                        <i class="fas fa-info-circle mr-1 text-blue-500"></i>
                                        Controls Q&A fallback and booking routing logic
                                    </p>

                                    <button 
                                        type="button"
                                        onclick="saveTradeCategories()" 
                                        class="mt-3 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition duration-150 ease-in-out"
                                    >
                                        <i class="fas fa-save mr-2"></i>Save Categories
                                    </button>
                                </div>

                                <div class="border-t border-gray-200 pt-6">
                                    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-150 ease-in-out">
                                        <i class="fas fa-save mr-2"></i>Save Performance Settings
                                    </button>
                                </div>
                            </form>
                        </section>
                    </div>

                    <div id="personality-responses-content" class="tab-content-item hidden">
                        <section class="profile-section bg-transparent shadow-none p-0">
                            <h2 class="profile-section-title"><i class="fas fa-comment-dots mr-2 text-indigo-600"></i>Agent Personality Responses</h2>
                            <form id="personality-responses-form">
                                <div id="personality-responses-list" class="space-y-4"></div>
                                <div class="mt-8 pt-5 border-t border-gray-200">
                                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-150 ease-in-out">
                                        <i class="fas fa-save mr-2"></i>Save Responses
                                    </button>
                                </div>
                            </form>
                        </section>
                    </div>

                    <div id="ai-agent-logic-content" class="tab-content-item hidden">
                        <section class="profile-section bg-transparent shadow-none p-0">
                            <h2 class="profile-section-title"><i class="fas fa-brain mr-2 text-indigo-600"></i>AI Agent Logic</h2>
                            
                            <!-- Notepad Section -->
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                                <div class="border-b border-gray-200 bg-gray-50 px-4 py-3 rounded-t-lg">
                                    <h3 class="text-lg font-medium text-gray-800">
                                        <i class="fas fa-sticky-note mr-2 text-yellow-600"></i>Logic Notes
                                    </h3>
                                    <p class="text-sm text-gray-600 mt-1">Keep track of AI logic decisions, rules, and implementation notes</p>
                                </div>
                                
                                <div class="p-4">
                                    <!-- Add New Note Form -->
                                    <div class="mb-4 pb-4 border-b border-gray-200">
                                        <label for="new-logic-note" class="form-label">Add New Note</label>
                                        <textarea 
                                            id="new-logic-note" 
                                            class="form-textarea w-full" 
                                            rows="3" 
                                            placeholder="Enter your AI logic note here..."
                                        ></textarea>
                                        <div class="mt-2 flex justify-end">
                                            <button 
                                                type="button" 
                                                onclick="addLogicNote()" 
                                                class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-md shadow-sm transition duration-150 ease-in-out"
                                            >
                                                <i class="fas fa-plus mr-2"></i>Add Note
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Notes List -->
                                    <div id="logic-notes-list" class="space-y-3">
                                        <p class="text-gray-500 italic text-center py-4">No notes yet. Add your first note above.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Booking Flow Config Section -->
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                                <div class="border-b border-gray-200 bg-gradient-to-r from-blue-50 to-cyan-50 px-4 py-3 rounded-t-lg">
                                    <h3 class="text-lg font-medium text-gray-800 flex items-center">
                                        <i class="fas fa-calendar-check mr-2 text-blue-600"></i>Booking Flow Configuration
                                        <span class="ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">Interactive</span>
                                    </h3>
                                    <p class="text-sm text-gray-600 mt-1">Configure the conversation flow for booking appointments with customers</p>
                                </div>
                                
                                <div class="p-4">
                                    <div class="mb-4">
                                        <table id="booking-flow-table" class="table-auto w-full border mb-4 text-sm">
                                            <thead>
                                                <tr class="bg-gray-100">
                                                    <th class="p-3 text-left font-medium text-gray-700">Prompt</th>
                                                    <th class="p-3 text-left font-medium text-gray-700">Field Name</th>
                                                    <th class="p-3 text-left font-medium text-gray-700">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="booking-flow-body">
                                                <!-- Fields will load here -->
                                            </tbody>
                                        </table>
                                    </div>

                                    <div class="flex items-center gap-2 mb-4 p-3 bg-gray-50 rounded-lg">
                                        <input 
                                            id="new-prompt" 
                                            placeholder="Prompt (e.g. What's your address?)" 
                                            class="form-input flex-1 text-sm"
                                        />
                                        <input 
                                            id="new-name" 
                                            placeholder="Field Name (e.g. address)" 
                                            class="form-input w-1/3 text-sm"
                                        />
                                        <button 
                                            type="button"
                                            class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md shadow-sm transition duration-150 ease-in-out" 
                                            onclick="addBookingField()"
                                        >
                                            <i class="fas fa-plus mr-1"></i>Add Field
                                        </button>
                                    </div>

                                    <div class="flex justify-between items-center pt-3 border-t border-gray-200">
                                        <div class="text-sm text-gray-600">
                                            <i class="fas fa-info-circle mr-1 text-blue-500"></i>
                                            These fields define the conversation flow for booking appointments
                                        </div>
                                        <div class="flex items-center space-x-3">
                                            <button 
                                                type="button"
                                                class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md shadow-sm transition duration-150 ease-in-out" 
                                                onclick="saveBookingFlow()"
                                            >
                                                <i class="fas fa-save mr-2"></i>Save Booking Flow
                                            </button>
                                            <span id="booking-flow-saved" class="text-green-600 text-sm hidden">
                                                <i class="fas fa-check-circle mr-1"></i>Saved!
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>

                </div>
            </div>
        </div>
    </body>

    <script>
        // Global function to get current company ID
        function getCurrentCompanyId() {
            // First try to get from global variable
            if (window.currentCompanyId) {
                return window.currentCompanyId;
            }
            
            // Fallback: extract from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const companyId = urlParams.get('id');
            
            if (!companyId) {
                console.error('Company ID not found in URL or global variable');
                return null;
            }
            
            return companyId;
        }

        // Basic mobile menu toggle
        // Mobile menu toggle
        document.getElementById('mobile-menu-button')?.addEventListener('click', () => {
            document.getElementById('mobile-menu')?.classList.toggle('hidden');
        });

        // Navigation link highlighting only
        document.addEventListener('DOMContentLoaded', function() {
            let currentPath = window.location.pathname.replace(/\/$/, "") || "/index.html";
            document.querySelectorAll('header nav a.nav-link, #mobile-menu a.nav-link').forEach(link => {
                let linkPath = new URL(link.href).pathname.replace(/\/$/, "") || "/index.html";
                link.classList.remove('active-tab', 'text-gray-700');
                if (linkPath === currentPath) {
                    link.classList.add('active-tab');
                } else {
                    link.classList.add('text-gray-700');
                }
            });
        });
    </script>
    
    <script src="/js/company-profile-modern.js"></script>
    
    <!-- Modern implementation handles all initialization -->
</body>
